!function(e){var t=function(){var e=this,t="1.16.3.0",r="undefined"!=typeof MeadCo&&void 0!==MeadCo.logEnable&&MeadCo.logEnable,o="undefined"!=typeof MeadCo&&void 0!==MeadCo.useFetch?MeadCo.useFetch:void 0===e.jQuery,n=function(e){r&&console.log("MeadCo :: "+e)},i=function(e){console.error("MeadCo :: "+e)};return e.extendMeadCoNamespace=function(t,r){var o=r();n("MeadCo root extending namespace: "+t);for(var i=t.split("."),a=e.scope||this.jQuery||this.ender||this.$||this,s=0;s<i.length;s++){var c=i[s];if(s===i.length-1)if(void 0===a[c])n("installing implementation at: "+c),a[c]=o;else{n("Warning - extending package: "+c);var l=a[c];a[c]=o;var d=a[c];for(var u in n("preserving old scope ... "),l)l.hasOwnProperty(u)&&(n("will preserve: "+u),d[u]=l[u])}else void 0===a[c]?(n("initialising new: "+c),a[c]={}):n("using existing package: "+c);a=a[c]}},n("MeadCo root namespace "+t+" loaded."),{log:n,warn:function(e){console.warn("MeadCo :: "+e)},error:i,get version(){return t},get logEnabled(){return r},set logEnabled(e){r=e},get fetchEnabled(){return o},set fetchEnabled(e){o=e},createNS:function(t){var r=t.split("."),o=e.scope.MeadCo;"MeadCo"===r[0]&&(r=r.slice(1));for(var n=0;n<r.length;n++){var i=r[n];void 0===o[i]&&(o[i]={}),o=o[i]}return o},set scope(t){e.scope=t},makeApiEndPoint:function(e,t){var r=e.indexOf("/api");return-1===r?(e.lastIndexOf("/")!==e.length-1&&(e+="/"),e+="api/"+t):e=e.substring(0,r)+"/api/"+t,e},makeServiceEndPoint:function(e,t){var r=e.indexOf("/api");return-1===r?(e.lastIndexOf("/")!==e.length-1&&(e+="/"),e+=t):e=e.substring(0,r)+"/"+t,e},parseAjaxError:function(e,t,r,o){return function(e,t,r,o){return i("**warning: AJAX call failure in "+e+": ["+r+"], ["+o+"], ["+t.responseText+"], ["+t.statusText+"]"),""===o||"Internal Server Error"===o?o="error"!==r?t.responseText||r:"object"==typeof t.responseJSON&&"string"==typeof t.responseJSON.Message?t.responseJSON.Message:"string"==typeof t.responseText?t.responseText:"Server or network error":"object"!=typeof t.responseJSON&&"string"==typeof t.responseText&&t.responseText.length>0&&(o=t.responseText),i(" error parsed to --\x3e ["+o+"]"),o}(e,t,r,o)},parseFetchError:function(e,t){const r="string"==typeof t?t:t.message;return i("**warning: FETCH call failure in "+e+": "+r),r}}}(),r=this,o=null;if(void 0!==r[e]&&(o=r[e]),r[e]=t,null!==o){var n=r[e];for(var i in o)o.hasOwnProperty(i)&&(n[i]=o[i])}t.scope=r}("MeadCo"),extendMeadCoNamespace("MeadCo.ScriptX.Print",(function(){const e="1.16.3.0",t="v1/printHtml",r="v1/printPdf",o="v1/printer";let n="";const i="ScriptX.Services//PrintPreview.1",a="[hold.clientside]",s="[wait.response]",c="[hold.ensureSpoolStatus]";var l={cookie:""};let d={};const u=this;let f=[];const p={serviceUrl:"",pendingUrl:"",failedUrl:"",verifiedUrl:"",orchestratorPort:0,orchestratorKey:"",portsToTry:10,verifying:!1,trustVerifiedConnection:!0,undoTrust:function(){this.trustVerifiedConnection||""===this.serviceUrl||(this.verifiedUrl=this.serviceUrl,this.pendingUrl=this.serviceUrl,this.serviceUrl="")},get url(){if(""!==this.verifiedUrl)return this.verifiedUrl;if(""===this.serviceUrl&&""!==this.pendingUrl){MeadCo.warn("[GET] servicesServer.url is not ready, performing synchronous search. Recommend code re-org to resolve the server earlier and asynchronously.");var e=this;this.verifyUrl(this.pendingUrl,!1,(function(){return e.serviceUrl}),(function(){return""}))}return this.serviceUrl},set url(e){MeadCo.log("servicesServer::setUrl: "+e),this.IsChangingServer(e)&&(MeadCo.log("note set as pending"),this.serviceUrl="",this.pendingUrl=e)},setUrlAsync:function(e,t,r){MeadCo.log("servicesServer::urlAsync: "+e),this.verifyUrl(e,!0,t,r)},verifyUrl:function(e,t,r,o){if(this.verifying&&t){MeadCo.warn("Verify called and verify in progress ....");var n=this,i=e;window.setTimeout((function(){n.verifyUrl(i,t,r,o)}),1e3)}else if(this.IsChangingServer(e)&&!this.IsFailedConnection(e)){var a;n=this,i=e,MeadCo.log("servicesServer::verifyurl: "+e+", async: "+t),"number"!=typeof this.orchestratorPort&&(this.orchestratorPort=parseInt(""+this.orchestratorPort)),this.orchestratorPort>0?(MeadCo.log("Using request to Orchestrator on port: "+this.orchestratorPort),n.verifying=!0,a="string"==typeof this.orchestratorKey&&this.orchestratorKey.length>0?"/api/v2?key="+this.orchestratorKey:"/api/v1",MeadCo.log("servicesServer::querying orchestrator: http://127.0.0.1:"+this.orchestratorPort+a),u.jQuery&&!MeadCo.fetchEnabled?u.jQuery.ajax("http://127.0.0.1:"+this.orchestratorPort+a,{method:"GET",dataType:"json",cache:!1,async:t}).done((function(e){MeadCo.log("orchestrator returned ScriptX.Services port: "+e.HttpPort);var a=new URL(i);a.port=e.HttpPort,i=a.protocol+"//"+a.host+a.pathname,n.test(i,0,t,(function(e){n.serviceUrl=e,n.pendingUrl="",n.verifying=!1,r(e,!0)}),(function(e){n.serviceUrl="",n.pendingUrl="",n.failedUrl=i,n.verifying=!1,"function"==typeof o&&o(e)}))})).fail((function(e,t,r){n.verifying=!1,n.serviceUrl="",n.pendingUrl="";const a=MeadCo.parseAjaxError("Failed to connect with Orchestrator: ",e,t,r);MeadCo.warn(a);try{new URL(i),n.failedUrl=i}catch(e){}"function"==typeof o&&o('ScriptX.Services (Orchestrator) could not be found at "'+i+'". Is it installed and running?')})):fetch("http://127.0.0.1:"+this.orchestratorPort+a).then((e=>{if(!e.ok)throw new Error(`HTTP Error: ${e.status}`);return e.json()})).then((e=>{MeadCo.log("orchestrator returned ScriptX.Services port: "+e.HttpPort);var a=new URL(i);a.port=e.HttpPort,i=a.protocol+"//"+a.host+a.pathname,n.test(i,0,t,(function(e){n.serviceUrl=e,n.pendingUrl="",n.verifying=!1,r(e,!0)}),(function(e){n.serviceUrl="",n.pendingUrl="",n.failedUrl=i,n.verifying=!1,"function"==typeof o&&o(e)}))})).catch((e=>{n.verifying=!1,n.serviceUrl="",n.pendingUrl="";try{new URL(i),n.failedUrl=i}catch(e){}"function"==typeof o&&o('ScriptX.Services (Orchestrator) could not be found at "'+i+'". Is it installed and running?')}))):(n.verifying=!0,n.test(i,n.portsToTry,t,(function(e){n.serviceUrl=e,n.pendingUrl="",n.verifying=!1,r(e,!1)}),(function(e){n.serviceUrl="",n.pendingUrl="",n.verifying=!1;try{new URL(i),n.failedUrl=i}catch(e){}"function"==typeof o&&o('ScriptX.Services could not be found at "'+i+'". Is it installed and running?')})))}else this.IsFailedConnection(e)?"function"==typeof o?o("ScriptX.Services connection to: "+e+" is either invalid or has already failed and will not be re-tried."):MeadCo.warn("ScriptX.Services connection to: "+e+" has already failed and will not be re-tried."):r(this.serviceUrl,this.orchestratorPort>0)},test:function(e,t,r,o,n){if(e.length>0){const i=this;let a;try{if(a=new URL(e),"http:"!==a.protocol&&"https:"!==a.protocol)return void n("Invalid protocol: "+e)}catch(t){return void n("Invalid URL: "+e)}MeadCo.log("Test server requested: "+e+", port: "+a.port);const s=MeadCo.makeApiEndPoint(a.href,"v1/licensing/ping");u.jQuery&&!MeadCo.fetchEnabled?(MeadCo.log(".ajax() get: "+s),u.jQuery.ajax(s,{method:"GET",dataType:"json",cache:!1,async:r}).done((function(e){const t=a.protocol+"//"+a.host+a.pathname;MeadCo.log("Test server succeed, resolve("+t+")"),o(t)})).fail((function(e,s,c){MeadCo.log("Test server failed: ["+c+"], "+t+", on: "+a.hostname),t>0&&("localhost"===a.hostname||"127.0.0.1"==a.hostname)?(a.port++,u.setTimeout(i.test(a.protocol+"//"+a.host+a.pathname,--t,r,o,n),1)):(c=MeadCo.parseAjaxError("MeadCo.ScriptX.Print.servicesServer.test:",e,s,c),"function"==typeof n?(MeadCo.log("rejecting with: "+c),n(c)):MeadCo.warn("failed with no reject function"))}))):(MeadCo.log("fetch get: "+s),r?fetch(s).then((e=>{if(!e.ok)throw new Error(`HTTP Error: ${e.status}`);return e.json()})).then((e=>{const t=a.protocol+"//"+a.host+a.pathname;MeadCo.log("Test server succeed, resolve("+t+")"),o(t)})).catch((e=>{MeadCo.log("Test server failed: ["+e+"], "+t+", on: "+a.hostname),t>0&&("localhost"===a.hostname||"127.0.0.1"==a.hostname)?(a.port++,u.setTimeout(i.test(a.protocol+"//"+a.host+a.pathname,--t,r,o,n),1)):(errorThrown=MeadCo.parseFetchError("MeadCo.ScriptX.Print.servicesServer.test:",e),"function"==typeof n?(MeadCo.log("rejecting with: "+errorThrown),n(errorThrown)):MeadCo.warn("failed with no reject function"))})):(MeadCo.error("Synchronous Ajax calls requires jQuery"),"function"==typeof n&&n("Synchronous Ajax calls requires jQuery")))}},call:function(e,t,r,o,n,i,a){const s=this;if(""===this.serviceUrl&&""!==this.pendingUrl)this.verifyUrl(this.pendingUrl,n,(function(){""!==s.url?s.call(e,t,r,o,n,i,a):"function"==typeof a&&a("Server url verification failed to set url")}),a);else if(""!==this.serviceUrl){const c=MeadCo.makeApiEndPoint(this.serviceUrl,e),l=window.location.href;MeadCo.log("servicesServer.call() "+t+": "+c);let d={method:t,cache:!1,async:n,jsonp:!1,dataType:"json",contentType:"application/json"};if(d.headers=o?{Authorization:"Basic "+btoa(g+":"),"X-Meadroid-Path":l}:{"X-Meadroid-Path":l},this.IsEmptyPayload(r)||(MeadCo.log("payload defined."),d.data=JSON.stringify(r)),u.jQuery&&!MeadCo.fetchEnabled)u.jQuery.ajax(c,d).done((function(e){return"function"==typeof i&&i(e),e})).fail((function(r,o,n){if(n=MeadCo.parseAjaxError("MeadCo.ScriptX.Print:"+e+t,r,o,n),"function"!=typeof a)throw new Error(n);a(n)})).always((function(e,t,r){s.undoTrust()}));else if(n)d.headers=o?{Authorization:"Basic "+btoa(g+":"),"X-Meadroid-Path":l,"Content-type":"application/json"}:{"X-Meadroid-Path":l,"Content-type":"application/json"},fetch(c,{method:d.method,headers:d.headers,body:d.data,referrerPolicy:"origin-when-cross-origin",mode:"cors",credentials:"omit",cache:"no-store",redirect:"error",keepalive:!1}).then((r=>{if(s.undoTrust(),r.ok)return r.json();if(500==r.status||404==r.status)r.text().then((r=>{const o=MeadCo.parseFetchError("MeadCo.ScriptX.Print:"+e+t,r);if("function"!=typeof a)throw new Error(o);a(o)}));else{if("function"!=typeof a)throw new Error(r.statusText);a(r.statusText)}})).then((e=>{e&&"function"==typeof i&&i(e)})).catch((r=>{const o=MeadCo.parseFetchError("MeadCo.ScriptX.Print:"+e+t,r);if("function"!=typeof a)throw new Error(o);a(o)}));else{if("function"!=typeof a)throw new Error("Synchronous Ajax calls requires jQuery");a("Synchronous Ajax calls requires jQuery")}}else{if("function"!=typeof a)throw new Error("MeadCo.ScriptX.Print : server connection is not defined.");a("MeadCo.ScriptX.Print : server connection is not defined.")}return!0},IsChangingServer:function(e){if(""!==this.serviceUrl)try{var t=new URL(this.serviceUrl),r=new URL(e);return t.hostname!=r.hostname||t.port!=r.port&&0==this.orchestratorPort}catch(t){return MeadCo.error("Failed to construct URL(): "+t.message+", from: "+this.serviceUrl+", or: "+e),MeadCo.error("Many errors will ensue"),!1}return!0},IsEmptyPayload:e=>null===e||0===Object.keys(e).length&&e.constructor===Object,IsFailedConnection:function(e){if(this.failedUrl.length>0)try{var t=new URL(this.failedUrl),r=new URL(e);return t.hostname===r.hostname&&(MeadCo.warn("Attempt to use: "+e+" is noted as a failed connection and will not be retried"),!0)}catch(t){return MeadCo.error("Testing IsFailed unable to construct URL(): "+t.message+", from: "+this.failedUrl+", or: "+e),!0}return!1}};var g="",h=!1,v=!1,C=[],y=null,m={URL:1,HTML:2,INNERHTML:4,STRING:8},M=0,S=1,w=2,P=3,E=4,b={REPORT:1,THROW:2},T=b.REPORT,U={CLOUD:1,ONPREMISE:2,WINDOWSPC:3},j={NOTSTARTED:0,QUEUED:1,STARTING:2,DOWNLOADING:3,DOWNLOADED:4,PRINTING:5,COMPLETED:6,PAUSED:7,PRINTPDF:8,ERROR:-1,ABANDONED:-2};function N(e){f.push(e),MeadCo.log("ScriptX.Print queueJob: "+e.jobIdentifier+", name: "+e.jobName+", jobCount: "+f.length)}function D(){return MeadCo.log("ScriptX.Print jobCount: "+f.length),f.length}function I(e){let t=(r=e.jobIdentifier,f.find((e=>e.jobIdentifier===r)));var r;t?Object.keys(e).forEach((function(r){t[r]=e[r]})):MeadCo.warn("Unable to find job: "+e.jobIdentifier+" to update it")}function L(e){f=f.filter((t=>t.jobIdentifier!==e)),MeadCo.log(`ScriptX.Print removed job: ${e}, jobCount: ${f.length}`),0==f.length&&(q=0)}function A(e,t,r){"function"==typeof e.OnProgress&&e.OnProgress(t,r,e.UserData)}var R="";function O(e,r,o,s,c,u,f){var g;MeadCo.log("started MeadCo.ScriptX.Print.print.printHtmlAtServer() Type: "+e),e===m.URL&&MeadCo.log(".. request print url: "+r),g=""===n?{}:n===i?JSON.parse(JSON.stringify({printerName:n})):JSON.parse(JSON.stringify(d[n]));var h={ContentType:e,Content:r,Settings:JSON.parse(JSON.stringify(o)),Device:g,ProtectedContentAccess:l,OnProgress:u,UserData:s},v={jobIdentifier:Date.now(),printerName:h.Device.printerName,jobName:a};N(v);var C=R;R="";var y=f;return function(){return L(v.jobIdentifier),G(t,h,{fail:function(e){A(h,j.ERROR,e),MeadCo.ScriptX.Print.reportError(e),"function"==typeof c&&c("Server error")},queuedToFile:function(e){MeadCo.log("print is being queued to a file"),A(h,j.QUEUED),Q(t,h,e.jobIdentifier,-1,(function(e){if(null!==e){MeadCo.log("download printed file is available"),A(h,j.COMPLETED);var r=MeadCo.makeApiEndPoint(p.url,t+"/download/"+e.jobIdentifier);C.length>0&&(r+="/"+C),y(r,e.jobIdentifier)}"function"==typeof c&&c(null===e?"Server error":null)}))},queuedToDevice:function(e){MeadCo.log("print was queued to device"),A(h,j.QUEUED),Q(t,h,e.jobIdentifier,-1,(function(e){null!==e&&A(h,j.COMPLETED),"function"==typeof c&&c(null===e?"Server error":null)}))},softError:function(e){A(h,j.ERROR,e.message),MeadCo.ScriptX.Print.reportError(e.message),MeadCo.log("print has soft error"),L(e.jobIdentifier),"function"==typeof c&&(MeadCo.log("Call fnDone"),c(e.message))},ok:function(e){A(h,j.COMPLETED),MeadCo.log("printed ok, no further information"),L(e.jobIdentifier),"function"==typeof c&&c(null)}})}}var X=0,q=0,k=750,F=1e4;function x(e,t,r,o){"string"==typeof e&&e.length>0?(MeadCo.log("Print server requested: "+e+" with license: "+t),g="string"==typeof t&&t.length>0?t:g,n="",d={},f=[],h=!1,C=[],"function"==typeof r?p.setUrlAsync(e,r,o):p.url=e):(MeadCo.log("Print server retained in setServer: "+p.url+" may update with license: {"+t+"} (if provided)"),g="string"==typeof t&&t.length>0?t:g)}function G(e,t,r){const o={jobIdentifier:Date.now(),printerName:t.Device.printerName,jobName:s};return MeadCo.log("printAtServer using: "+e),N(o),W(e+"/print","POST",t,!0,!0,(e=>{switch(MeadCo.log("Success response: "+e.status),e.printerName=t.Device.printerName,e.jobName="string"==typeof t.Settings.jobTitle&&t.Settings.jobTitle.length>0?t.Settings.jobTitle:"server job",N(e),L(o.jobIdentifier),e.status){case w:r.queuedToFile(e);break;case S:r.queuedToDevice(e);break;case P:case M:r.softError(e);break;case E:r.ok(e)}}),(e=>{L(o.jobIdentifier),"function"==typeof r.fail&&r.fail(e)}))}function J(e,t,r,o){return W(e,"GET",null,!0,t,r,o)}function W(e,t,r,o,n,i,a){return p.call(e,t,r,o,n,i,a)}function H(e,t,r,o,n,i){switch(MeadCo.log("processMonitorResponse::jobStatus: "+t.status),t.status){case j.COMPLETED:MeadCo.log("clear interval: "+r),window.clearInterval(r),L(o),i(t);break;case j.NOTSTARTED:case j.DOWNLOADED:case j.DOWNLOADING:case j.PRINTING:case j.QUEUED:case j.STARTING:case j.PAUSED:case j.PRINTPDF:A(e,t.status,t.message),I(t),n>0&&++counter*interval>n&&(window.clearInterval(r),MeadCo.ScriptX.Print.reportError("unknown failure while printing."));break;case j.ERROR:case j.ABANDONED:case j.CODEEXEPTION:MeadCo.log("error status in processMonitorResponse so clear interval: "+r),A(e,t.status,t.message),L(o),window.clearInterval(r),MeadCo.ScriptX.Print.reportError("The print failed with the error: "+t.message),i(null);break;default:A(e,t.status,t.message),MeadCo.log("unknown status in processMonitorResponse so clear interval: "+r),L(o),window.clearInterval(r),i(null)}}function Q(e,t,r,o,n){MeadCo.log("monitorJob: "+r);let i=!1,a=window.setInterval((function(){i?MeadCo.log("** info : still waiting for last status request to complete"):(i=!0,J(e+"/status/"+r,!0,(e=>{H(t,e,a,r,o,n),i=!1}),(e=>{MeadCo.log("error: "+e+" in monitorJob so clear interval: "+a),A(t,j.ERROR,e),L(r),window.clearInterval(a),n(null),i=!1})))}),1e3);MeadCo.log("intervalId: "+a)}function V(e){if("string"==typeof e.printerName){if(e.isDefault)for(var t=0;t<d.length;t++)d[t].isDefault=!1;d[e.printerName]=e,e.isDefault&&0===n.length&&(n=e.printerName)}}function K(e){e.name=e.name.replace(/\\/g,"||"),MeadCo.log("Request get device info: "+e.name),J(t+"/deviceinfo/"+encodeURIComponent(e.name)+"/0",e.async,(function(t){h=!0,V(t),"function"==typeof e.done&&e.done(t)}),(function(t){"systemdefault"===e.name?(MeadCo.warn("request for systemdefault printer failed - please update to ScriptX.Services 2.11.1"),e.name="default",K(e)):(MeadCo.log("failed to getdevice: "+t),"function"==typeof e.fail&&e.fail(t))}))}function B(e,t,r){"string"==typeof e&&""!==e?void 0===d[e]?K({name:e,async:!0,done:function(r){"systemdefault"===e.toLowerCase()&&(e=r.printerName),t(d[e])},fail:function(e){r(e)}}):t(d[e]):r("a printer name is required")}function $(e,t){console.warn("Synchronous calls to add/remove printer connections are not recommeneded as this will lock the browser UI. Consider using the asynchronous versions when working with in ScriptX.Services");var r=MeadCo.ScriptX.Print.serviceDescription();r.serviceClass==U.WINDOWSPC&&r.serviceVersion.major>=2&&r.serviceVersion.minor>=19?W(o+"/Connection/"+encodeURIComponent(t),e,null,!0,!1):MeadCo.error("ScriptX.Services for Windows PC 2.19 or later is required for add/remove PrinterConnection()")}function z(e,t,r,n){MeadCo.ScriptX.Print.serviceDescriptionAsync((function(i){i.serviceClass==U.WINDOWSPC&&i.serviceVersion.major>=2&&i.serviceVersion.minor>=19?W(o+"/Connection/"+encodeURIComponent(t),e,null,!0,!0,r,n):(MeadCo.error("ScriptX.Services for Windows PC 2.19 or later is required for add/remove PrinterConnection()"),n("add/remove PrinterConnection is not supported"))}),n)}return MeadCo.log("MeadCo.ScriptX.Print "+e+" loaded."),{ContentType:m,PrintStatus:j,ErrorAction:b,CollateOptions:{DEFAULT:0,TRUE:1,FALSE:2},DuplexOptions:{DEFAULT:0,SIMPLEX:1,VERTICAL:2,HORIZONTAL:3},MeasurementUnits:{DEFAULT:0,INCHES:1,MM:2},ServiceClasses:U,get onErrorAction(){return T},set onErrorAction(e){T=e},get orchestrator(){return p.orchestratorPort},set orchestrator(e){p.orchestratorPort=""+e},get orchestratorKey(){return p.orchestratorKey},set orchestratorKey(e){p.orchestratorKey=e},get authorisationCookie(){return l.cookie},set authorisationCookie(e){l.cookie=e},get printerName(){return n},set printerName(e){e!==n&&e.name!==n&&("string"==typeof e?void 0===d[e]?u.jQuery&&!MeadCo.fetchEnabled?K({name:e,done:function(e){n=e.printerName},async:!1,fail:function(e){MeadCo.ScriptX.Print.reportError(e)}}):(MeadCo.error("Asynchronous processing of set printerName required, synchronous calls to obtain device details will fail until this completes."),B(e,(e=>{n=e.printerName}),(e=>{MeadCo.ScriptX.Print.reportError(e)})),""===p.serviceUrl?MeadCo.ScriptX.Print.reportError("MeadCo.ScriptX.Print : server connection is not defined."):MeadCo.ScriptX.Print.reportError("Not Found")):n=e:K(e))},setSystemDefaultPrinterAsync:function(e,r,o){if(void 0!==d.systemdefault&&d.systemdefault==e)return MeadCo.log("setSystemDefaultPrinterAsync() does NOT need to do anything"),void r();e=(e="system::"+e).replace(/\\/g,"||"),MeadCo.log("Request systemDefaultPrinterAsync: "+e),W(t+"/CurrentPrinter/"+encodeURIComponent(e),"PUT",null,!0,!0,r,o)},get version(){return e},get serviceUrl(){return p.url},serviceVersion:function(){return this.serviceDescription().serviceVersion},serviceVersionAsync:function(e,t){this.serviceDescriptionAsync((function(t){e(t.serviceVersion)}),t)},get deviceSettings(){return""!==n?d[n]:{}},set deviceSettings(e){V(e)},deviceSettingsFor:function(e){return function(e){return"string"==typeof e&&""!==e?(void 0===d[e]&&K({name:e,async:!1,done:function(t){"systemdefault"===e.toLowerCase()&&(e=t.printerName)},fail:function(e){MeadCo.ScriptX.Print.reportError(e)}}),d[e]):{}}(e)},deviceSettingsForAsync:function(e,t,r){B(e,t,r)},useAttributes:function(){!function(){if(MeadCo.log("MeadCo.ScriptX.Print ... looking for auto connect, already found?: "+v),!v){var e=MeadCo.ScriptX.Print.HTML,t=MeadCo.ScriptX.Print,r=MeadCo.ScriptX.Print.Licensing;const o=document.querySelector("[data-meadco-subscription]");if(o){const n=o.dataset;MeadCo.log("Auto connect susbcription to: "+n.meadcoServer+", or "+n.meadcoPrinthtmlserver+", with subscription: "+n.meadcoSubscription+", sync: "+n.meadcoSyncinit+", usefetch: "+n.meadcoUsefetch);const i="false"!==(""+n.meadcoSyncinit).toLowerCase();if(i)MeadCo.fetchEnabled=!1;else{const e=""+n.meadcoUsefetch;e.length>0&&(MeadCo.fetchEnabled="true"===e.toLowerCase())}const a=n.meadcoServer;void 0===a&&(a=n.meadcoPrinthtmlserver),void 0===a?MeadCo.error("No server specified"):(void 0!==r&&r.connect(a,n.meadcoSubscription),i?(MeadCo.warn("Synchronous connection is deprecated.jQuery is required for synchronous behaviour.To update to asynchronous behaviour please use data - meadco - syncinit='false'. Note that this may require additional code changes. Please see: https://www.meadroid.com/Developers/KnowledgeBank/HowToGuides/ScriptXServices/ThenToNow/Stage6"),e.connect(a,n.meadcoSubscription)):(MeadCo.log("Async connectlite..."),t.connectLite(a,n.meadcoSubscription)),v=!0)}else{const o=document.querySelector("[data-meadco-license]");if(o)if(void 0===t||void 0===e||void 0===r)MeadCo.log("Not auto-connecting client license as print or printHtml or license API not present. Should be present on next attempt.");else{const n=o.dataset;MeadCo.log("Auto connect client license to: "+n.meadcoServer+", with license: "+n.meadcoLicense+", path: "+n.meadcoLicensePath+", revision: "+n.meadcoLicenseRevision+", sync: "+n.meadcoSyncinit+", useFetch: "+n.meadcoUsefetch+", orchestrator: "+n.meadcoOrchestrator+", orchestratorKey: "+n.meadcoOrchestratorKey+", trustVerifiedConnection: "+n.meadcoTrustVerifiedConnection);const i="false"!==(""+n.meadcoSyncinit).toLowerCase(),a="false"!==(""+n.meadcoReporterror).toLowerCase(),s="true"==(""+n.meadcoApplyLicense).toLowerCase(),c=n.meadcoServer;if(p.orchestratorPort=n.meadcoOrchestrator,p.orchestratorKey=n.meadcoOrchestratorKey,p.trustVerifiedConnection="false"!==(""+n.meadcoTrustVerifiedConnection).toLowerCase(),i)MeadCo.warn("Synchronous connection is deprecated. jQuery is required for synchronous behaviour. To update to asynchronous behaviour please use data-meadco-syncinit='false'. Note that this may require additional code changes. Please see: https://www.meadroid.com/Developers/KnowledgeBank/HowToGuides/ScriptXServices/ThenToNow/Stage6"),MeadCo.fetchEnabled=!1,r.connect(c,n.meadcoLicense),void 0!==n.meadcoLicensePath&&void 0!==n.meadcoLicenseRevision&&(r.apply(n.meadcoLicense,n.meadcoLicenseRevision,n.meadcoLicensePath),0!=r.result&&a&&MeadCo.ScriptX.Print.reportError(r.errorMessage)),e.connect(c,n.meadcoLicense);else{MeadCo.log("Async connectlite...");const e=""+n.meadcoUsefetch;e.length>0&&(MeadCo.fetchEnabled="true"===e.toLowerCase()),r.connectLite(c,n.meadcoLicense,n.meadcoLicenseRevision,n.meadcoLicensePath),t.connectLite(c,n.meadcoLicense),s&&r.applyAsync(n.meadcoLicense,n.meadcoLicenseRevision,n.meadcoLicensePath,(()=>{MeadCo.log("NOTE: license has been applied successfully from async processing of attribute with values")}),(e=>{MeadCo.error(`Failed to apply the license: ${e}, error is: ${r.errorMessage}`),a&&MeadCo.ScriptX.Print.reportError(r.errorMessage)}))}v=!0}}}}()},connect:function(e,t){!function(e,t){x(e,t),K({name:"systemdefault",async:!1}),J("",!0,(function(e){y=e}))}(e,t)},connectLite:function(e,t){x(e,t)},connectAsync:function(e,t,r,o){!function(e,t,r,o){x(e,t,(function(e){K({name:"systemdefault",done:r,async:!0,fail:o}),J("",!0,(function(e){y=e}))}),o)}(e,t,r,o)},connectTestAsync:function(e,t,r){p.verifyUrl(e,!0,t,r)},serviceDescription:function(){return y||J("",!1,(function(e){y=e}),(function(e){MeadCo.ScriptX.Print.reportError(e.message)})),y},serviceDescriptionAsync:function(e,t){y?e(y):J("",!0,(function(t){y=t,e(t)}),t)},waitableServiceDescription:function(){return new Promise(((e,t)=>{this.serviceDescriptionAsync(e,t)}))},connectDeviceAndPrinters:function(e,t){h=!0,V(e),C=t},get isConnected(){return h},get availablePrinterNames(){return C},addPrinterConnection:function(e){$("PUT",e)},removePrinterConnection:function(e){$("DELETE",e)},addPrinterConnectionAsync:function(e,t,r){z("PUT",e,t,r)},removePrinterConnectionAsync:function(e,t,r){z("DELETE",e,t,r)},getFromServer:function(e,r,o,n){J(t+e,r,o,n)},printHtml:function(e,t,r,o,n,i){if(!t||"string"==typeof t&&0===t.length)return MeadCo.ScriptX.Print.reportError("Request to print no content - access denied?"),"function"==typeof o&&o("Request to print no content"),!1;var a=Date.now();return a-q>F&&(X=0),q=a,setTimeout(O(e,t,r,i,o,n,(function(e){window.open(e,"_self")})),X),X+=k,!0},requestHtmlPreview:function(e,t,r,o,a){var s=n;n=i,O(e,t,r,{},o,(function(){}),a)(),n=s},printPdf:function(e,t,o,i,s){if(!e||"string"==typeof e&&0===e.length)return MeadCo.ScriptX.Print.reportError("The document to print must be given."),"function"==typeof o&&o("Request to print no content"),!1;const c=Date.now();return c-q>F&&(X=0),q=c,setTimeout(function(e,t,o,i,s){let c;MeadCo.log("started MeadCo.ScriptX.Print.print.printPdfAtServer() document: "+e+", printerName: "+n),c=""===n?{}:JSON.parse(JSON.stringify(d[n]));const u={Document:e,Description:t.jobDescription,Settings:JSON.parse(JSON.stringify(t)),Device:c,ProtectedContentAccess:l,OnProgress:i,UserData:s};u.Settings.jobTitle=t.jobDescription;const f={jobIdentifier:Date.now(),printerName:u.Device.printerName,jobName:a};N(f);var g=R;return R="",function(){return L(f.jobIdentifier),G(r,u,{fail:function(e){A(u,j.ERROR,e),MeadCo.ScriptX.Print.reportError(e),"function"==typeof o&&o("Server error")},queuedToFile:function(e){MeadCo.log("default handler on queued to file response"),A(u,j.QUEUED),Q(r,u,e.jobIdentifier,-1,(function(e){if(null!==e){MeadCo.log("Will download printed file"),A(u,j.COMPLETED);let t=MeadCo.makeApiEndPoint(p.url,r+"/download/"+e.jobIdentifier);g.length>0&&(t+="/"+g),window.open(t,"_self")}"function"==typeof o&&o(null===e?"Server error":null)}))},queuedToDevice:function(e){MeadCo.log("print was queued to device"),A(u,j.QUEUED),Q(r,u,e.jobIdentifier,-1,(function(e){null!==e&&A(u,j.COMPLETED),"function"==typeof o&&o(null===e?"Server error":null)}))},softError:function(e){A(u,j.ERROR,e.message),MeadCo.ScriptX.Print.reportError(e.message),MeadCo.log("printpdf call has soft error, remove job: "+e.jobIdentifier),L(e.jobIdentifier),"function"==typeof o&&(MeadCo.log("Call fnDone"),o("Server error"))},ok:function(e){A(u,j.COMPLETED),MeadCo.log("printed ok, no further information"),L(e.jobIdentifier),"function"==typeof o&&o(null)}})}}(e,t,o,i,s),X),X+=k,!0},printDirect:function(e,t,r){if(MeadCo.log("started MeadCo.ScriptX.Print.print.printDirectAtServer() Type: "+e+", printerName: "+n),e===m.URL)MeadCo.log(".. request print url: "+t);else if(e!==m.STRING)return MeadCo.ScriptX.Print.reportError("Bad content type for direct printing"),"function"==typeof r&&r("Bad content type for direct printing"),!1;return!t||"string"==typeof t&&0===t.length?(MeadCo.ScriptX.Print.reportError("Request to print no content - access denied?"),"function"==typeof r&&r("Request to print no content"),!1):""===n?(MeadCo.ScriptX.Print.reportError("Request to print but no current printer defined."),"function"==typeof r&&r("Request to print but no current printer defined."),!1):G("v1/printDirect",{ContentType:e,Content:t,PrinterName:n,Settings:{jobTitle:"Direct print"},Device:d[n]},{fail:function(e){MeadCo.ScriptX.Print.reportError(e),"function"==typeof r&&r("Server error")},softError:function(e){MeadCo.ScriptX.Print.reportError(e.message),MeadCo.log("print has soft error"),L(e.jobIdentifier),"function"==typeof r&&(MeadCo.log("Call fnDone"),r(e.message))},ok:function(e){MeadCo.log("printed ok, no further information"),L(e.jobIdentifier),"function"==typeof r&&r(null)}})},parseAjaxError:function(e,t,r,o){return MeadCo.parseAjaxError(e,t,r,o)},parseFetchError:function(e,t){return MeadCo.parseFetchError(e,t)},reportError:function(e){switch(MeadCo.error("ReportError: "+e),T){case b.REPORT:MeadCo.ScriptX.Print.reportServerError(e);break;case b.THROW:throw new Error(e)}},reportServerError:function(e){alert("There was an error in the printing service\n\n"+e)},reportFeatureNotImplemented:function(e){MeadCo.log("Call to not implemented: "+e),alert(e+"\n\nis not available.")},get queue(){return f},get activeJobs(){return this.queue.filter((e=>e.jobName!==a&&e.jobName!==s&&e.jobName!==c)).length},get clientSideJobs(){return this.queue.filter((e=>e.jobName==a||e.jobName==s||e.jobName==c)).length},get noJobsWaitingDelivery(){return this.queue.every((e=>e.jobName!==a&&e.jobName!==s&&e.jobName!==c))},ensureSpoolingStatus:function(){var e={jobIdentifier:Date.now(),printerName:"ensureJobsPrinter",jobName:c};return N(e),e},freeSpoolStatus:function(e){L(e.jobIdentifier)},get isSpooling(){return D()>0},waitForSpoolingComplete:function(e,t){if(MeadCo.log("Started WaitForSpoolingComplete("+e+")"),"function"!=typeof t)throw"WaitForSpoolingComplete requires a completion callback";var r=Date.now(),o=window.setInterval((function(){0===D()?(MeadCo.log("WaitForSpoolingComplete - complete"),window.clearInterval(o),t(!0)):e>=0&&Date.now()-r>e&&(MeadCo.log("WaitForSpoolingComplete - timeout"),window.clearInterval(o),t(0===D()))}),250)},waitForDeliveryComplete:function(e,t){if(MeadCo.log("Started waitForDeliveryComplete("+e+")"),"function"!=typeof t)throw"waitForDeliveryComplete requires a completion callback";const r=Date.now(),o=this,n=window.setInterval((()=>{o.noJobsWaitingDelivery?(MeadCo.log("waitForDeliveryComplete - complete"),window.clearInterval(n),t(!0)):e>=0&&Date.now()-r>e&&(MeadCo.log("waitForDeliveryComplete - timeout"),window.clearInterval(n),t(!1))}),250)},waitForDeliveryCompleteAsync:function(){const e=this;return new Promise((function(t,r){e.waitForDeliveryComplete(-1,t)}))},get queueTimeoutSpacing(){return k},set queueTimeoutSpacing(e){k=e},get queueGapResetTime(){return F},set queueGapResetTime(e){F=e},get jobFileName(){return R},set jobFileName(e){R=e},requestService:function(e,t,r,o,n,i,a){return W(e,t,r,o,n,i,a)},getService:function(e,t,r){return W(e,"GET",t,r,!1)},postService:function(e,t,r){return W(e,"POST",t,r,!1)},getServiceAsync:function(e,t,r,o,n){return W(e,"GET",t,r,!0,o,n)},postServiceAsync:function(e,t,r,o,n){return W(e,"POST",t,r,!0,o,n)}}})),extendMeadCoNamespace("MeadCo.ScriptX.Print.Licensing",(function(){const e="1.16.3.0",t="v1/licensing";let r="",o=0,n="",i="No license applied";var a={};function s(e,t){var s=MeadCo.ScriptX.Print;void 0!==s&&"function"==typeof s.connectLite?s.connectLite(e,t):console.error("MeadCo.ScriptX.Print is not available"),r=t,a={},i="No license applied",o=0,n=""}function c(e,r){const o=MeadCo.ScriptX.Print;if(void 0===o||"function"!=typeof o.connectLite){var n="MeadCo.ScriptX.Licensing : MeadCo.ScriptX.Print API not available";if("function"==typeof r)return void r(n);throw new Error(n)}return a.length>0?("function"==typeof e&&e(a),a):(o.requestService(t,"GET",{},!0,"function"==typeof e,(function(t){i="",a={...a,...t},"function"!=typeof e||e(a)}),(function(e){i=e,"function"!=typeof r?MeadCo.warn("No reject function for: "+i):r(i)})),a)}function l(e,o,n,s,c){MeadCo.log("Apply license: "+e+",revision: "+o+", path: "+n);const l=MeadCo.ScriptX.Print;if(void 0===l||"function"!=typeof l.connectLite){var d="MeadCo.ScriptX.Licensing : MeadCo.ScriptX.Print API not available";if("function"==typeof c)return void c(d);MeadCo.warn("No reject function for: "+d)}const u=n.toLowerCase();"warehouse"!==u&&"securewarehouse"!==u&&(n=new URL(n,window.location.href).href,MeadCo.log("path updated to: "+n)),r=e;const f={Guid:e,Url:n,Revision:o};return l.requestService(t,"POST",f,!1,"function"==typeof s,(function(e){i="",a={...a,...e},"function"!=typeof s||s(a)}),(function(e){i=e,"function"!=typeof c||c(i)})),"function"!=typeof s?(MeadCo.log("returning applied (sync) license: "+a.company),a):0}return MeadCo.log("MeadCo.ScriptX.Print.Licensing "+e+" loaded."),{get version(){return e},connect:function(e,t){s(e,t)},connectLite:function(e,t,r,i){s(e,t),o=r,n=i},apply:function(e,t,r){return l(e,t,r)},applyAsync:function(e,t,r,o,n){l(e,t,r,o,n)},get result(){return""===i?0:5},get validLicense(){return void 0!==a.guid},get errorMessage(){return i},get detailOnError(){return i},get License(){return void 0!==a.guid?a:c(null,(function(e){throw new Error(e)}))},GetLicenseAsync:function(e,t){c(e,t)},PolyfillInit:function(){return void 0!==a.guid||""!==r&&(""===n||(l(r,o,n),void 0!==a.guid))},PolyfillInitAsync:function(e,t){void 0!==a.guid||""===n?e(a):l(r,o,n,e,t)}}})),function(e,t,r){if(this[e]!==r||null!==document.getElementById(e)){if(MeadCo.log("ScriptX.Services MeadCo Security Manager emulation believes it may not be required."),this[e]!==r&&MeadCo.log("this["+e+"] is defined"),null!==document.getElementById(e)&&MeadCo.log("document.getElementById("+e+") is defined"),this[e].object!==r)return void MeadCo.log("this["+e+"].object is defined -- not required!!!");MeadCo.log("this["+e+"].object is *not* defined")}MeadCo.log("ScriptX.Services MeadCo Security Manager emulation believes it is required.");var o=function(){const e=MeadCo,t=MeadCo.ScriptX.Print,r=MeadCo.ScriptX.Print.Licensing;function o(t){e.log("secmgr emulation :: "+t)}return this.extendSecMgrNamespace=function(e,t){const r=t();o("MeadCo security manager extending namespace2: "+e);const n=e.split(".");let i=this;for(let e=0;e<n.length;e++){const t=n[e];e===n.length-1?void 0===i[t]?(o("installing implementation at: "+t),i[t]=r):o("Warning - not overwriting package: "+t):void 0===i[t]?(o("initialising new: "+t),i[t]={}):o("using existing package: "+t),i=i[t]}},o("'secmgr' loaded."),"function"!=typeof r.GetLicenseAsync&&MeadCo.error("MeadCo.ScriptX.Print.Licensing not available"),"function"!=typeof t.useAttributes?MeadCo.warn("Attribute based licensing not available as MeadCo.ScriptX.Print is not available"):t.useAttributes(),{log:o,get version(){return"1.16.3.0"},get result(){return r.result},get validLicense(){return r.validLicense},get License(){return r.License},get errorMessage(){return r.errorMessage},GetLicenseAsync:function(e,t){r.GetLicenseAsync(e,t)},PolyfillInit:function(){return r.PolyfillInit()},PolyfillInitAsync:function(e,t){r.PolyfillInitAsync(e,t)}}}();this[e]=o}("secmgr"),"function"==typeof extendSecMgrNamespace&&extendSecMgrNamespace("secmgr.object",(function(){return this.secmgr.log("secmgr.object loaded."),this.secmgr}));
//# sourceMappingURL=meadco-scriptxserviceslicensing.min.js.map