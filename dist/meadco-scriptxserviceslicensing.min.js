!function(e,r){var n=function(){var d=this,e="1.11.0.2",r="undefined"!=typeof MeadCo&&void 0!==MeadCo.logEnable&&MeadCo.logEnable,c=function(e){r&&console.log("MeadCo :: "+e)},i=function(e){console.error("MeadCo :: "+e)};return d.extendMeadCoNamespace=function(e,r){var n=r();c("MeadCo root extending namespace: "+e);for(var o=e.split("."),t=d.scope||this.jQuery||this.ender||this.$||this,s=0;s<o.length;s++){var a=o[s];if(s===o.length-1)if(void 0===t[a])c("installing implementation at: "+a),t[a]=n;else{c("Warning - extending package: "+a);var i=t[a];t[a]=n;var l=t[a];for(var p in c("preserving old scope ... "),i)i.hasOwnProperty(p)&&(c("will preserve: "+p),l[p]=i[p])}else void 0===t[a]?(c("initialising new: "+a),t[a]={}):c("using existing package: "+a);t=t[a]}},c("MeadCo root namespace "+e+" loaded."),{log:c,warn:function(e){console.warn("MeadCo :: "+e)},error:i,get version(){return e},get logEnabled(){return r},set logEnabled(e){r=e},createNS:function(e){var r=e.split("."),n=d.scope.MeadCo;"MeadCo"===r[0]&&(r=r.slice(1));for(var o=0;o<r.length;o++){var t=r[o];void 0===n[t]&&(n[t]={}),n=n[t]}return n},set scope(e){d.scope=e},makeApiEndPoint:function(e,r){var n=e.indexOf("/api");return-1===n?(e.lastIndexOf("/")!==e.length-1&&(e+="/"),e+="api/"+r):e=e.substr(0,n)+"/api/"+r,e},makeServiceEndPoint:function(e,r){var n=e.indexOf("/api");return-1===n?(e.lastIndexOf("/")!==e.length-1&&(e+="/"),e+=r):e=e.substr(0,n)+"/"+r,e},parseAjaxError:function(e,r,n,o){return i("**warning: AJAX call failure in "+e+": ["+(s=n)+"], ["+(a=o)+"], ["+(t=r).responseText+"], ["+t.statusText+"]"),""===a||"Internal Server Error"===a?a="error"!==s?t.responseText||s:"object"==typeof t.responseJSON&&"string"==typeof t.responseJSON.Message?t.responseJSON.Message:"string"==typeof t.responseText?t.responseText:"Server or network error":"object"!=typeof t.responseJSON&&"string"==typeof t.responseText&&0<t.responseText.length&&(a=t.responseText),i(" error parsed to --\x3e ["+a+"]"),a;var t,s,a}}}(),o=this,t=null;if(void 0!==o[e]&&(t=o[e]),o[e]=n,null!==t){var s=o[e];for(var a in t)t.hasOwnProperty(a)&&(s[a]=t[a])}n.scope=o}("MeadCo");
extendMeadCoNamespace("MeadCo.ScriptX.Print",function(){var e="1.11.0.20",p="v1/printHtml",u="v1/printPdf",n="v1/printDirect",v="",g="ScriptX.Services//PrintPreview.1",m={cookie:""},h={},d=this,s=[],C={serviceUrl:"",pendingUrl:"",failedUrl:"",orchestratorPort:0,portsToTry:10,verifying:!1,get url(){if(""===this.serviceUrl&&""!==this.pendingUrl){MeadCo.warn("[GET] servicesServer.url is not ready, performing synchronous search. Recommend code re-org to resolve the server earlier and asynchronously.");var e=this;this.verifyUrl(this.pendingUrl,!1,function(){return e.serviceUrl},function(){return""})}return this.serviceUrl},set url(e){MeadCo.log("servicesServer::setUrl: "+e),this.IsChangingServer(e)&&(MeadCo.log("note set as pending"),this.serviceUrl="",this.pendingUrl=e)},urlAsync:function(e,r,t){MeadCo.log("servicesServer::urlAsync: "+e),this.verifyUrl(e,!0,r,t)},verifyUrl:function(e,n,o,i){if(this.verifying&&n){console.warn("Verify called and verify in progress ....");var a=this,c=e;window.setTimeout(function(){a.verifyUrl(c,n,o,i)},1e3)}else if(this.IsChangingServer(e)&&!this.IsFailedConnection(e)){var a=this,c=e;MeadCo.log("servicesServer::verifyurl: "+e+", async: "+n),"number"!=typeof this.orchestratorPort&&(this.orchestratorPort=parseInt(""+this.orchestratorPort)),0<this.orchestratorPort?(MeadCo.log("Using request to Orchestrator on port: "+this.orchestratorPort),a.verifying=!0,d.jQuery.ajax("http://127.0.0.1:"+this.orchestratorPort+"/api/v1",{method:"GET",dataType:"json",cache:!1,async:n}).done(function(e){MeadCo.log("orchestrator returned ScriptX.Services port: "+e.HttpPort);var r=new URL(c);r.port=e.HttpPort,c=r.protocol+"//"+r.host+r.pathname,a.test(c,0,n,function(e){a.serviceUrl=e,a.pendingUrl="",a.verifying=!1,o(e)},function(e){a.serviceUrl="",a.pendingUrl="",a.failedUrl=c,a.verifying=!1,"function"==typeof i&&i(e)})}).fail(function(e,r,t){a.verifying=!1,MeadCo.warn(MeadCo.parseAjaxError("Failed to connect with orchestrator: ",e,r,t)),MeadCo.log("Will try unorchestrated url"),a.orchestratorPort=0,a.verifyUrl(c,n,o,i)})):(a.verifying=!0,a.test(c,a.portsToTry,n,function(e){a.serviceUrl=e,a.pendingUrl="",a.verifying=!1,o(e)},function(e){a.serviceUrl="",a.pendingUrl="",a.verifying=!1,a.failedUrl=c,"function"==typeof i&&i("ScriptX.Services could not be found at "+c)}))}else o(this.serviceUrl)},test:function(e,n,o,i,a){if(0<e.length)if(d.jQuery){var c=this,s=new URL(e);MeadCo.log("Test server requested: "+e+", port: "+s.port);var r=MeadCo.makeApiEndPoint(s.href,"v1/licensing/ping");MeadCo.log(".ajax() get: "+r),d.jQuery.ajax(r,{method:"GET",dataType:"json",cache:!1,async:o}).done(function(e){i(s.protocol+"//"+s.host+s.pathname)}).fail(function(e,r,t){0<n&&("localhost"===s.hostname||"127.0.0.1"==s.hostname)?(s.port++,d.setTimeout(c.test(s.protocol+"//"+s.host+s.pathname,--n,o,i,a),1)):(t=MeadCo.parseAjaxError("MeadCo.ScriptX.Print.servicesServer.test:",e,r,t),"function"==typeof a&&a(t))})}else MeadCo.error("jQuery is required by ScriptX.Services")},call:function(n,o,e,r,t,i,a){if(""===this.serviceUrl&&""!==this.pendingUrl){var c=this;this.verifyUrl(this.pendingUrl,t,function(){""!==c.url?c.call(n,o,e,r,t,i,a):"function"==typeof a&&a("Server url verification failed to set url")},a)}else if(d.jQuery)if(""!==this.serviceUrl){var s=MeadCo.makeApiEndPoint(this.serviceUrl,n);MeadCo.log("servicesServer.call() "+o+": "+s);var l={method:o,cache:!1,async:t,jsonp:!1,dataType:"json",contentType:"application/json"};r&&(l.headers={Authorization:"Basic "+btoa(f+":")}),"object"==typeof e&&null!==e&&(MeadCo.log("payload defined."),l.data=JSON.stringify(e)),d.jQuery.ajax(s,l).done(function(e){return"function"==typeof i&&i(e),e}).fail(function(e,r,t){t=MeadCo.parseAjaxError("MeadCo.ScriptX.Print:"+n+o,e,r,t),"function"==typeof a&&a(t)})}else{if("function"!=typeof a)throw new Error("MeadCo.ScriptX.Print : server connection is not defined.");a("MeadCo.ScriptX.Print : server connection is not defined.")}else{if("function"!=typeof a)throw new Error("MeadCo.ScriptX.Print : no known ajax helper available");a("MeadCo.ScriptX.Print : no known ajax helper available")}},IsChangingServer:function(r){if(""!==this.serviceUrl)try{var e=new URL(this.serviceUrl),t=new URL(r);return e.hostname!=t.hostname}catch(e){return console.error("Failed to construct URL(): "+e.message+", from: "+this.serviceUrl+", or: "+r),console.error("Many errors will ensue"),!1}return!0},IsFailedConnection:function(r){if(0<this.failedUrl.length)try{var e=new URL(this.failedUrl),t=new URL(r);return e.hostname===t.hostname&&(console.warn("Attempt to use: "+r+" is noted as a failed connection and will not be retried"),!0)}catch(e){return console.error("Testing IsFailed unable to construct URL(): "+e.message+", from: "+this.failedUrl+", or: "+r),!0}return!1}},f="",o=!1,l=!1,i=[],a=null,y={URL:1,HTML:2,INNERHTML:4,STRING:8},t={UNKNOWN:0,QUEUEDTODEVICE:1,QUEUEDTOFILE:2,SOFTERROR:3,OK:4},r={REPORT:1,THROW:2},c=r.REPORT,S={NOTSTARTED:0,QUEUED:1,STARTING:2,DOWNLOADING:3,DOWNLOADED:4,PRINTING:5,COMPLETED:6,PAUSED:7,PRINTPDF:8,ERROR:-1,ABANDONED:-2};function M(e){s.push(e),MeadCo.log("ScriptX.Print queueJob: "+e.jobName+", jobCount: "+s.length)}function E(){return MeadCo.log("ScriptX.Print jobCount: "+s.length),s.length}function P(e){var r;for(r=0;r<s.length;r++)if(s[r].jobIdentifier===e)return MeadCo.log("ScriptX.Print removing job: "+s[r].jobName),s.splice(r,1),MeadCo.log("ScriptX.Print remove job, jobCount: "+s.length),void(0==s.length&&(U=0));console.warn("Unable to find job: "+e+" to remove it")}function b(e,r,t){"function"==typeof e.OnProgress&&e.OnProgress(r,t,e.UserData)}var j="";function w(e,r,t,n,o,i,a){var c;MeadCo.log("started MeadCo.ScriptX.Print.print.printHtmlAtServer() Type: "+e),e===y.URL&&MeadCo.log(".. request print url: "+r),c=""===v?{}:v===g?JSON.parse(JSON.stringify({printerName:v})):JSON.parse(JSON.stringify(h[v]));var s={ContentType:e,Content:r,Settings:JSON.parse(JSON.stringify(t)),Device:c,ProtectedContentAccess:m,OnProgress:i,UserData:n},l={jobIdentifier:Date.now(),printerName:s.Device.printerName,jobName:"Job timeout hold clientside"};M(l);var u=j;j="";var d=MeadCo.makeApiEndPoint(C.url,p),f=a;return function(){return P(l.jobIdentifier),O(d,s,{fail:function(e,r,t){var n=MeadCo.parseAjaxError("MeadCo.ScriptX.Print.printHtmlAtServer",e,r,t);b(s,S.ERROR,n),MeadCo.ScriptX.Print.reportError(n),"function"==typeof o&&o("Server error")},queuedToFile:function(e){MeadCo.log("print is being queued to a file"),b(s,S.QUEUED),L(d,s,e.jobIdentifier,-1,function(e){if(null!==e){MeadCo.log("download printed file is available"),b(s,S.COMPLETED);var r=d+"/download/"+e.jobIdentifier;0<u.length&&(r+="/"+u),f(r,e.jobIdentifier)}"function"==typeof o&&o(null===e?"Server error":null)})},queuedToDevice:function(e){MeadCo.log("print was queued to device"),b(s,S.QUEUED),L(d,s,e.jobIdentifier,-1,function(e){null!==e&&b(s,S.COMPLETED),"function"==typeof o&&o(null===e?"Server error":null)})},softError:function(e){b(s,S.ERROR,e.message),MeadCo.ScriptX.Print.reportError(e.message),MeadCo.log("print has soft error"),P(e.jobIdentifier),"function"==typeof o&&(MeadCo.log("Call fnDone"),o(e.message))},ok:function(e){b(s,S.COMPLETED),MeadCo.log("printed ok, no further information"),P(e.jobIdentifier),"function"==typeof o&&o(null)}})}}var T=0,U=0,D=750,R=1e4;function N(e,r,t,n){"string"==typeof e&&0<e.length?(MeadCo.log("Print server requested: "+e+" with license: "+r),f="string"==typeof r&&0<r.length?r:f,v="",h={},o=!(s=[]),i=[],"function"==typeof t?C.urlAsync(e,t,n):C.url=e):(MeadCo.log("Print server retained: "+C.url+" update with license: "+r),f="string"==typeof r&&0<r.length?r:f)}function O(e,r,n){if(C.url.length<=0)throw new Error("MeadCo.ScriptX.Print : print server URL is not set or is invalid");var o={jobIdentifier:Date.now(),printerName:r.Device.printerName,jobName:"Job starting"};if(d.jQuery)return MeadCo.log(".ajax() post to: "+e),M(o),d.jQuery.ajax(e+"/print",{data:JSON.stringify(r),dataType:"json",contentType:"application/json",method:"POST",headers:{Authorization:"Basic "+btoa(f+":")}}).done(function(e){switch(MeadCo.log("Success response: "+e.status),e.printerName=r.Device.printerName,e.jobName=r.Settings.jobTitle,M(e),P(o.jobIdentifier),e.status){case t.QUEUEDTOFILE:n.queuedToFile(e);break;case t.QUEUEDTODEVICE:n.queuedToDevice(e);break;case t.SOFTERROR:case t.UNKNOWN:n.softError(e);break;case t.OK:n.ok(e)}}).fail(function(e,r,t){P(o.jobIdentifier),"function"==typeof n.fail&&n.fail(e,r,t)}),!0;if("function"!=typeof n.fail)throw new Error("MeadCo.ScriptX.Print : no known ajax helper available");n.fail("MeadCo.ScriptX.Print : no known ajax helper available")}function I(e,r,t,n){return A(e,"GET",null,!0,r,t,n)}function A(e,r,t,n,o,i,a){return C.call(e,r,t,n,o,i,a)}function L(e,n,o,r,i){MeadCo.log("monitorJob: "+o);var t=0,a=!1,c=window.setInterval(function(){a?MeadCo.log("** info : still waiting for last status request to complete"):(MeadCo.log("Going to request status with .ajax"),a=!0,jQuery.ajax(e+"/status/"+o,{dataType:"json",method:"GET",cache:!1,headers:{Authorization:"Basic "+btoa(f+":")}}).done(function(e){switch(MeadCo.log("jobStatus: "+e.status),e.status){case S.COMPLETED:MeadCo.log("clear interval: "+c),window.clearInterval(c),P(o),i(e);break;case S.NOTSTARTED:case S.DOWNLOADED:case S.DOWNLOADING:case S.PRINTING:case S.QUEUED:case S.STARTING:case S.PAUSED:case S.PRINTPDF:b(n,e.status,e.message),function(r){var t;for(t=0;t<s.length;t++)if(s[t].jobIdentifier===r.jobIdentifier)return Object.keys(r).forEach(function(e){s[t][e]=r[e]});console.warn("Unable to find job: "+r.jobIdentifier+" to update it")}(e),0<r&&1e3*++t>r&&(window.clearInterval(c),MeadCo.ScriptX.Print.reportError("unknown failure while printing.")),a=!1;break;case S.ERROR:case S.ABANDONED:MeadCo.log("error status in monitorJob so clear interval: "+c),b(n,e.status,e.message),P(o),window.clearInterval(c),MeadCo.ScriptX.Print.reportError("The print failed with the error: "+e.message),i(null);break;default:b(n,e.status,e.message),MeadCo.log("unknown status in monitorJob so clear interval: "+c),P(o),window.clearInterval(c),i(null)}}).fail(function(e,r,t){t=MeadCo.parseAjaxError("MeadCo.ScriptX.Print.monitorJob:",e,r,t),MeadCo.log("error: "+t+" in monitorJob so clear interval: "+c),b(n,S.ERROR,t),P(o),window.clearInterval(c),i(null)}))},1e3);MeadCo.log("intervalId: "+c)}function X(e){if("string"==typeof e.printerName){if(e.isDefault)for(var r=0;r<h.length;r++)h[r].isDefault=!1;(h[e.printerName]=e).isDefault&&0===v.length&&(v=e.printerName)}}function q(r){r.name=r.name.replace(/\\/g,"||"),MeadCo.log("Request get device info: "+r.name),I(p+"/deviceinfo/"+encodeURIComponent(r.name)+"/0",r.async,function(e){o=!0,X(e),"function"==typeof r.done&&r.done(e)},function(e){"systemdefault"===r.name?(console.warn("request for systemdefault printer failed - please update to ScriptX.Services 2.11.1"),r.name="default",r.async=!1,q(r)):(MeadCo.log("failed to getdevice: "+e),"function"==typeof r.fail&&r.fail(e))})}return d.jQuery||MeadCo.log("**** warning :: no jQuery *******"),MeadCo.log("MeadCo.ScriptX.Print "+e+" loaded."),{ContentType:y,PrintStatus:S,ErrorAction:r,CollateOptions:{DEFAULT:0,TRUE:1,FALSE:2},DuplexOptions:{DEFAULT:0,SIMPLEX:1,VERTICAL:2,HORIZONTAL:3},MeasurementUnits:{DEFAULT:0,INCHES:1,MM:2},ServiceClasses:{CLOUD:1,ONPREMISE:2,WINDOWSPC:3},get onErrorAction(){return c},set onErrorAction(e){c=e},get orchestrator(){return C.orchestratorPort},set orchestrator(e){C.orchestratorPort=""+e},get authorisationCookie(){return m.cookie},set authorisationCookie(e){m.cookie=e},get printerName(){return v},set printerName(e){e!==v&&e.name!==v&&("string"==typeof e?void 0===h[e]?q({name:e,done:function(e){v=e.printerName},async:!1,fail:function(e){MeadCo.ScriptX.Print.reportError(e)}}):v=e:q(e))},setSystemDefaultPrinterAsync:function(e,r,t){if(void 0!==h.systemdefault&&h.systemdefault==e)return MeadCo.log("setSystemDefaultPrinterAsync() does NOT need to do anything"),void r();e=(e="system::"+e).replace(/\\/g,"||"),MeadCo.log("Request systemDefaultPrinterAsync: "+e),A(p+"/CurrentPrinter/"+encodeURIComponent(e),"PUT",null,!0,!0,r,t)},get version(){return e},get serviceUrl(){return C.url},serviceVersion:function(){return this.cachedServiceDescription.ServiceVersion},serviceVersionAsync:function(r,e){this.serviceDescriptionAsync(function(e){r(e.serviceVersion)},e)},get deviceSettings(){return""!==v?h[v]:{}},set deviceSettings(e){X(e)},deviceSettingsFor:function(e){return"string"!=typeof(r=e)||""===r?{}:(void 0===h[r]&&q({name:r,async:!1,done:function(e){"systemdefault"===r.toLowerCase()&&(r=e.printerName)},fail:function(e){MeadCo.ScriptX.Print.reportError(e)}}),h[r]);var r},useAttributes:function(){!function(){if(MeadCo.log("MeadCo.ScriptX.Print ... looking for auto connect, already found?: "+l),this.jQuery&&!l){var i=MeadCo.ScriptX.Print.HTML,a=MeadCo.ScriptX.Print,c=MeadCo.ScriptX.Print.Licensing;jQuery("[data-meadco-subscription]").each(function(){if(void 0===a||void 0===i)console.warn("Unable to auto-connect subscription - print or printHtml API not present (yet?)");else if(!l){var e=jQuery(this),r=e.data();MeadCo.log("Auto connect susbcription to: "+r.meadcoServer+", or "+r.meadcoPrinthtmlserver+", with subscription: "+r.meadcoSubscription+", sync: "+r.meadcoSyncinit);var t="false"!==(""+r.meadcoSyncinit).toLowerCase(),n=r.meadcoServer;void 0===n&&(n=r.meadcoPrinthtmlserver),void 0===n?console.error("No server specified"):(void 0!==c&&c.connect(n,r.meadcoSubscription),t?(console.warn("Synchronous connection is deprecated, please use data-meadco-syncinit='false'"),i.connect(n,r.meadcoSubscription)):(MeadCo.log("Async connectlite..."),a.connectLite(n,r.meadcoSubscription)),l=!0)}return!1}),jQuery("[data-meadco-license]").each(function(){if(void 0===a||void 0===i||void 0===c)console.warn("Unable to auto-connect client license - print or printHtml or license API not present (yet?)");else if(!l){var e=jQuery(this),r=e.data();MeadCo.log("Auto connect client license to: "+r.meadcoServer+", with license: "+r.meadcoLicense+", path: "+r.meadcoLicensePath+", revision: "+r.meadcoLicenseRevision+", sync: "+r.meadcoSyncinit+", orchestrator: "+r.meadcoOrchestrator);var t="false"!==(""+r.meadcoSyncinit).toLowerCase(),n="false"!==(""+r.meadcoReporterror).toLowerCase(),o=r.meadcoServer;C.orchestratorPort=r.meadcoOrchestrator,t?(console.warn("Synchronous connection is deprecated, please use data-meadco-syncinit='false'"),c.connect(o,r.meadcoLicense),void 0!==r.meadcoLicensePath&&void 0!==r.meadcoLicenseRevision&&(c.apply(r.meadcoLicense,r.meadcoLicenseRevision,r.meadcoLicensePath),0!=c.result&&n&&MeadCo.ScriptX.Print.reportError(c.errorMessage)),i.connect(o,r.meadcoLicense)):(MeadCo.log("Async connectlite..."),c.connectLite(o,r.meadcoLicense,r.meadcoLicenseRevision,r.meadcoLicensePath),a.connectLite(o,r.meadcoLicense)),l=!0}return!1})}}()},connect:function(e,r){N(e,r),q({name:"systemdefault",async:!1}),I("",!0,function(e){a=e})},connectLite:function(e,r){N(e,r)},connectAsync:function(e,r,t,n){var o,i;o=t,N(e,r,function(e){q({name:"systemdefault",done:o,async:!0,fail:i}),I("",!0,function(e){a=e})},i=n)},connectTestAsync:function(e,r,t){C.verifyUrl(e,!0,r,t)},serviceDescription:function(){return a||I("",!1,function(e){a=e},function(e){MeadCo.ScriptX.Print.reportError(e.message)}),a},serviceDescriptionAsync:function(r,e){a?r(a):I("",!0,function(e){r(a=e)},e)},connectDeviceAndPrinters:function(e,r){o=!0,X(e),i=r},get isConnected(){return o},get availablePrinterNames(){return i},getFromServer:function(e,r,t,n){I(p+e,r,t,n)},printHtml:function(e,r,t,n,o,i){if(!r||"string"==typeof r&&0===r.length)return MeadCo.ScriptX.Print.reportError("Request to print no content - access denied?"),"function"==typeof n&&n("Request to print no content"),!1;var a=Date.now();return R<a-U&&(T=0),U=a,setTimeout(w(e,r,t,i,n,o,function(e){window.open(e,"_self")}),T),T+=D,!0},requestHtmlPreview:function(e,r,t,n,o){var i=v;v=g,w(e,r,t,{},n,function(){},o)(),v=i},printPdf:function(e,r,t,n,o){if(!e||"string"==typeof e&&0===e.length)return MeadCo.ScriptX.Print.reportError("The document to print must be given."),"function"==typeof t&&t("Request to print no content"),!1;var i=Date.now();return R<i-U&&(T=0),U=i,setTimeout(function(e,r,o,t,n){var i;MeadCo.log("started MeadCo.ScriptX.Print.print.printPdfAtServer() document: "+e+", printerName: "+v),i=""===v?{}:JSON.parse(JSON.stringify(h[v]));var a={Document:e,Description:r.jobDescription,Settings:JSON.parse(JSON.stringify(r)),Device:i,ProtectedContentAccess:m,OnProgress:t,UserData:n};a.Settings.jobTitle=r.jobDescription;var c=MeadCo.makeApiEndPoint(C.url,u),s={jobIdentifier:Date.now(),printerName:a.Device.printerName,jobName:"Job timeout hold clientside"};M(s);var l=j;return j="",function(){return P(s.jobIdentifier),O(c,a,{fail:function(e,r,t){var n=MeadCo.parseAjaxError("MeadCo.ScriptX.Print.printPdfAtServer",e,r,t);b(a,S.ERROR,n),MeadCo.ScriptX.Print.reportError(n),"function"==typeof o&&o("Server error")},queuedToFile:function(e){MeadCo.log("default handler on queued to file response"),b(a,S.QUEUED),L(c,a,e.jobIdentifier,-1,function(e){if(null!==e){MeadCo.log("Will download printed file"),b(a,S.COMPLETED);var r=c+"/download/"+e.jobIdentifier;0<l.length&&(r+="/"+l),window.open(r,"_self")}"function"==typeof o&&o(null===e?"Server error":null)})},queuedToDevice:function(e){MeadCo.log("print was queued to device"),b(a,S.QUEUED),L(c,a,e.jobIdentifier,-1,function(e){null!==e&&b(a,S.COMPLETED),"function"==typeof o&&o(null===e?"Server error":null)})},softError:function(e){b(a,S.ERROR,e.message),MeadCo.ScriptX.Print.reportError(e.message),MeadCo.log("printpdf call has soft error, remove job: "+e.jobIdentifier),P(e.jobIdentifier),"function"==typeof o&&(MeadCo.log("Call fnDone"),o("Server error"))},ok:function(e){b(a,S.COMPLETED),MeadCo.log("printed ok, no further information"),P(e.jobIdentifier),"function"==typeof o&&o(null)}})}}(e,r,t,n,o),T),T+=D,!0},printDirect:function(e,r,o){if(MeadCo.log("started MeadCo.ScriptX.Print.print.printDirectAtServer() Type: "+e+", printerName: "+v),e===y.URL)MeadCo.log(".. request print url: "+r);else if(e!==y.STRING)return MeadCo.ScriptX.Print.reportError("Bad content type for direct printing"),"function"==typeof o&&o("Bad content type for direct printing"),!1;if(!r||"string"==typeof r&&0===r.length)return MeadCo.ScriptX.Print.reportError("Request to print no content - access denied?"),"function"==typeof o&&o("Request to print no content"),!1;if(""===v)return MeadCo.ScriptX.Print.reportError("Request to print but no current printer defined."),"function"==typeof o&&o("Request to print but no current printer defined."),!1;var t={ContentType:e,Content:r,PrinterName:v,Settings:{jobTitle:"Direct print"},Device:h[v]};return O(MeadCo.makeApiEndPoint(C.url,n),t,{fail:function(e,r,t){var n=MeadCo.parseAjaxError("MeadCo.ScriptX.Print.printDirectAtServer",e,r,t);MeadCo.ScriptX.Print.reportError(n),"function"==typeof o&&o("Server error")},softError:function(e){MeadCo.ScriptX.Print.reportError(e.message),MeadCo.log("print has soft error"),P(e.jobIdentifier),"function"==typeof o&&(MeadCo.log("Call fnDone"),o(e.message))},ok:function(e){MeadCo.log("printed ok, no further information"),P(e.jobIdentifier),"function"==typeof o&&o(null)}})},parseAjaxError:function(e,r,t,n){return MeadCo.parseAjaxError(e,r,t,n)},reportError:function(e){switch(MeadCo.error("ReportError: "+e),c){case r.REPORT:MeadCo.ScriptX.Print.reportServerError(e);break;case r.THROW:throw new Error(e)}},reportServerError:function(e){alert("There was an error in the printing service\n\n"+e)},reportFeatureNotImplemented:function(e){MeadCo.log("Call to not implemented: "+e),alert(e+"\n\nis not available.")},get queue(){return s},get activeJobs(){return E()},ensureSpoolingStatus:function(){var e={jobIdentifier:Date.now(),printerName:"ensureJobsPrinter",jobName:"null Job"};return M(e),e},freeSpoolStatus:function(e){P(e.jobIdentifier)},get isSpooling(){return 0<E()},waitForSpoolingComplete:function(e,r){if(MeadCo.log("Started WaitForSpoolingComplete("+e+")"),"function"!=typeof r)throw"WaitForSpoolingComplete requires a completion callback";var t=Date.now(),n=window.setInterval(function(){0===E()?(MeadCo.log("WaitForSpoolingComplete - complete"),window.clearInterval(n),r(!0)):0<=e&&Date.now()-t>e&&(MeadCo.log("WaitForSpoolingComplete - timeout"),window.clearInterval(n),r(0===E()))},250)},get queueTimeoutSpacing(){return D},set queueTimeoutSpacing(e){D=e},get queueGapResetTime(){return R},set queueGapResetTime(e){R=e},get jobFileName(){return j},set jobFileName(e){j=e},requestService:function(e,r,t,n,o,i,a){return A(e,r,t,n,o,i,a)},getService:function(e,r,t){return A(e,"GET",r,t,!1)},postService:function(e,r,t){return A(e,"POST",r,t,!1)},getServiceAsync:function(e,r,t,n,o){return A(e,"GET",r,t,!0,n,o)},postServiceAsync:function(e,r,t,n,o){return A(e,"POST",r,t,!0,n,o)}}});
extendMeadCoNamespace("MeadCo.ScriptX.Print.Licensing",function(){var n="1.11.0.0",f="v1/licensing",a="",o=0,r="",p="No license applied",d={};function c(n,e){var i=MeadCo.ScriptX.Print;void 0!==i&&"function"==typeof i.connectLite?i.connectLite(n,e):console.error("MeadCo.ScriptX.Print is not available"),a=e,d={},p="No license applied",o=0,r=""}function i(e,i){var n=MeadCo.ScriptX.Print;if(void 0!==n&&"function"==typeof n.connectLite)return 0<d.length?"function"==typeof e&&e(d):n.requestService(f,"GET",{},!0,"function"==typeof e,function(n){p="",$.extend(d,n),"function"!=typeof e||e(d)},function(n){if(p="MeadCo.ScriptX.Licensing.getSubscriptionFromServer: "+n,"function"!=typeof i)throw new Error(p);i(p)}),d;var t="MeadCo.ScriptX.Licensing : MeadCo.ScriptX.Print API not available";if("function"!=typeof i)throw new Error(t);i(t)}function u(n,e,i,t,o){MeadCo.log("Apply license: "+n+",revision: "+e+", path: "+i);var r=MeadCo.ScriptX.Print;if(void 0===r||"function"!=typeof r.connectLite){var c="MeadCo.ScriptX.Licensing : MeadCo.ScriptX.Print API not available";if("function"==typeof o)return void o(c);throw new Error(c)}var u={Guid:a=n,Url:i,Revision:e};return r.requestService(f,"POST",u,!1,"function"==typeof t,function(n){p="",$.extend(d,n),"function"!=typeof t||t(d)},function(n){p="MeadCo.ScriptX.Print.Licensing.applyLicense: "+n,"function"!=typeof o||o(p)}),"function"!=typeof t?(MeadCo.log("returning applied (sync) license: "+d.company),d):0}return MeadCo.log("MeadCo.ScriptX.Print.Licensing "+n+" loaded."),{get version(){return n},connect:function(n,e){c(n,e)},connectLite:function(n,e,i,t){c(n,e),o=i,r=t},apply:function(n,e,i){return u(n,e,i)},applyAsync:function(n,e,i,t,o){u(n,e,i,t,o)},get result(){return""===p?0:5},get validLicense(){return void 0!==d.guid},get errorMessage(){return p},get License(){return void 0!==d.guid?d:i()},GetLicenseAsync:function(n,e){i(n,e)},PolyfillInit:function(){return void 0!==d.guid||""!==a&&(""===r||(u(a,o,r),void 0!==d.guid))},PolyfillInitAsync:function(n,e){void 0!==d.guid||""===r?n(d):u(a,o,r,n,e)}}});
!function(e,i,t){if(this[e]!==t||null!==document.getElementById(e)){if(MeadCo.log("ScriptX.Services MeadCo Security Manager emulation believes it may not be required."),this[e]!==t&&MeadCo.log("this["+e+"] is defined"),null!==document.getElementById(e)&&MeadCo.log("document.getElementById("+e+") is defined"),this[e].object!==t)return MeadCo.log("this["+e+"].object is defined -- not required!!!");MeadCo.log("this["+e+"].object is *not* defined")}MeadCo.log("ScriptX.Services MeadCo Security Manager emulation believes it is required.");var n=function(){var i=MeadCo,e=MeadCo.ScriptX.Print,t=MeadCo.ScriptX.Print.Licensing;function s(e){i.log("secmgr emulation :: "+e)}this.extendSecMgrNamespace=function(e,i){var t=i();s("MeadCo security manager extending namespace2: "+e);for(var n=e.split("."),o=this,r=0;r<n.length;r++){var a=n[r];r===n.length-1?void 0===o[a]?(s("installing implementation at: "+a),o[a]=t):s("Warning - not overwriting package: "+a):void 0===o[a]?(s("initialising new: "+a),o[a]={}):s("using existing package: "+a),o=o[a]}},s("'secmgr' loaded."),"function"!=typeof t.GetLicenseAsync&&MeadCo.error("MeadCo.ScriptX.Print.Licensing not available");"function"!=typeof e.useAttributes?MeadCo.warn("Attribute based licensing not available as MeadCo.ScriptX.Print is not available"):e.useAttributes();return{log:s,get version(){return"1.11.0.0"},get result(){return t.result},get validLicense(){return t.validLicense},get License(){return t.License},GetLicenseAsync:function(e,i){t.GetLicenseAsync(e,i)},PolyfillInit:function(){return t.PolyfillInit()},PolyfillInitAsync:function(e,i){t.PolyfillInitAsync(e,i)}}}();this[e]=n}("secmgr"),"function"==typeof extendSecMgrNamespace&&extendSecMgrNamespace("secmgr.object",function(){return this.secmgr.log("secmgr.object loaded."),this.secmgr});