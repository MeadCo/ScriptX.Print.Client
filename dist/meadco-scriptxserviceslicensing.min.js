!function(e,r){var n=function(){var d=this,e="1.14.0.0",r="undefined"!=typeof MeadCo&&void 0!==MeadCo.logEnable&&MeadCo.logEnable,c=function(e){r&&console.log("MeadCo :: "+e)},i=function(e){console.error("MeadCo :: "+e)};return d.extendMeadCoNamespace=function(e,r){var n=r();c("MeadCo root extending namespace: "+e);for(var o=e.split("."),t=d.scope||this.jQuery||this.ender||this.$||this,s=0;s<o.length;s++){var a=o[s];if(s===o.length-1)if(void 0===t[a])c("installing implementation at: "+a),t[a]=n;else{c("Warning - extending package: "+a);var i=t[a];t[a]=n;var l=t[a];for(var p in c("preserving old scope ... "),i)i.hasOwnProperty(p)&&(c("will preserve: "+p),l[p]=i[p])}else void 0===t[a]?(c("initialising new: "+a),t[a]={}):c("using existing package: "+a);t=t[a]}},c("MeadCo root namespace "+e+" loaded."),{log:c,warn:function(e){console.warn("MeadCo :: "+e)},error:i,get version(){return e},get logEnabled(){return r},set logEnabled(e){r=e},createNS:function(e){var r=e.split("."),n=d.scope.MeadCo;"MeadCo"===r[0]&&(r=r.slice(1));for(var o=0;o<r.length;o++){var t=r[o];void 0===n[t]&&(n[t]={}),n=n[t]}return n},set scope(e){d.scope=e},makeApiEndPoint:function(e,r){var n=e.indexOf("/api");return-1===n?(e.lastIndexOf("/")!==e.length-1&&(e+="/"),e+="api/"+r):e=e.substr(0,n)+"/api/"+r,e},makeServiceEndPoint:function(e,r){var n=e.indexOf("/api");return-1===n?(e.lastIndexOf("/")!==e.length-1&&(e+="/"),e+=r):e=e.substr(0,n)+"/"+r,e},parseAjaxError:function(e,r,n,o){return i("**warning: AJAX call failure in "+e+": ["+(s=n)+"], ["+(a=o)+"], ["+(t=r).responseText+"], ["+t.statusText+"]"),""===a||"Internal Server Error"===a?a="error"!==s?t.responseText||s:"object"==typeof t.responseJSON&&"string"==typeof t.responseJSON.Message?t.responseJSON.Message:"string"==typeof t.responseText?t.responseText:"Server or network error":"object"!=typeof t.responseJSON&&"string"==typeof t.responseText&&0<t.responseText.length&&(a=t.responseText),i(" error parsed to --\x3e ["+a+"]"),a;var t,s,a}}}(),o=this,t=null;if(void 0!==o[e]&&(t=o[e]),o[e]=n,null!==t){var s=o[e];for(var a in t)t.hasOwnProperty(a)&&(s[a]=t[a])}n.scope=o}("MeadCo");
extendMeadCoNamespace("MeadCo.ScriptX.Print",function(){var e="1.14.0.2",p="v1/printHtml",d="v1/printPdf",o="v1/printDirect",i="v1/printer",v="",g="ScriptX.Services//PrintPreview.1",h={cookie:""},C={},u=this,s=[],m={serviceUrl:"",pendingUrl:"",failedUrl:"",orchestratorPort:0,orchestratorKey:"",portsToTry:10,verifying:!1,get url(){if(""===this.serviceUrl&&""!==this.pendingUrl){MeadCo.warn("[GET] servicesServer.url is not ready, performing synchronous search. Recommend code re-org to resolve the server earlier and asynchronously.");var e=this;this.verifyUrl(this.pendingUrl,!1,function(){return e.serviceUrl},function(){return""})}return this.serviceUrl},set url(e){MeadCo.log("servicesServer::setUrl: "+e),this.IsChangingServer(e)&&(MeadCo.log("note set as pending"),this.serviceUrl="",this.pendingUrl=e)},urlAsync:function(e,r,t){MeadCo.log("servicesServer::urlAsync: "+e),this.verifyUrl(e,!0,r,t)},verifyUrl:function(e,o,n,i){if(this.verifying&&o){MeadCo.warn("Verify called and verify in progress ....");var a=this,c=e;window.setTimeout(function(){a.verifyUrl(c,o,n,i)},1e3)}else if(this.IsChangingServer(e)&&!this.IsFailedConnection(e)){var r,a=this,c=e;MeadCo.log("servicesServer::verifyurl: "+e+", async: "+o),"number"!=typeof this.orchestratorPort&&(this.orchestratorPort=parseInt(""+this.orchestratorPort)),0<this.orchestratorPort?(MeadCo.log("Using request to Orchestrator on port: "+this.orchestratorPort),a.verifying=!0,r="string"==typeof this.orchestratorKey&&0<this.orchestratorKey.length?"/api/v2?key="+this.orchestratorKey:"/api/v1",MeadCo.log("servicesServer::querying orchestrator: http://127.0.0.1:"+this.orchestratorPort+r),u.jQuery.ajax("http://127.0.0.1:"+this.orchestratorPort+r,{method:"GET",dataType:"json",cache:!1,async:o}).done(function(e){MeadCo.log("orchestrator returned ScriptX.Services port: "+e.HttpPort);var r=new URL(c);r.port=e.HttpPort,c=r.protocol+"//"+r.host+r.pathname,a.test(c,0,o,function(e){a.serviceUrl=e,a.pendingUrl="",a.verifying=!1,n(e,!0)},function(e){a.serviceUrl="",a.pendingUrl="",a.failedUrl=c,a.verifying=!1,"function"==typeof i&&i(e)})}).fail(function(e,r,t){a.verifying=!1,MeadCo.warn(MeadCo.parseAjaxError("Failed to connect with orchestrator: ",e,r,t)),MeadCo.log("Will try unorchestrated url"),a.orchestratorPort=0,a.verifyUrl(c,o,n,i)})):(a.verifying=!0,a.test(c,a.portsToTry,o,function(e){a.serviceUrl=e,a.pendingUrl="",a.verifying=!1,n(e,!1)},function(e){if(a.serviceUrl="",a.pendingUrl="",a.verifying=!1,a.failedUrl=c,"function"==typeof i){var r=new URL(c);i("ScriptX.Services could not be found at "+r.protocol+"//"+r.host+". Is it installed and running?")}}))}else this.IsFailedConnection(e)?"function"==typeof i?i("ScriptX.Services connection to: "+e+" has already failed and will not be re-tried."):MeadCo.warn("ScriptX.Services connection to: "+e+" has already failed and will not be re-tried."):n(this.serviceUrl,0<this.orchestratorPort)},test:function(e,o,n,i,a){if(0<e.length)if(u.jQuery){var c=this,s=new URL(e);MeadCo.log("Test server requested: "+e+", port: "+s.port);var r=MeadCo.makeApiEndPoint(s.href,"v1/licensing/ping");MeadCo.log(".ajax() get: "+r),u.jQuery.ajax(r,{method:"GET",dataType:"json",cache:!1,async:n}).done(function(e){var r=s.protocol+"//"+s.host+s.pathname;MeadCo.log("Test server succeed, resolve("+r+")"),i(r)}).fail(function(e,r,t){MeadCo.log("Test server failed: ["+t+"], "+o+", on: "+s.hostname),0<o&&("localhost"===s.hostname||"127.0.0.1"==s.hostname)?(s.port++,u.setTimeout(c.test(s.protocol+"//"+s.host+s.pathname,--o,n,i,a),1)):(t=MeadCo.parseAjaxError("MeadCo.ScriptX.Print.servicesServer.test:",e,r,t),"function"==typeof a?(MeadCo.log("rejecting with: "+t),a(t)):MeadCo.warn("failed with no reject function"))})}else MeadCo.error("jQuery is required by ScriptX.Services")},call:function(o,n,e,r,t,i,a){if(""===this.serviceUrl&&""!==this.pendingUrl){var c=this;this.verifyUrl(this.pendingUrl,t,function(){""!==c.url?c.call(o,n,e,r,t,i,a):"function"==typeof a&&a("Server url verification failed to set url")},a)}else if(u.jQuery)if(""!==this.serviceUrl){var s=MeadCo.makeApiEndPoint(this.serviceUrl,o);MeadCo.log("servicesServer.call() "+n+": "+s);var l={method:n,cache:!1,async:t,jsonp:!1,dataType:"json",contentType:"application/json"};r&&(l.headers={Authorization:"Basic "+btoa(f+":")}),"object"==typeof e&&null!==e&&(MeadCo.log("payload defined."),l.data=JSON.stringify(e)),u.jQuery.ajax(s,l).done(function(e){return"function"==typeof i&&i(e),e}).fail(function(e,r,t){if(t=MeadCo.parseAjaxError("MeadCo.ScriptX.Print:"+o+n,e,r,t),"function"!=typeof a)throw new Error(t);a(t)})}else{if("function"!=typeof a)throw new Error("MeadCo.ScriptX.Print : server connection is not defined.");a("MeadCo.ScriptX.Print : server connection is not defined.")}else{if("function"!=typeof a)throw new Error("MeadCo.ScriptX.Print : no known ajax helper available");a("MeadCo.ScriptX.Print : no known ajax helper available")}},IsChangingServer:function(r){if(""!==this.serviceUrl)try{var e=new URL(this.serviceUrl),t=new URL(r);return e.hostname!=t.hostname||e.port!=t.port}catch(e){return MeadCo.error("Failed to construct URL(): "+e.message+", from: "+this.serviceUrl+", or: "+r),MeadCo.error("Many errors will ensue"),!1}return!0},IsFailedConnection:function(r){if(0<this.failedUrl.length)try{var e=new URL(this.failedUrl),t=new URL(r);return e.hostname===t.hostname&&(MeadCo.warn("Attempt to use: "+r+" is noted as a failed connection and will not be retried"),!0)}catch(e){return MeadCo.error("Testing IsFailed unable to construct URL(): "+e.message+", from: "+this.failedUrl+", or: "+r),!0}return!1}},f="",n=!1,l=!1,a=[],c=null,y={URL:1,HTML:2,INNERHTML:4,STRING:8},t={UNKNOWN:0,QUEUEDTODEVICE:1,QUEUEDTOFILE:2,SOFTERROR:3,OK:4},r={REPORT:1,THROW:2},S=r.REPORT,M={CLOUD:1,ONPREMISE:2,WINDOWSPC:3},P={NOTSTARTED:0,QUEUED:1,STARTING:2,DOWNLOADING:3,DOWNLOADED:4,PRINTING:5,COMPLETED:6,PAUSED:7,PRINTPDF:8,ERROR:-1,ABANDONED:-2};function E(e){s.push(e),MeadCo.log("ScriptX.Print queueJob: "+e.jobName+", jobCount: "+s.length)}function w(){return MeadCo.log("ScriptX.Print jobCount: "+s.length),s.length}function b(e){var r;for(r=0;r<s.length;r++)if(s[r].jobIdentifier===e)return MeadCo.log("ScriptX.Print removing job: "+s[r].jobName),s.splice(r,1),MeadCo.log("ScriptX.Print remove job, jobCount: "+s.length),void(0==s.length&&(N=0));MeadCo.warn("Unable to find job: "+e+" to remove it")}function T(e,r,t){"function"==typeof e.OnProgress&&e.OnProgress(r,t,e.UserData)}var j="";function D(e,r,t,o,n,i,a){var c;MeadCo.log("started MeadCo.ScriptX.Print.print.printHtmlAtServer() Type: "+e),e===y.URL&&MeadCo.log(".. request print url: "+r),c=""===v?{}:v===g?JSON.parse(JSON.stringify({printerName:v})):JSON.parse(JSON.stringify(C[v]));var s={ContentType:e,Content:r,Settings:JSON.parse(JSON.stringify(t)),Device:c,ProtectedContentAccess:h,OnProgress:i,UserData:o},l={jobIdentifier:Date.now(),printerName:s.Device.printerName,jobName:"Job timeout hold clientside"};E(l);var d=j;j="";var u=MeadCo.makeApiEndPoint(m.url,p),f=a;return function(){return b(l.jobIdentifier),A(u,s,{fail:function(e,r,t){var o=MeadCo.parseAjaxError("MeadCo.ScriptX.Print.printHtmlAtServer",e,r,t);T(s,P.ERROR,o),MeadCo.ScriptX.Print.reportError(o),"function"==typeof n&&n("Server error")},queuedToFile:function(e){MeadCo.log("print is being queued to a file"),T(s,P.QUEUED),q(u,s,e.jobIdentifier,-1,function(e){if(null!==e){MeadCo.log("download printed file is available"),T(s,P.COMPLETED);var r=u+"/download/"+e.jobIdentifier;0<d.length&&(r+="/"+d),f(r,e.jobIdentifier)}"function"==typeof n&&n(null===e?"Server error":null)})},queuedToDevice:function(e){MeadCo.log("print was queued to device"),T(s,P.QUEUED),q(u,s,e.jobIdentifier,-1,function(e){null!==e&&T(s,P.COMPLETED),"function"==typeof n&&n(null===e?"Server error":null)})},softError:function(e){T(s,P.ERROR,e.message),MeadCo.ScriptX.Print.reportError(e.message),MeadCo.log("print has soft error"),b(e.jobIdentifier),"function"==typeof n&&(MeadCo.log("Call fnDone"),n(e.message))},ok:function(e){T(s,P.COMPLETED),MeadCo.log("printed ok, no further information"),b(e.jobIdentifier),"function"==typeof n&&n(null)}})}}var U=0,N=0,R=750,I=1e4;function O(e,r,t,o){"string"==typeof e&&0<e.length?(MeadCo.log("Print server requested: "+e+" with license: "+r),f="string"==typeof r&&0<r.length?r:f,v="",C={},n=!(s=[]),a=[],"function"==typeof t?m.urlAsync(e,t,o):m.url=e):(MeadCo.log("Print server retained: "+m.url+" update with license: "+r),f="string"==typeof r&&0<r.length?r:f)}function A(e,r,o){if(m.url.length<=0)throw new Error("MeadCo.ScriptX.Print : print server URL is not set or is invalid");var n={jobIdentifier:Date.now(),printerName:r.Device.printerName,jobName:"Job starting"};if(u.jQuery)return MeadCo.log(".ajax() post to: "+e),E(n),u.jQuery.ajax(e+"/print",{data:JSON.stringify(r),dataType:"json",contentType:"application/json",method:"POST",headers:{Authorization:"Basic "+btoa(f+":")}}).done(function(e){switch(MeadCo.log("Success response: "+e.status),e.printerName=r.Device.printerName,e.jobName=r.Settings.jobTitle,E(e),b(n.jobIdentifier),e.status){case t.QUEUEDTOFILE:o.queuedToFile(e);break;case t.QUEUEDTODEVICE:o.queuedToDevice(e);break;case t.SOFTERROR:case t.UNKNOWN:o.softError(e);break;case t.OK:o.ok(e)}}).fail(function(e,r,t){b(n.jobIdentifier),"function"==typeof o.fail&&o.fail(e,r,t)}),!0;if("function"!=typeof o.fail)throw new Error("MeadCo.ScriptX.Print : no known ajax helper available");o.fail("MeadCo.ScriptX.Print : no known ajax helper available")}function L(e,r,t,o){return X(e,"GET",null,!0,r,t,o)}function X(e,r,t,o,n,i,a){return m.call(e,r,t,o,n,i,a)}function q(e,o,n,r,i){MeadCo.log("monitorJob: "+n);var t=0,a=!1,c=window.setInterval(function(){a?MeadCo.log("** info : still waiting for last status request to complete"):(MeadCo.log("Going to request status with .ajax"),a=!0,jQuery.ajax(e+"/status/"+n,{dataType:"json",method:"GET",cache:!1,headers:{Authorization:"Basic "+btoa(f+":")}}).done(function(e){switch(MeadCo.log("jobStatus: "+e.status),e.status){case P.COMPLETED:MeadCo.log("clear interval: "+c),window.clearInterval(c),b(n),i(e);break;case P.NOTSTARTED:case P.DOWNLOADED:case P.DOWNLOADING:case P.PRINTING:case P.QUEUED:case P.STARTING:case P.PAUSED:case P.PRINTPDF:T(o,e.status,e.message),function(r){var t;for(t=0;t<s.length;t++)if(s[t].jobIdentifier===r.jobIdentifier)return Object.keys(r).forEach(function(e){s[t][e]=r[e]});MeadCo.warn("Unable to find job: "+r.jobIdentifier+" to update it")}(e),0<r&&1e3*++t>r&&(window.clearInterval(c),MeadCo.ScriptX.Print.reportError("unknown failure while printing.")),a=!1;break;case P.ERROR:case P.ABANDONED:MeadCo.log("error status in monitorJob so clear interval: "+c),T(o,e.status,e.message),b(n),window.clearInterval(c),MeadCo.ScriptX.Print.reportError("The print failed with the error: "+e.message),i(null);break;default:T(o,e.status,e.message),MeadCo.log("unknown status in monitorJob so clear interval: "+c),b(n),window.clearInterval(c),i(null)}}).fail(function(e,r,t){t=MeadCo.parseAjaxError("MeadCo.ScriptX.Print.monitorJob:",e,r,t),MeadCo.log("error: "+t+" in monitorJob so clear interval: "+c),T(o,P.ERROR,t),b(n),window.clearInterval(c),i(null)}))},1e3);MeadCo.log("intervalId: "+c)}function k(e){if("string"==typeof e.printerName){if(e.isDefault)for(var r=0;r<C.length;r++)C[r].isDefault=!1;(C[e.printerName]=e).isDefault&&0===v.length&&(v=e.printerName)}}function F(r){r.name=r.name.replace(/\\/g,"||"),MeadCo.log("Request get device info: "+r.name),L(p+"/deviceinfo/"+encodeURIComponent(r.name)+"/0",r.async,function(e){n=!0,k(e),"function"==typeof r.done&&r.done(e)},function(e){"systemdefault"===r.name?(MeadCo.warn("request for systemdefault printer failed - please update to ScriptX.Services 2.11.1"),r.name="default",r.async=!1,F(r)):(MeadCo.log("failed to getdevice: "+e),"function"==typeof r.fail&&r.fail(e))})}function Q(e,r){console.warn("Synchronous calls to add/remove printer connections are not recommeneded as this will lock the browser UI. Consider using the asynchronous versions when working with in ScriptX.Services");var t=MeadCo.ScriptX.Print.serviceDescription();t.serviceClass==M.WINDOWSPC&&2<=t.serviceVersion.major&&19<=t.serviceVersion.minor?X(i+"/Connection/"+encodeURIComponent(r),e,null,!0,!1):MeadCo.error("ScriptX.Services for Windows PC 2.19 or later is required for add/remove PrinterConnection()")}function x(r,t,o,n){MeadCo.ScriptX.Print.serviceDescriptionAsync(function(e){e.serviceClass==M.WINDOWSPC&&2<=e.serviceVersion.major&&19<=e.serviceVersion.minor?X(i+"/Connection/"+encodeURIComponent(t),r,null,!0,!0,o,n):(MeadCo.error("ScriptX.Services for Windows PC 2.19 or later is required for add/remove PrinterConnection()"),n("add/remove PrinterConnection is not supported"))},n)}return u.jQuery||MeadCo.log("**** warning :: no jQuery *******"),MeadCo.log("MeadCo.ScriptX.Print "+e+" loaded."),{ContentType:y,PrintStatus:P,ErrorAction:r,CollateOptions:{DEFAULT:0,TRUE:1,FALSE:2},DuplexOptions:{DEFAULT:0,SIMPLEX:1,VERTICAL:2,HORIZONTAL:3},MeasurementUnits:{DEFAULT:0,INCHES:1,MM:2},ServiceClasses:M,get onErrorAction(){return S},set onErrorAction(e){S=e},get orchestrator(){return m.orchestratorPort},set orchestrator(e){m.orchestratorPort=""+e},get orchestratorKey(){return m.orchestratorKey},set orchestratorKey(e){m.orchestratorKey=e},get authorisationCookie(){return h.cookie},set authorisationCookie(e){h.cookie=e},get printerName(){return v},set printerName(e){e!==v&&e.name!==v&&("string"==typeof e?void 0===C[e]?F({name:e,done:function(e){v=e.printerName},async:!1,fail:function(e){MeadCo.ScriptX.Print.reportError(e)}}):v=e:F(e))},setSystemDefaultPrinterAsync:function(e,r,t){if(void 0!==C.systemdefault&&C.systemdefault==e)return MeadCo.log("setSystemDefaultPrinterAsync() does NOT need to do anything"),void r();e=(e="system::"+e).replace(/\\/g,"||"),MeadCo.log("Request systemDefaultPrinterAsync: "+e),X(p+"/CurrentPrinter/"+encodeURIComponent(e),"PUT",null,!0,!0,r,t)},get version(){return e},get serviceUrl(){return m.url},serviceVersion:function(){return this.serviceDescription().serviceVersion},serviceVersionAsync:function(r,e){this.serviceDescriptionAsync(function(e){r(e.serviceVersion)},e)},get deviceSettings(){return""!==v?C[v]:{}},set deviceSettings(e){k(e)},deviceSettingsFor:function(e){return"string"!=typeof(r=e)||""===r?{}:(void 0===C[r]&&F({name:r,async:!1,done:function(e){"systemdefault"===r.toLowerCase()&&(r=e.printerName)},fail:function(e){MeadCo.ScriptX.Print.reportError(e)}}),C[r]);var r},useAttributes:function(){!function(){if(MeadCo.log("MeadCo.ScriptX.Print ... looking for auto connect, already found?: "+l),this.jQuery&&!l){var i=MeadCo.ScriptX.Print.HTML,a=MeadCo.ScriptX.Print,c=MeadCo.ScriptX.Print.Licensing;jQuery("[data-meadco-subscription]").each(function(){if(void 0===a||void 0===i)MeadCo.log("Not auto-connecting subscription as print or printHtml API not present. Should be present on next attempt.");else if(!l){var e=jQuery(this),r=e.data();MeadCo.log("Auto connect susbcription to: "+r.meadcoServer+", or "+r.meadcoPrinthtmlserver+", with subscription: "+r.meadcoSubscription+", sync: "+r.meadcoSyncinit);var t="false"!==(""+r.meadcoSyncinit).toLowerCase(),o=r.meadcoServer;void 0===o&&(o=r.meadcoPrinthtmlserver),void 0===o?MeadCo.error("No server specified"):(void 0!==c&&c.connect(o,r.meadcoSubscription),t?(MeadCo.warn("Synchronous connection is deprecated, please use data-meadco-syncinit='false'. Note that this may require additional code changes. Please see: https://www.meadroid.com/Developers/KnowledgeBank/HowToGuides/ScriptXServices/ThenToNow/Stage6"),i.connect(o,r.meadcoSubscription)):(MeadCo.log("Async connectlite..."),a.connectLite(o,r.meadcoSubscription)),l=!0)}return!1}),jQuery("[data-meadco-license]").each(function(){if(void 0===a||void 0===i||void 0===c)MeadCo.log("Not auto-connecting client license as print or printHtml or license API not present. Should be present on next attempt.");else if(!l){var e=jQuery(this),r=e.data();MeadCo.log("Auto connect client license to: "+r.meadcoServer+", with license: "+r.meadcoLicense+", path: "+r.meadcoLicensePath+", revision: "+r.meadcoLicenseRevision+", sync: "+r.meadcoSyncinit+", orchestrator: "+r.meadcoOrchestrator+", orchestratorKey: "+r.meadcoOrchestratorKey);var t="false"!==(""+r.meadcoSyncinit).toLowerCase(),o="false"!==(""+r.meadcoReporterror).toLowerCase(),n=r.meadcoServer;m.orchestratorPort=r.meadcoOrchestrator,m.orchestratorKey=r.meadcoOrchestratorKey,t?(MeadCo.warn("Synchronous connection is deprecated, please use data-meadco-syncinit='false'. Note that this may require additional code changes. Please see: https://www.meadroid.com/Developers/KnowledgeBank/HowToGuides/ScriptXServices/ThenToNow/Stage6"),c.connect(n,r.meadcoLicense),void 0!==r.meadcoLicensePath&&void 0!==r.meadcoLicenseRevision&&(c.apply(r.meadcoLicense,r.meadcoLicenseRevision,r.meadcoLicensePath),0!=c.result&&o&&MeadCo.ScriptX.Print.reportError(c.errorMessage)),i.connect(n,r.meadcoLicense)):(MeadCo.log("Async connectlite..."),c.connectLite(n,r.meadcoLicense,r.meadcoLicenseRevision,r.meadcoLicensePath),a.connectLite(n,r.meadcoLicense)),l=!0}return!1})}}()},connect:function(e,r){O(e,r),F({name:"systemdefault",async:!1}),L("",!0,function(e){c=e})},connectLite:function(e,r){O(e,r)},connectAsync:function(e,r,t,o){var n,i;n=t,O(e,r,function(e){F({name:"systemdefault",done:n,async:!0,fail:i}),L("",!0,function(e){c=e})},i=o)},connectTestAsync:function(e,r,t){m.verifyUrl(e,!0,r,t)},serviceDescription:function(){return c||L("",!1,function(e){c=e},function(e){MeadCo.ScriptX.Print.reportError(e.message)}),c},serviceDescriptionAsync:function(r,e){c?r(c):L("",!0,function(e){r(c=e)},e)},connectDeviceAndPrinters:function(e,r){n=!0,k(e),a=r},get isConnected(){return n},get availablePrinterNames(){return a},addPrinterConnection:function(e){Q("PUT",e)},removePrinterConnection:function(e){Q("DELETE",e)},addPrinterConnectionAsync:function(e,r,t){x("PUT",e,r,t)},removePrinterConnectionAsync:function(e,r,t){x("DELETE",e,r,t)},getFromServer:function(e,r,t,o){L(p+e,r,t,o)},printHtml:function(e,r,t,o,n,i){if(!r||"string"==typeof r&&0===r.length)return MeadCo.ScriptX.Print.reportError("Request to print no content - access denied?"),"function"==typeof o&&o("Request to print no content"),!1;var a=Date.now();return I<a-N&&(U=0),N=a,setTimeout(D(e,r,t,i,o,n,function(e){window.open(e,"_self")}),U),U+=R,!0},requestHtmlPreview:function(e,r,t,o,n){var i=v;v=g,D(e,r,t,{},o,function(){},n)(),v=i},printPdf:function(e,r,t,o,n){if(!e||"string"==typeof e&&0===e.length)return MeadCo.ScriptX.Print.reportError("The document to print must be given."),"function"==typeof t&&t("Request to print no content"),!1;var i=Date.now();return I<i-N&&(U=0),N=i,setTimeout(function(e,r,n,t,o){var i;MeadCo.log("started MeadCo.ScriptX.Print.print.printPdfAtServer() document: "+e+", printerName: "+v),i=""===v?{}:JSON.parse(JSON.stringify(C[v]));var a={Document:e,Description:r.jobDescription,Settings:JSON.parse(JSON.stringify(r)),Device:i,ProtectedContentAccess:h,OnProgress:t,UserData:o};a.Settings.jobTitle=r.jobDescription;var c=MeadCo.makeApiEndPoint(m.url,d),s={jobIdentifier:Date.now(),printerName:a.Device.printerName,jobName:"Job timeout hold clientside"};E(s);var l=j;return j="",function(){return b(s.jobIdentifier),A(c,a,{fail:function(e,r,t){var o=MeadCo.parseAjaxError("MeadCo.ScriptX.Print.printPdfAtServer",e,r,t);T(a,P.ERROR,o),MeadCo.ScriptX.Print.reportError(o),"function"==typeof n&&n("Server error")},queuedToFile:function(e){MeadCo.log("default handler on queued to file response"),T(a,P.QUEUED),q(c,a,e.jobIdentifier,-1,function(e){if(null!==e){MeadCo.log("Will download printed file"),T(a,P.COMPLETED);var r=c+"/download/"+e.jobIdentifier;0<l.length&&(r+="/"+l),window.open(r,"_self")}"function"==typeof n&&n(null===e?"Server error":null)})},queuedToDevice:function(e){MeadCo.log("print was queued to device"),T(a,P.QUEUED),q(c,a,e.jobIdentifier,-1,function(e){null!==e&&T(a,P.COMPLETED),"function"==typeof n&&n(null===e?"Server error":null)})},softError:function(e){T(a,P.ERROR,e.message),MeadCo.ScriptX.Print.reportError(e.message),MeadCo.log("printpdf call has soft error, remove job: "+e.jobIdentifier),b(e.jobIdentifier),"function"==typeof n&&(MeadCo.log("Call fnDone"),n("Server error"))},ok:function(e){T(a,P.COMPLETED),MeadCo.log("printed ok, no further information"),b(e.jobIdentifier),"function"==typeof n&&n(null)}})}}(e,r,t,o,n),U),U+=R,!0},printDirect:function(e,r,n){if(MeadCo.log("started MeadCo.ScriptX.Print.print.printDirectAtServer() Type: "+e+", printerName: "+v),e===y.URL)MeadCo.log(".. request print url: "+r);else if(e!==y.STRING)return MeadCo.ScriptX.Print.reportError("Bad content type for direct printing"),"function"==typeof n&&n("Bad content type for direct printing"),!1;if(!r||"string"==typeof r&&0===r.length)return MeadCo.ScriptX.Print.reportError("Request to print no content - access denied?"),"function"==typeof n&&n("Request to print no content"),!1;if(""===v)return MeadCo.ScriptX.Print.reportError("Request to print but no current printer defined."),"function"==typeof n&&n("Request to print but no current printer defined."),!1;var t={ContentType:e,Content:r,PrinterName:v,Settings:{jobTitle:"Direct print"},Device:C[v]};return A(MeadCo.makeApiEndPoint(m.url,o),t,{fail:function(e,r,t){var o=MeadCo.parseAjaxError("MeadCo.ScriptX.Print.printDirectAtServer",e,r,t);MeadCo.ScriptX.Print.reportError(o),"function"==typeof n&&n("Server error")},softError:function(e){MeadCo.ScriptX.Print.reportError(e.message),MeadCo.log("print has soft error"),b(e.jobIdentifier),"function"==typeof n&&(MeadCo.log("Call fnDone"),n(e.message))},ok:function(e){MeadCo.log("printed ok, no further information"),b(e.jobIdentifier),"function"==typeof n&&n(null)}})},parseAjaxError:function(e,r,t,o){return MeadCo.parseAjaxError(e,r,t,o)},reportError:function(e){switch(MeadCo.error("ReportError: "+e),S){case r.REPORT:MeadCo.ScriptX.Print.reportServerError(e);break;case r.THROW:throw new Error(e)}},reportServerError:function(e){alert("There was an error in the printing service\n\n"+e)},reportFeatureNotImplemented:function(e){MeadCo.log("Call to not implemented: "+e),alert(e+"\n\nis not available.")},get queue(){return s},get activeJobs(){return w()},ensureSpoolingStatus:function(){var e={jobIdentifier:Date.now(),printerName:"ensureJobsPrinter",jobName:"null Job"};return E(e),e},freeSpoolStatus:function(e){b(e.jobIdentifier)},get isSpooling(){return 0<w()},waitForSpoolingComplete:function(e,r){if(MeadCo.log("Started WaitForSpoolingComplete("+e+")"),"function"!=typeof r)throw"WaitForSpoolingComplete requires a completion callback";var t=Date.now(),o=window.setInterval(function(){0===w()?(MeadCo.log("WaitForSpoolingComplete - complete"),window.clearInterval(o),r(!0)):0<=e&&Date.now()-t>e&&(MeadCo.log("WaitForSpoolingComplete - timeout"),window.clearInterval(o),r(0===w()))},250)},get queueTimeoutSpacing(){return R},set queueTimeoutSpacing(e){R=e},get queueGapResetTime(){return I},set queueGapResetTime(e){I=e},get jobFileName(){return j},set jobFileName(e){j=e},requestService:function(e,r,t,o,n,i,a){return X(e,r,t,o,n,i,a)},getService:function(e,r,t){return X(e,"GET",r,t,!1)},postService:function(e,r,t){return X(e,"POST",r,t,!1)},getServiceAsync:function(e,r,t,o,n){return X(e,"GET",r,t,!0,o,n)},postServiceAsync:function(e,r,t,o,n){return X(e,"POST",r,t,!0,o,n)}}});
extendMeadCoNamespace("MeadCo.ScriptX.Print.Licensing",function(){var n="1.14.0.2",a="v1/licensing",d="",o=0,r="",p="No license applied",l={};function c(n,e){var t=MeadCo.ScriptX.Print;void 0!==t&&"function"==typeof t.connectLite?t.connectLite(n,e):console.error("MeadCo.ScriptX.Print is not available"),d=e,l={},p="No license applied",o=0,r=""}function t(e,t){var n=MeadCo.ScriptX.Print;if(void 0!==n&&"function"==typeof n.connectLite)return 0<l.length?"function"==typeof e&&e(l):n.requestService(a,"GET",{},!0,"function"==typeof e,function(n){p="",$.extend(l,n),"function"!=typeof e||e(l)},function(n){p=n,"function"!=typeof t?MeadCo.warn("No reject function for: "+p):t(p)}),l;var i="MeadCo.ScriptX.Licensing : MeadCo.ScriptX.Print API not available";if("function"!=typeof t)throw new Error(i);t(i)}function u(n,e,t,i,o){MeadCo.log("Apply license: "+n+",revision: "+e+", path: "+t);var r=MeadCo.ScriptX.Print;if(void 0===r||"function"!=typeof r.connectLite){var c="MeadCo.ScriptX.Licensing : MeadCo.ScriptX.Print API not available";if("function"==typeof o)return void o(c);MeadCo.warn("No reject function for: "+c)}if("warehouse"!==t.toLowerCase()){var u=new URL(t,window.location.href);t=u.href,MeadCo.log("path updated to: "+t)}var f={Guid:d=n,Url:t,Revision:e};return r.requestService(a,"POST",f,!1,"function"==typeof i,function(n){p="",$.extend(l,n),"function"!=typeof i||i(l)},function(n){p=n,"function"!=typeof o||o(p)}),"function"!=typeof i?(MeadCo.log("returning applied (sync) license: "+l.company),l):0}return MeadCo.log("MeadCo.ScriptX.Print.Licensing "+n+" loaded."),{get version(){return n},connect:function(n,e){c(n,e)},connectLite:function(n,e,t,i){c(n,e),o=t,r=i},apply:function(n,e,t){return u(n,e,t)},applyAsync:function(n,e,t,i,o){u(n,e,t,i,o)},get result(){return""===p?0:5},get validLicense(){return void 0!==l.guid},get errorMessage(){return p},get detailOnError(){return p},get License(){return void 0!==l.guid?l:t(null,function(n){throw new Error(n)})},GetLicenseAsync:function(n,e){t(n,e)},PolyfillInit:function(){return void 0!==l.guid||""!==d&&(""===r||(u(d,o,r),void 0!==l.guid))},PolyfillInitAsync:function(n,e){void 0!==l.guid||""===r?n(l):u(d,o,r,n,e)}}});
!function(e,t,i){if(this[e]!==i||null!==document.getElementById(e)){if(MeadCo.log("ScriptX.Services MeadCo Security Manager emulation believes it may not be required."),this[e]!==i&&MeadCo.log("this["+e+"] is defined"),null!==document.getElementById(e)&&MeadCo.log("document.getElementById("+e+") is defined"),this[e].object!==i)return MeadCo.log("this["+e+"].object is defined -- not required!!!");MeadCo.log("this["+e+"].object is *not* defined")}MeadCo.log("ScriptX.Services MeadCo Security Manager emulation believes it is required.");var n=function(){var t=MeadCo,e=MeadCo.ScriptX.Print,i=MeadCo.ScriptX.Print.Licensing;function s(e){t.log("secmgr emulation :: "+e)}this.extendSecMgrNamespace=function(e,t){var i=t();s("MeadCo security manager extending namespace2: "+e);for(var n=e.split("."),r=this,o=0;o<n.length;o++){var a=n[o];o===n.length-1?void 0===r[a]?(s("installing implementation at: "+a),r[a]=i):s("Warning - not overwriting package: "+a):void 0===r[a]?(s("initialising new: "+a),r[a]={}):s("using existing package: "+a),r=r[a]}},s("'secmgr' loaded."),"function"!=typeof i.GetLicenseAsync&&MeadCo.error("MeadCo.ScriptX.Print.Licensing not available");"function"!=typeof e.useAttributes?MeadCo.warn("Attribute based licensing not available as MeadCo.ScriptX.Print is not available"):e.useAttributes();return{log:s,get version(){return"1.14.0.0"},get result(){return i.result},get validLicense(){return i.validLicense},get License(){return i.License},get errorMessage(){return i.errorMessage},GetLicenseAsync:function(e,t){i.GetLicenseAsync(e,t)},PolyfillInit:function(){return i.PolyfillInit()},PolyfillInitAsync:function(e,t){i.PolyfillInitAsync(e,t)}}}();this[e]=n}("secmgr"),"function"==typeof extendSecMgrNamespace&&extendSecMgrNamespace("secmgr.object",function(){return this.secmgr.log("secmgr.object loaded."),this.secmgr});