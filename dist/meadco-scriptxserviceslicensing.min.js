!function(e,n){var r=function(){var e=this,n="1.15.1.4",r="undefined"!=typeof MeadCo&&void 0!==MeadCo.logEnable&&MeadCo.logEnable,o="undefined"!=typeof MeadCo&&void 0!==MeadCo.useFetch&&MeadCo.useFetch,t=function(e){r&&console.log("MeadCo :: "+e)},s=function(e){console.warn("MeadCo :: "+e)},a=function(e){console.error("MeadCo :: "+e)};function i(e,n,r,o){return a("**warning: AJAX call failure in "+e+": ["+r+"], ["+o+"], ["+n.responseText+"], ["+n.statusText+"]"),""===o||"Internal Server Error"===o?o="error"!==r?n.responseText||r:"object"==typeof n.responseJSON&&"string"==typeof n.responseJSON.Message?n.responseJSON.Message:"string"==typeof n.responseText?n.responseText:"Server or network error":"object"!=typeof n.responseJSON&&"string"==typeof n.responseText&&n.responseText.length>0&&(o=n.responseText),a(" error parsed to --\x3e ["+o+"]"),o}return e.extendMeadCoNamespace=function(n,r){var o=r();t("MeadCo root extending namespace: "+n);for(var s=n.split("."),a=e.scope||this.jQuery||this.ender||this.$||this,i=0;i<s.length;i++){var l=s[i];if(i===s.length-1)if(void 0===a[l])t("installing implementation at: "+l),a[l]=o;else{t("Warning - extending package: "+l);var p=a[l];a[l]=o;var d=a[l];for(var c in t("preserving old scope ... "),p)p.hasOwnProperty(c)&&(t("will preserve: "+c),d[c]=p[c])}else void 0===a[l]?(t("initialising new: "+l),a[l]={}):t("using existing package: "+l);a=a[l]}},t("MeadCo root namespace "+n+" loaded."),{log:t,warn:s,error:a,get version(){return n},get logEnabled(){return r},set logEnabled(e){r=e},get fetchEnabled(){return o},set fetchEnabled(e){o=e},createNS:function(n){var r=n.split("."),o=e.scope.MeadCo;"MeadCo"===r[0]&&(r=r.slice(1));for(var t=0;t<r.length;t++){var s=r[t];void 0===o[s]&&(o[s]={}),o=o[s]}return o},set scope(n){e.scope=n},makeApiEndPoint:function(e,n){var r=e.indexOf("/api");return-1===r?(e.lastIndexOf("/")!==e.length-1&&(e+="/"),e+="api/"+n):e=e.substring(0,r)+"/api/"+n,e},makeServiceEndPoint:function(e,n){var r=e.indexOf("/api");return-1===r?(e.lastIndexOf("/")!==e.length-1&&(e+="/"),e+=n):e=e.substring(0,r)+"/"+n,e},parseAjaxError:function(e,n,r,o){return i(e,n,r,o)},parseFetchError:function(e,n){const r="string"==typeof n?n:n.message;return a("**warning: FETCH call failure in "+e+": "+r),r}}}(),o=this,t=null;if(void 0!==o[e]&&(t=o[e]),o[e]=r,null!==t){var s=o[e];for(var a in t)t.hasOwnProperty(a)&&(s[a]=t[a])}r.scope=o}("MeadCo");
extendMeadCoNamespace("MeadCo.ScriptX.Print",(function(){const e="1.15.1.18",r="v1/printHtml",t="v1/printPdf",o="v1/printDirect",n="v1/licensing",i="v1/printer";let a="";const s="ScriptX.Services//PrintPreview.1",c="[hold.clientside]",l="[wait.response]",d="[hold.ensureSpoolStatus]",u={DEFAULT:0,INCHES:1,MM:2};var f={cookie:""};let p={};const h=this;let v=[];const g={serviceUrl:"",pendingUrl:"",failedUrl:"",verifiedUrl:"",orchestratorPort:0,orchestratorKey:"",portsToTry:10,verifying:!1,trustVerifiedConnection:!0,undoTrust:function(){this.trustVerifiedConnection||""===this.serviceUrl||(this.verifiedUrl=this.serviceUrl,this.pendingUrl=this.serviceUrl,this.serviceUrl="")},get url(){if(""!==this.verifiedUrl)return this.verifiedUrl;if(""===this.serviceUrl&&""!==this.pendingUrl){MeadCo.warn("[GET] servicesServer.url is not ready, performing synchronous search. Recommend code re-org to resolve the server earlier and asynchronously.");var e=this;this.verifyUrl(this.pendingUrl,!1,(function(){return e.serviceUrl}),(function(){return""}))}return this.serviceUrl},set url(e){MeadCo.log("servicesServer::setUrl: "+e),this.IsChangingServer(e)&&(MeadCo.log("note set as pending"),this.serviceUrl="",this.pendingUrl=e)},setUrlAsync:function(e,r,t){MeadCo.log("servicesServer::urlAsync: "+e),this.verifyUrl(e,!0,r,t)},verifyUrl:function(e,r,t,o){if(this.verifying&&r){MeadCo.warn("Verify called and verify in progress ....");var n=this,i=e;window.setTimeout((function(){n.verifyUrl(i,r,t,o)}),1e3)}else if(this.IsChangingServer(e)&&!this.IsFailedConnection(e)){var a;n=this,i=e,MeadCo.log("servicesServer::verifyurl: "+e+", async: "+r),"number"!=typeof this.orchestratorPort&&(this.orchestratorPort=parseInt(""+this.orchestratorPort)),this.orchestratorPort>0?(MeadCo.log("Using request to Orchestrator on port: "+this.orchestratorPort),n.verifying=!0,a="string"==typeof this.orchestratorKey&&this.orchestratorKey.length>0?"/api/v2?key="+this.orchestratorKey:"/api/v1",MeadCo.log("servicesServer::querying orchestrator: http://127.0.0.1:"+this.orchestratorPort+a),h.jQuery&&!MeadCo.fetchEnabled?h.jQuery.ajax("http://127.0.0.1:"+this.orchestratorPort+a,{method:"GET",dataType:"json",cache:!1,async:r}).done((function(e){MeadCo.log("orchestrator returned ScriptX.Services port: "+e.HttpPort);var a=new URL(i);a.port=e.HttpPort,i=a.protocol+"//"+a.host+a.pathname,n.test(i,0,r,(function(e){n.serviceUrl=e,n.pendingUrl="",n.verifying=!1,t(e,!0)}),(function(e){n.serviceUrl="",n.pendingUrl="",n.failedUrl=i,n.verifying=!1,"function"==typeof o&&o(e)}))})).fail((function(e,r,t){n.verifying=!1,n.serviceUrl="",n.pendingUrl="",n.failedUrl=i;const a=MeadCo.parseAjaxError("Failed to connect with Orchestrator: ",e,r,t);MeadCo.warn(a),"function"==typeof o&&o("Failed to connect with Orchestrator: "+a)})):fetch("http://127.0.0.1:"+this.orchestratorPort+a).then((e=>{if(!e.ok)throw new Error(`HTTP Error: ${e.status}`);return e.json()})).then((e=>{MeadCo.log("orchestrator returned ScriptX.Services port: "+e.HttpPort);var a=new URL(i);a.port=e.HttpPort,i=a.protocol+"//"+a.host+a.pathname,n.test(i,0,r,(function(e){n.serviceUrl=e,n.pendingUrl="",n.verifying=!1,t(e,!0)}),(function(e){n.serviceUrl="",n.pendingUrl="",n.failedUrl=i,n.verifying=!1,"function"==typeof o&&o(e)}))})).catch((r=>{n.verifying=!1,n.serviceUrl="",n.pendingUrl="",n.failedUrl=i;const t=MeadCo.parseFetchError("MeadCo.ScriptX.Print:verifyUrl - "+e,r);"function"==typeof o&&o("Failed to connect with Orchestrator: "+t)}))):(n.verifying=!0,n.test(i,n.portsToTry,r,(function(e){n.serviceUrl=e,n.pendingUrl="",n.verifying=!1,t(e,!1)}),(function(e){if(n.serviceUrl="",n.pendingUrl="",n.verifying=!1,n.failedUrl=i,"function"==typeof o){var r=new URL(i);o("ScriptX.Services could not be found at "+r.protocol+"//"+r.host+". Is it installed and running?")}})))}else this.IsFailedConnection(e)?"function"==typeof o?o("ScriptX.Services connection to: "+e+" has already failed and will not be re-tried."):MeadCo.warn("ScriptX.Services connection to: "+e+" has already failed and will not be re-tried."):t(this.serviceUrl,this.orchestratorPort>0)},test:function(e,r,t,o,i){if(e.length>0){const a=this;let s=new URL(e);MeadCo.log("Test server requested: "+e+", port: "+s.port);const c=MeadCo.makeApiEndPoint(s.href,n+"/ping");h.jQuery&&!MeadCo.fetchEnabled?(MeadCo.log(".ajax() get: "+c),h.jQuery.ajax(c,{method:"GET",dataType:"json",cache:!1,async:t}).done((function(e){const r=s.protocol+"//"+s.host+s.pathname;MeadCo.log("Test server succeed, resolve("+r+")"),o(r)})).fail((function(e,n,c){MeadCo.log("Test server failed: ["+c+"], "+r+", on: "+s.hostname),r>0&&("localhost"===s.hostname||"127.0.0.1"==s.hostname)?(s.port++,h.setTimeout(a.test(s.protocol+"//"+s.host+s.pathname,--r,t,o,i),1)):(c=MeadCo.parseAjaxError("MeadCo.ScriptX.Print.servicesServer.test:",e,n,c),"function"==typeof i?(MeadCo.log("rejecting with: "+c),i(c)):MeadCo.warn("failed with no reject function"))}))):(MeadCo.log("fetch get: "+c),t?fetch(c).then((e=>{if(!e.ok)throw new Error(`HTTP Error: ${e.status}`);return e.json()})).then((e=>{const r=s.protocol+"//"+s.host+s.pathname;MeadCo.log("Test server succeed, resolve("+r+")"),o(r)})).catch((e=>{MeadCo.log("Test server failed: ["+e+"], "+r+", on: "+s.hostname),r>0&&("localhost"===s.hostname||"127.0.0.1"==s.hostname)?(s.port++,h.setTimeout(a.test(s.protocol+"//"+s.host+s.pathname,--r,t,o,i),1)):(errorThrown=MeadCo.parseFetchError("MeadCo.ScriptX.Print.servicesServer.test:",e),"function"==typeof i?(MeadCo.log("rejecting with: "+errorThrown),i(errorThrown)):MeadCo.warn("failed with no reject function"))})):(MeadCo.error("Synchronous Ajax calls requires jQuery"),"function"==typeof i&&i("Synchronous Ajax calls requires jQuery")))}},call:function(e,r,t,o,n,i,a){const s=this;if(""===this.serviceUrl&&""!==this.pendingUrl)this.verifyUrl(this.pendingUrl,n,(function(){""!==s.url?s.call(e,r,t,o,n,i,a):"function"==typeof a&&a("Server url verification failed to set url")}),a);else if(""!==this.serviceUrl){const c=MeadCo.makeApiEndPoint(this.serviceUrl,e);MeadCo.log("servicesServer.call() "+r+": "+c);let l={method:r,cache:!1,async:n,jsonp:!1,dataType:"json",contentType:"application/json"};if(o&&(l.headers={Authorization:"Basic "+btoa(m+":")}),this.IsEmptyPayload(t)||(MeadCo.log("payload defined."),l.data=JSON.stringify(t)),h.jQuery&&!MeadCo.fetchEnabled)h.jQuery.ajax(c,l).done((function(e){return"function"==typeof i&&i(e),e})).fail((function(t,o,n){if(n=MeadCo.parseAjaxError("MeadCo.ScriptX.Print:"+e+r,t,o,n),"function"!=typeof a)throw new Error(n);a(n)})).always((function(e,r,t){s.undoTrust()}));else if(n)l.headers=o?{Authorization:"Basic "+btoa(m+":"),"Content-type":"application/json"}:{"Content-type":"application/json"},fetch(c,{method:l.method,headers:l.headers,body:l.data,referrerPolicy:"origin-when-cross-origin",mode:"cors",credentials:"omit",cache:"no-store",redirect:"error",keepalive:!1}).then((t=>{if(s.undoTrust(),t.ok)return t.json();if(500==t.status||404==t.status)t.text().then((t=>{const o=MeadCo.parseFetchError("MeadCo.ScriptX.Print:"+e+r,t);if("function"!=typeof a)throw new Error(o);a(o)}));else{if("function"!=typeof a)throw new Error(t.statusText);a(t.statusText)}})).then((e=>{e&&"function"==typeof i&&i(e)})).catch((t=>{const o=MeadCo.parseFetchError("MeadCo.ScriptX.Print:"+e+r,t);if("function"!=typeof a)throw new Error(o);a(o)}));else{if("function"!=typeof a)throw new Error("Synchronous Ajax calls requires jQuery");a("Synchronous Ajax calls requires jQuery")}}else{if("function"!=typeof a)throw new Error("MeadCo.ScriptX.Print : server connection is not defined.");a("MeadCo.ScriptX.Print : server connection is not defined.")}return!0},IsChangingServer:function(e){if(""!==this.serviceUrl)try{var r=new URL(this.serviceUrl),t=new URL(e);return r.hostname!=t.hostname||r.port!=t.port&&0==this.orchestratorPort}catch(r){return MeadCo.error("Failed to construct URL(): "+r.message+", from: "+this.serviceUrl+", or: "+e),MeadCo.error("Many errors will ensue"),!1}return!0},IsEmptyPayload:e=>null===e||0===Object.keys(e).length&&e.constructor===Object,IsFailedConnection:function(e){if(this.failedUrl.length>0)try{var r=new URL(this.failedUrl),t=new URL(e);return r.hostname===t.hostname&&(MeadCo.warn("Attempt to use: "+e+" is noted as a failed connection and will not be retried"),!0)}catch(r){return MeadCo.error("Testing IsFailed unable to construct URL(): "+r.message+", from: "+this.failedUrl+", or: "+e),!0}return!1}};var m="",C=!1,y=!1,S=[],M=null,w={URL:1,HTML:2,INNERHTML:4,STRING:8},E={UNKNOWN:0,QUEUEDTODEVICE:1,QUEUEDTOFILE:2,SOFTERROR:3,OK:4},P={REPORT:1,THROW:2},T=P.REPORT,b={CLOUD:1,ONPREMISE:2,WINDOWSPC:3},U={NOTSTARTED:0,QUEUED:1,STARTING:2,DOWNLOADING:3,DOWNLOADED:4,PRINTING:5,COMPLETED:6,PAUSED:7,PRINTPDF:8,ERROR:-1,ABANDONED:-2},D={DEFAULT:0,TRUE:1,FALSE:2},j={DEFAULT:0,SIMPLEX:1,VERTICAL:2,HORIZONTAL:3};function N(e){v.push(e),MeadCo.log("ScriptX.Print queueJob: "+e.jobIdentifier+", name: "+e.jobName+", jobCount: "+v.length)}function R(){return MeadCo.log("ScriptX.Print jobCount: "+v.length),v.length}function I(e){return v.find((r=>r.jobIdentifier===e))}function O(e){let r=I(e.jobIdentifier);r?Object.keys(e).forEach((function(t){r[t]=e[t]})):MeadCo.warn("Unable to find job: "+e.jobIdentifier+" to update it")}function A(e){v=v.filter((r=>r.jobIdentifier!==e)),MeadCo.log(`ScriptX.Print removed job: ${e}, jobCount: ${v.length}`),0==v.length&&(k=0)}function L(e,r,t){"function"==typeof e.OnProgress&&e.OnProgress(r,t,e.UserData)}var X="";function q(e,t,o,n,i,l,d){var u;MeadCo.log("started MeadCo.ScriptX.Print.print.printHtmlAtServer() Type: "+e),e===w.URL&&MeadCo.log(".. request print url: "+t),u=""===a?{}:a===s?JSON.parse(JSON.stringify({printerName:a})):JSON.parse(JSON.stringify(p[a]));var h={ContentType:e,Content:t,Settings:JSON.parse(JSON.stringify(o)),Device:u,ProtectedContentAccess:f,OnProgress:l,UserData:n},v={jobIdentifier:Date.now(),printerName:h.Device.printerName,jobName:c};N(v);var m=X;X="";var C=d;return function(){return A(v.jobIdentifier),$(r,h,{fail:function(e){L(h,U.ERROR,e),MeadCo.ScriptX.Print.reportError(e),"function"==typeof i&&i("Server error")},queuedToFile:function(e){MeadCo.log("print is being queued to a file"),L(h,U.QUEUED),Y(r,h,e.jobIdentifier,-1,(function(e){if(null!==e){MeadCo.log("download printed file is available"),L(h,U.COMPLETED);var t=MeadCo.makeApiEndPoint(g.url,r+"/download/"+e.jobIdentifier);m.length>0&&(t+="/"+m),C(t,e.jobIdentifier)}"function"==typeof i&&i(null===e?"Server error":null)}))},queuedToDevice:function(e){MeadCo.log("print was queued to device"),L(h,U.QUEUED),Y(r,h,e.jobIdentifier,-1,(function(e){null!==e&&L(h,U.COMPLETED),"function"==typeof i&&i(null===e?"Server error":null)}))},softError:function(e){L(h,U.ERROR,e.message),MeadCo.ScriptX.Print.reportError(e.message),MeadCo.log("print has soft error"),A(e.jobIdentifier),"function"==typeof i&&(MeadCo.log("Call fnDone"),i(e.message))},ok:function(e){L(h,U.COMPLETED),MeadCo.log("printed ok, no further information"),A(e.jobIdentifier),"function"==typeof i&&i(null)}})}}var F=0,k=0,Q=750,W=1e4;function J(e,r,t,o,n,i){if(!r||"string"==typeof r&&0===r.length)return MeadCo.ScriptX.Print.reportError("Request to print no content - access denied?"),"function"==typeof o&&o("Request to print no content"),!1;var a=Date.now();return a-k>W&&(F=0),k=a,setTimeout(q(e,r,t,i,o,n,(function(e){window.open(e,"_self")})),F),F+=Q,!0}function H(e,r,o,n,i){let s;MeadCo.log("started MeadCo.ScriptX.Print.print.printPdfAtServer() document: "+e+", printerName: "+a),s=""===a?{}:JSON.parse(JSON.stringify(p[a]));const l={Document:e,Description:r.jobDescription,Settings:JSON.parse(JSON.stringify(r)),Device:s,ProtectedContentAccess:f,OnProgress:n,UserData:i};l.Settings.jobTitle=r.jobDescription;const d={jobIdentifier:Date.now(),printerName:l.Device.printerName,jobName:c};N(d);var u=X;return X="",function(){return A(d.jobIdentifier),$(t,l,{fail:function(e){L(l,U.ERROR,e),MeadCo.ScriptX.Print.reportError(e),"function"==typeof o&&o("Server error")},queuedToFile:function(e){MeadCo.log("default handler on queued to file response"),L(l,U.QUEUED),Y(t,l,e.jobIdentifier,-1,(function(e){if(null!==e){MeadCo.log("Will download printed file"),L(l,U.COMPLETED);let r=MeadCo.makeApiEndPoint(g.url,t+"/download/"+e.jobIdentifier);u.length>0&&(r+="/"+u),window.open(r,"_self")}"function"==typeof o&&o(null===e?"Server error":null)}))},queuedToDevice:function(e){MeadCo.log("print was queued to device"),L(l,U.QUEUED),Y(t,l,e.jobIdentifier,-1,(function(e){null!==e&&L(l,U.COMPLETED),"function"==typeof o&&o(null===e?"Server error":null)}))},softError:function(e){L(l,U.ERROR,e.message),MeadCo.ScriptX.Print.reportError(e.message),MeadCo.log("printpdf call has soft error, remove job: "+e.jobIdentifier),A(e.jobIdentifier),"function"==typeof o&&(MeadCo.log("Call fnDone"),o("Server error"))},ok:function(e){L(l,U.COMPLETED),MeadCo.log("printed ok, no further information"),A(e.jobIdentifier),"function"==typeof o&&o(null)}})}}function x(e,r,t,o,n){if(!e||"string"==typeof e&&0===e.length)return MeadCo.ScriptX.Print.reportError("The document to print must be given."),"function"==typeof t&&t("Request to print no content"),!1;const i=Date.now();return i-k>W&&(F=0),k=i,setTimeout(H(e,r,t,o,n),F),F+=Q,!0}function G(e,r,t){if(MeadCo.log("started MeadCo.ScriptX.Print.print.printDirectAtServer() Type: "+e+", printerName: "+a),e===w.URL)MeadCo.log(".. request print url: "+r);else if(e!==w.STRING)return MeadCo.ScriptX.Print.reportError("Bad content type for direct printing"),"function"==typeof t&&t("Bad content type for direct printing"),!1;if(!r||"string"==typeof r&&0===r.length)return MeadCo.ScriptX.Print.reportError("Request to print no content - access denied?"),"function"==typeof t&&t("Request to print no content"),!1;if(""===a)return MeadCo.ScriptX.Print.reportError("Request to print but no current printer defined."),"function"==typeof t&&t("Request to print but no current printer defined."),!1;const n={ContentType:e,Content:r,PrinterName:a,Settings:{jobTitle:"Direct print"},Device:p[a]};return $(o,n,{fail:function(e){MeadCo.ScriptX.Print.reportError(e),"function"==typeof t&&t("Server error")},softError:function(e){MeadCo.ScriptX.Print.reportError(e.message),MeadCo.log("print has soft error"),A(e.jobIdentifier),"function"==typeof t&&(MeadCo.log("Call fnDone"),t(e.message))},ok:function(e){MeadCo.log("printed ok, no further information"),A(e.jobIdentifier),"function"==typeof t&&t(null)}})}function K(e,r,t,o){"string"==typeof e&&e.length>0?(MeadCo.log("Print server requested: "+e+" with license: "+r),m="string"==typeof r&&r.length>0?r:m,a="",p={},v=[],C=!1,S=[],"function"==typeof t?g.setUrlAsync(e,t,o):g.url=e):(MeadCo.log("Print server retained in setServer: "+g.url+" may update with license: {"+r+"} (if provided)"),m="string"==typeof r&&r.length>0?r:m)}function V(e,r){K(e,r),re({name:"systemdefault",async:!1}),z("",!0,(function(e){M=e}))}function B(e,r,t,o){K(e,r,(function(e){re({name:"systemdefault",done:t,async:!0,fail:o}),z("",!0,(function(e){M=e}))}),o)}function $(e,r,t){const o={jobIdentifier:Date.now(),printerName:r.Device.printerName,jobName:l};return MeadCo.log("printAtServer using: "+e),N(o),_(e+"/print","POST",r,!0,!0,(e=>{switch(MeadCo.log("Success response: "+e.status),e.printerName=r.Device.printerName,e.jobName="string"==typeof r.Settings.jobTitle&&r.Settings.jobTitle.length>0?r.Settings.jobTitle:"server job",N(e),A(o.jobIdentifier),e.status){case E.QUEUEDTOFILE:t.queuedToFile(e);break;case E.QUEUEDTODEVICE:t.queuedToDevice(e);break;case E.SOFTERROR:case E.UNKNOWN:t.softError(e);break;case E.OK:t.ok(e)}}),(e=>{A(o.jobIdentifier),"function"==typeof t.fail&&t.fail(e)}))}function z(e,r,t,o){return _(e,"GET",null,!0,r,t,o)}function _(e,r,t,o,n,i,a){return g.call(e,r,t,o,n,i,a)}function Z(e,r,t,o,n,i){switch(MeadCo.log("processMonitorResponse::jobStatus: "+r.status),r.status){case U.COMPLETED:MeadCo.log("clear interval: "+t),window.clearInterval(t),A(o),i(r);break;case U.NOTSTARTED:case U.DOWNLOADED:case U.DOWNLOADING:case U.PRINTING:case U.QUEUED:case U.STARTING:case U.PAUSED:case U.PRINTPDF:L(e,r.status,r.message),O(r),n>0&&++counter*interval>n&&(window.clearInterval(t),MeadCo.ScriptX.Print.reportError("unknown failure while printing."));break;case U.ERROR:case U.ABANDONED:MeadCo.log("error status in monitorJob so clear interval: "+t),L(e,r.status,r.message),A(o),window.clearInterval(t),MeadCo.ScriptX.Print.reportError("The print failed with the error: "+r.message),i(null);break;default:L(e,r.status,r.message),MeadCo.log("unknown status in monitorJob so clear interval: "+t),A(o),window.clearInterval(t),i(null)}}function Y(e,r,t,o,n){MeadCo.log("monitorJob: "+t);const i=1e3;let a=!1,s=window.setInterval((function(){a?MeadCo.log("** info : still waiting for last status request to complete"):(a=!0,z(e+"/status/"+t,!0,(e=>{Z(r,e,s,t,o,n),a=!1}),(e=>{MeadCo.log("error: "+e+" in monitorJob so clear interval: "+s),L(r,U.ERROR,e),A(t),window.clearInterval(s),n(null),a=!1})))}),i);MeadCo.log("intervalId: "+s)}function ee(e){if("string"==typeof e.printerName){if(e.isDefault)for(var r=0;r<p.length;r++)p[r].isDefault=!1;p[e.printerName]=e,e.isDefault&&0===a.length&&(a=e.printerName)}}function re(e){e.name=e.name.replace(/\\/g,"||"),MeadCo.log("Request get device info: "+e.name),z(r+"/deviceinfo/"+encodeURIComponent(e.name)+"/0",e.async,(function(r){C=!0,ee(r),"function"==typeof e.done&&e.done(r)}),(function(r){"systemdefault"===e.name?(MeadCo.warn("request for systemdefault printer failed - please update to ScriptX.Services 2.11.1"),e.name="default",re(e)):(MeadCo.log("failed to getdevice: "+r),"function"==typeof e.fail&&e.fail(r))}))}function te(e){return"string"==typeof e&&""!==e?(void 0===p[e]&&re({name:e,async:!1,done:function(r){"systemdefault"===e.toLowerCase()&&(e=r.printerName)},fail:function(e){MeadCo.ScriptX.Print.reportError(e)}}),p[e]):{}}function oe(e,r,t){"string"==typeof e&&""!==e?void 0===p[e]?re({name:e,async:!0,done:function(t){"systemdefault"===e.toLowerCase()&&(e=t.printerName),r(p[e])},fail:function(e){t(e)}}):r(p[e]):t("a printer name is required")}function ne(e,r){console.warn("Synchronous calls to add/remove printer connections are not recommeneded as this will lock the browser UI. Consider using the asynchronous versions when working with in ScriptX.Services");var t=MeadCo.ScriptX.Print.serviceDescription();t.serviceClass==b.WINDOWSPC&&t.serviceVersion.major>=2&&t.serviceVersion.minor>=19?_(i+"/Connection/"+encodeURIComponent(r),e,null,!0,!1):MeadCo.error("ScriptX.Services for Windows PC 2.19 or later is required for add/remove PrinterConnection()")}function ie(e,r,t,o){MeadCo.ScriptX.Print.serviceDescriptionAsync((function(n){n.serviceClass==b.WINDOWSPC&&n.serviceVersion.major>=2&&n.serviceVersion.minor>=19?_(i+"/Connection/"+encodeURIComponent(r),e,null,!0,!0,t,o):(MeadCo.error("ScriptX.Services for Windows PC 2.19 or later is required for add/remove PrinterConnection()"),o("add/remove PrinterConnection is not supported"))}),o)}function ae(){if(MeadCo.log("MeadCo.ScriptX.Print ... looking for auto connect, already found?: "+y),!y){var e=MeadCo.ScriptX.Print.HTML,r=MeadCo.ScriptX.Print,t=MeadCo.ScriptX.Print.Licensing;const o=document.querySelector("[data-meadco-subscription]");if(o){const n=o.dataset;MeadCo.log("Auto connect susbcription to: "+n.meadcoServer+", or "+n.meadcoPrinthtmlserver+", with subscription: "+n.meadcoSubscription+", sync: "+n.meadcoSyncinit+", usefetch: "+n.meadcoUsefetch);const i="false"!==(""+n.meadcoSyncinit).toLowerCase();if(i)MeadCo.fetchEnabled=!1;else{const e=""+n.meadcoUsefetch;e.length>0&&(MeadCo.fetchEnabled="true"===e.toLowerCase())}const a=n.meadcoServer;void 0===a&&(a=n.meadcoPrinthtmlserver),void 0===a?MeadCo.error("No server specified"):(void 0!==t&&t.connect(a,n.meadcoSubscription),i?(MeadCo.warn("Synchronous connection is deprecated.jQuery is required for synchronous behaviour.To update to asynchronous behaviour please use data - meadco - syncinit='false'. Note that this may require additional code changes. Please see: https://www.meadroid.com/Developers/KnowledgeBank/HowToGuides/ScriptXServices/ThenToNow/Stage6"),e.connect(a,n.meadcoSubscription)):(MeadCo.log("Async connectlite..."),r.connectLite(a,n.meadcoSubscription)),y=!0)}else{const o=document.querySelector("[data-meadco-license]");if(o)if(void 0===r||void 0===e||void 0===t)MeadCo.log("Not auto-connecting client license as print or printHtml or license API not present. Should be present on next attempt.");else{const n=o.dataset;MeadCo.log("Auto connect client license to: "+n.meadcoServer+", with license: "+n.meadcoLicense+", path: "+n.meadcoLicensePath+", revision: "+n.meadcoLicenseRevision+", sync: "+n.meadcoSyncinit+", useFetch: "+n.meadcoUsefetch+", orchestrator: "+n.meadcoOrchestrator+", orchestratorKey: "+n.meadcoOrchestratorKey+", trustVerifiedConnection: "+n.meadcoTrustVerifiedConnection);const i="false"!==(""+n.meadcoSyncinit).toLowerCase(),a="false"!==(""+n.meadcoReporterror).toLowerCase(),s="true"==(""+n.meadcoApplyLicense).toLowerCase(),c=n.meadcoServer;if(g.orchestratorPort=n.meadcoOrchestrator,g.orchestratorKey=n.meadcoOrchestratorKey,g.trustVerifiedConnection="false"!==(""+n.meadcoTrustVerifiedConnection).toLowerCase(),i)MeadCo.warn("Synchronous connection is deprecated. jQuery is required for synchronous behaviour. To update to asynchronous behaviour please use data-meadco-syncinit='false'. Note that this may require additional code changes. Please see: https://www.meadroid.com/Developers/KnowledgeBank/HowToGuides/ScriptXServices/ThenToNow/Stage6"),MeadCo.fetchEnabled=!1,t.connect(c,n.meadcoLicense),void 0!==n.meadcoLicensePath&&void 0!==n.meadcoLicenseRevision&&(t.apply(n.meadcoLicense,n.meadcoLicenseRevision,n.meadcoLicensePath),0!=t.result&&a&&MeadCo.ScriptX.Print.reportError(t.errorMessage)),e.connect(c,n.meadcoLicense);else{MeadCo.log("Async connectlite...");const e=""+n.meadcoUsefetch;e.length>0&&(MeadCo.fetchEnabled="true"===e.toLowerCase()),t.connectLite(c,n.meadcoLicense,n.meadcoLicenseRevision,n.meadcoLicensePath),r.connectLite(c,n.meadcoLicense),s&&t.applyAsync(n.meadcoLicense,n.meadcoLicenseRevision,n.meadcoLicensePath,(()=>{MeadCo.log("NOTE: license has been applied successfully from async processing of attribute with values")}),(e=>{MeadCo.error(`Failed to apply the license: ${e}, error is: ${t.errorMessage}`),a&&MeadCo.ScriptX.Print.reportError(t.errorMessage)}))}y=!0}}}}return MeadCo.log("MeadCo.ScriptX.Print "+e+" loaded."),{ContentType:w,PrintStatus:U,ErrorAction:P,CollateOptions:D,DuplexOptions:j,MeasurementUnits:u,ServiceClasses:b,get onErrorAction(){return T},set onErrorAction(e){T=e},get orchestrator(){return g.orchestratorPort},set orchestrator(e){g.orchestratorPort=""+e},get orchestratorKey(){return g.orchestratorKey},set orchestratorKey(e){g.orchestratorKey=e},get authorisationCookie(){return f.cookie},set authorisationCookie(e){f.cookie=e},get printerName(){return a},set printerName(e){e!==a&&e.name!==a&&("string"==typeof e?void 0===p[e]?h.jQuery&&!MeadCo.fetchEnabled?re({name:e,done:function(e){a=e.printerName},async:!1,fail:function(e){MeadCo.ScriptX.Print.reportError(e)}}):(MeadCo.error("Asynchronous processing of set printerName required, synchronous calls to obtain device details will fail until this completes."),oe(e,(e=>{a=e.printerName}),(e=>{MeadCo.ScriptX.Print.reportError(e)})),""===g.serviceUrl?MeadCo.ScriptX.Print.reportError("MeadCo.ScriptX.Print : server connection is not defined."):MeadCo.ScriptX.Print.reportError("Not Found")):a=e:re(e))},setSystemDefaultPrinterAsync:function(e,t,o){if(void 0!==p.systemdefault&&p.systemdefault==e)return MeadCo.log("setSystemDefaultPrinterAsync() does NOT need to do anything"),void t();e=(e="system::"+e).replace(/\\/g,"||"),MeadCo.log("Request systemDefaultPrinterAsync: "+e),_(r+"/CurrentPrinter/"+encodeURIComponent(e),"PUT",null,!0,!0,t,o)},get version(){return e},get serviceUrl(){return g.url},serviceVersion:function(){return this.serviceDescription().serviceVersion},serviceVersionAsync:function(e,r){this.serviceDescriptionAsync((function(r){e(r.serviceVersion)}),r)},get deviceSettings(){return""!==a?p[a]:{}},set deviceSettings(e){ee(e)},deviceSettingsFor:function(e){return te(e)},deviceSettingsForAsync:function(e,r,t){oe(e,r,t)},useAttributes:function(){ae()},connect:function(e,r){V(e,r)},connectLite:function(e,r){K(e,r)},connectAsync:function(e,r,t,o){B(e,r,t,o)},connectTestAsync:function(e,r,t){g.verifyUrl(e,!0,r,t)},serviceDescription:function(){return M||z("",!1,(function(e){M=e}),(function(e){MeadCo.ScriptX.Print.reportError(e.message)})),M},serviceDescriptionAsync:function(e,r){M?e(M):z("",!0,(function(r){M=r,e(r)}),r)},connectDeviceAndPrinters:function(e,r){C=!0,ee(e),S=r},get isConnected(){return C},get availablePrinterNames(){return S},addPrinterConnection:function(e){ne("PUT",e)},removePrinterConnection:function(e){ne("DELETE",e)},addPrinterConnectionAsync:function(e,r,t){ie("PUT",e,r,t)},removePrinterConnectionAsync:function(e,r,t){ie("DELETE",e,r,t)},getFromServer:function(e,t,o,n){z(r+e,t,o,n)},printHtml:J,requestHtmlPreview:function(e,r,t,o,n){var i=a;a=s,q(e,r,t,{},o,(function(){}),n)(),a=i},printPdf:x,printDirect:G,parseAjaxError:function(e,r,t,o){return MeadCo.parseAjaxError(e,r,t,o)},parseFetchError:function(e,r){return MeadCo.parseFetchError(e,r)},reportError:function(e){switch(MeadCo.error("ReportError: "+e),T){case P.REPORT:MeadCo.ScriptX.Print.reportServerError(e);break;case P.THROW:throw new Error(e)}},reportServerError:function(e){alert("There was an error in the printing service\n\n"+e)},reportFeatureNotImplemented:function(e){MeadCo.log("Call to not implemented: "+e),alert(e+"\n\nis not available.")},get queue(){return v},get activeJobs(){return this.queue.filter((e=>e.jobName!==c&&e.jobName!==l&&e.jobName!==d)).length},get clientSideJobs(){return this.queue.filter((e=>e.jobName==c||e.jobName==l||e.jobName==d)).length},get noJobsWaitingDelivery(){return this.queue.every((e=>e.jobName!==c&&e.jobName!==l&&e.jobName!==d))},ensureSpoolingStatus:function(){var e={jobIdentifier:Date.now(),printerName:"ensureJobsPrinter",jobName:d};return N(e),e},freeSpoolStatus:function(e){A(e.jobIdentifier)},get isSpooling(){return R()>0},waitForSpoolingComplete:function(e,r){if(MeadCo.log("Started WaitForSpoolingComplete("+e+")"),"function"!=typeof r)throw"WaitForSpoolingComplete requires a completion callback";var t=Date.now(),o=250,n=window.setInterval((function(){0===R()?(MeadCo.log("WaitForSpoolingComplete - complete"),window.clearInterval(n),r(!0)):e>=0&&Date.now()-t>e&&(MeadCo.log("WaitForSpoolingComplete - timeout"),window.clearInterval(n),r(0===R()))}),o)},waitForDeliveryComplete:function(e,r){if(MeadCo.log("Started waitForDeliveryComplete("+e+")"),"function"!=typeof r)throw"waitForDeliveryComplete requires a completion callback";const t=Date.now(),o=250,n=this,i=window.setInterval((()=>{n.noJobsWaitingDelivery?(MeadCo.log("waitForDeliveryComplete - complete"),window.clearInterval(i),r(!0)):e>=0&&Date.now()-t>e&&(MeadCo.log("waitForDeliveryComplete - timeout"),window.clearInterval(i),r(!1))}),o)},waitForDeliveryCompleteAsync:function(){const e=this;return new Promise((function(r,t){e.waitForDeliveryComplete(-1,r)}))},get queueTimeoutSpacing(){return Q},set queueTimeoutSpacing(e){Q=e},get queueGapResetTime(){return W},set queueGapResetTime(e){W=e},get jobFileName(){return X},set jobFileName(e){X=e},requestService:function(e,r,t,o,n,i,a){return _(e,r,t,o,n,i,a)},getService:function(e,r,t){return _(e,"GET",r,t,!1)},postService:function(e,r,t){return _(e,"POST",r,t,!1)},getServiceAsync:function(e,r,t,o,n){return _(e,"GET",r,t,!0,o,n)},postServiceAsync:function(e,r,t,o,n){return _(e,"POST",r,t,!0,o,n)}}}));
extendMeadCoNamespace("MeadCo.ScriptX.Print.Licensing",(function(){const n="1.15.1.4",e="v1/licensing";let t="",o=0,i="",r="No license applied";var c={};function u(n,e){var u=MeadCo.ScriptX.Print;void 0!==u&&"function"==typeof u.connectLite?u.connectLite(n,e):console.error("MeadCo.ScriptX.Print is not available"),t=e,c={},r="No license applied",o=0,i=""}function f(n,t){const o=MeadCo.ScriptX.Print;if(void 0===o||"function"!=typeof o.connectLite){var i="MeadCo.ScriptX.Licensing : MeadCo.ScriptX.Print API not available";if("function"==typeof t)return void t(i);throw new Error(i)}return c.length>0?("function"==typeof n&&n(c),c):(o.requestService(e,"GET",{},!0,"function"==typeof n,(function(e){r="",c={...c,...e},"function"!=typeof n||n(c)}),(function(n){r=n,"function"!=typeof t?MeadCo.warn("No reject function for: "+r):t(r)})),c)}function a(n,o,i,u,f){MeadCo.log("Apply license: "+n+",revision: "+o+", path: "+i);const a=MeadCo.ScriptX.Print;if(void 0===a||"function"!=typeof a.connectLite){var d="MeadCo.ScriptX.Licensing : MeadCo.ScriptX.Print API not available";if("function"==typeof f)return void f(d);MeadCo.warn("No reject function for: "+d)}const p=i.toLowerCase();"warehouse"!==p&&"securewarehouse"!==p&&(i=new URL(i,window.location.href).href,MeadCo.log("path updated to: "+i)),t=n;const l={Guid:n,Url:i,Revision:o};return a.requestService(e,"POST",l,!1,"function"==typeof u,(function(n){r="",c={...c,...n},"function"!=typeof u||u(c)}),(function(n){r=n,"function"!=typeof f||f(r)})),"function"!=typeof u?(MeadCo.log("returning applied (sync) license: "+c.company),c):0}return MeadCo.log("MeadCo.ScriptX.Print.Licensing "+n+" loaded."),{get version(){return n},connect:function(n,e){u(n,e)},connectLite:function(n,e,t,r){u(n,e),o=t,i=r},apply:function(n,e,t){return a(n,e,t)},applyAsync:function(n,e,t,o,i){a(n,e,t,o,i)},get result(){return""===r?0:5},get validLicense(){return void 0!==c.guid},get errorMessage(){return r},get detailOnError(){return r},get License(){return void 0!==c.guid?c:f(null,(function(n){throw new Error(n)}))},GetLicenseAsync:function(n,e){f(n,e)},PolyfillInit:function(){return void 0!==c.guid||""!==t&&(""===i||(a(t,o,i),void 0!==c.guid))},PolyfillInitAsync:function(n,e){void 0!==c.guid||""===i?n(c):a(t,o,i,n,e)}}}));
!function(e,t,i){if(this[e]!==i||null!==document.getElementById(e)){if(MeadCo.log("ScriptX.Services MeadCo Security Manager emulation believes it may not be required."),this[e]!==i&&MeadCo.log("this["+e+"] is defined"),null!==document.getElementById(e)&&MeadCo.log("document.getElementById("+e+") is defined"),this[e].object!==i)return void MeadCo.log("this["+e+"].object is defined -- not required!!!");MeadCo.log("this["+e+"].object is *not* defined")}MeadCo.log("ScriptX.Services MeadCo Security Manager emulation believes it is required.");var n=function(){const e="1.15.1.2",t=this,i=MeadCo,n=MeadCo.ScriptX.Print,o=MeadCo.ScriptX.Print.Licensing;function r(e){i.log("secmgr emulation :: "+e)}t.extendSecMgrNamespace=function(e,t){const i=t();r("MeadCo security manager extending namespace2: "+e);const n=e.split(".");let o=this;for(let e=0;e<n.length;e++){const t=n[e];e===n.length-1?void 0===o[t]?(r("installing implementation at: "+t),o[t]=i):r("Warning - not overwriting package: "+t):void 0===o[t]?(r("initialising new: "+t),o[t]={}):r("using existing package: "+t),o=o[t]}},r("'secmgr' loaded."),"function"!=typeof o.GetLicenseAsync&&MeadCo.error("MeadCo.ScriptX.Print.Licensing not available");"function"!=typeof n.useAttributes?MeadCo.warn("Attribute based licensing not available as MeadCo.ScriptX.Print is not available"):n.useAttributes();return{log:r,get version(){return e},get result(){return o.result},get validLicense(){return o.validLicense},get License(){return o.License},get errorMessage(){return o.errorMessage},GetLicenseAsync:function(e,t){o.GetLicenseAsync(e,t)},PolyfillInit:function(){return o.PolyfillInit()},PolyfillInitAsync:function(e,t){o.PolyfillInitAsync(e,t)}}}();this[e]=n}("secmgr"),"function"==typeof extendSecMgrNamespace&&extendSecMgrNamespace("secmgr.object",(function(){return this.secmgr.log("secmgr.object loaded."),this.secmgr}));