!function(e,r){var n=function(){var d=this,e="1.12.0.0",r="undefined"!=typeof MeadCo&&void 0!==MeadCo.logEnable&&MeadCo.logEnable,c=function(e){r&&console.log("MeadCo :: "+e)},i=function(e){console.error("MeadCo :: "+e)};return d.extendMeadCoNamespace=function(e,r){var n=r();c("MeadCo root extending namespace: "+e);for(var o=e.split("."),t=d.scope||this.jQuery||this.ender||this.$||this,s=0;s<o.length;s++){var a=o[s];if(s===o.length-1)if(void 0===t[a])c("installing implementation at: "+a),t[a]=n;else{c("Warning - extending package: "+a);var i=t[a];t[a]=n;var l=t[a];for(var p in c("preserving old scope ... "),i)i.hasOwnProperty(p)&&(c("will preserve: "+p),l[p]=i[p])}else void 0===t[a]?(c("initialising new: "+a),t[a]={}):c("using existing package: "+a);t=t[a]}},c("MeadCo root namespace "+e+" loaded."),{log:c,warn:function(e){console.warn("MeadCo :: "+e)},error:i,get version(){return e},get logEnabled(){return r},set logEnabled(e){r=e},createNS:function(e){var r=e.split("."),n=d.scope.MeadCo;"MeadCo"===r[0]&&(r=r.slice(1));for(var o=0;o<r.length;o++){var t=r[o];void 0===n[t]&&(n[t]={}),n=n[t]}return n},set scope(e){d.scope=e},makeApiEndPoint:function(e,r){var n=e.indexOf("/api");return-1===n?(e.lastIndexOf("/")!==e.length-1&&(e+="/"),e+="api/"+r):e=e.substr(0,n)+"/api/"+r,e},makeServiceEndPoint:function(e,r){var n=e.indexOf("/api");return-1===n?(e.lastIndexOf("/")!==e.length-1&&(e+="/"),e+=r):e=e.substr(0,n)+"/"+r,e},parseAjaxError:function(e,r,n,o){return i("**warning: AJAX call failure in "+e+": ["+(s=n)+"], ["+(a=o)+"], ["+(t=r).responseText+"], ["+t.statusText+"]"),""===a||"Internal Server Error"===a?a="error"!==s?t.responseText||s:"object"==typeof t.responseJSON&&"string"==typeof t.responseJSON.Message?t.responseJSON.Message:"string"==typeof t.responseText?t.responseText:"Server or network error":"object"!=typeof t.responseJSON&&"string"==typeof t.responseText&&0<t.responseText.length&&(a=t.responseText),i(" error parsed to --\x3e ["+a+"]"),a;var t,s,a}}}(),o=this,t=null;if(void 0!==o[e]&&(t=o[e]),o[e]=n,null!==t){var s=o[e];for(var a in t)t.hasOwnProperty(a)&&(s[a]=t[a])}n.scope=o}("MeadCo");
extendMeadCoNamespace("MeadCo.ScriptX.Print",function(){var e="1.12.0.4",p="v1/printHtml",d="v1/printPdf",o="v1/printDirect",v="",g="ScriptX.Services//PrintPreview.1",h={cookie:""},m={},u=this,c=[],C={serviceUrl:"",pendingUrl:"",failedUrl:"",orchestratorPort:0,orchestratorKey:"",portsToTry:10,verifying:!1,get url(){if(""===this.serviceUrl&&""!==this.pendingUrl){MeadCo.warn("[GET] servicesServer.url is not ready, performing synchronous search. Recommend code re-org to resolve the server earlier and asynchronously.");var e=this;this.verifyUrl(this.pendingUrl,!1,function(){return e.serviceUrl},function(){return""})}return this.serviceUrl},set url(e){MeadCo.log("servicesServer::setUrl: "+e),this.IsChangingServer(e)&&(MeadCo.log("note set as pending"),this.serviceUrl="",this.pendingUrl=e)},urlAsync:function(e,r,t){MeadCo.log("servicesServer::urlAsync: "+e),this.verifyUrl(e,!0,r,t)},verifyUrl:function(e,o,n,i){if(this.verifying&&o){MeadCo.warn("Verify called and verify in progress ....");var a=this,s=e;window.setTimeout(function(){a.verifyUrl(s,o,n,i)},1e3)}else if(this.IsChangingServer(e)&&!this.IsFailedConnection(e)){var r,a=this,s=e;MeadCo.log("servicesServer::verifyurl: "+e+", async: "+o),"number"!=typeof this.orchestratorPort&&(this.orchestratorPort=parseInt(""+this.orchestratorPort)),0<this.orchestratorPort?(MeadCo.log("Using request to Orchestrator on port: "+this.orchestratorPort),a.verifying=!0,r="string"==typeof this.orchestratorKey&&0<this.orchestratorKey.length?"/api/v2?key="+this.orchestratorKey:"/api/v1",MeadCo.log("servicesServer::querying orchestrator: http://127.0.0.1:"+this.orchestratorPort+r),u.jQuery.ajax("http://127.0.0.1:"+this.orchestratorPort+r,{method:"GET",dataType:"json",cache:!1,async:o}).done(function(e){MeadCo.log("orchestrator returned ScriptX.Services port: "+e.HttpPort);var r=new URL(s);r.port=e.HttpPort,s=r.protocol+"//"+r.host+r.pathname,a.test(s,0,o,function(e){a.serviceUrl=e,a.pendingUrl="",a.verifying=!1,n(e,!0)},function(e){a.serviceUrl="",a.pendingUrl="",a.failedUrl=s,a.verifying=!1,"function"==typeof i&&i(e)})}).fail(function(e,r,t){a.verifying=!1,MeadCo.warn(MeadCo.parseAjaxError("Failed to connect with orchestrator: ",e,r,t)),MeadCo.log("Will try unorchestrated url"),a.orchestratorPort=0,a.verifyUrl(s,o,n,i)})):(a.verifying=!0,a.test(s,a.portsToTry,o,function(e){a.serviceUrl=e,a.pendingUrl="",a.verifying=!1,n(e,!1)},function(e){if(a.serviceUrl="",a.pendingUrl="",a.verifying=!1,a.failedUrl=s,"function"==typeof i){var r=new URL(s);i("ScriptX.Services could not be found at "+r.protocol+"//"+r.host+". Is it installed and running?")}}))}else this.IsFailedConnection(e)?i("ScriptX.Services connection to: "+e+" has already failed and will not be re-tried."):n(this.serviceUrl,0<this.orchestratorPort)},test:function(e,o,n,i,a){if(0<e.length)if(u.jQuery){var s=this,c=new URL(e);MeadCo.log("Test server requested: "+e+", port: "+c.port);var r=MeadCo.makeApiEndPoint(c.href,"v1/licensing/ping");MeadCo.log(".ajax() get: "+r),u.jQuery.ajax(r,{method:"GET",dataType:"json",cache:!1,async:n}).done(function(e){var r=c.protocol+"//"+c.host+c.pathname;MeadCo.log("Test server succeed, resolve("+r+")"),i(r)}).fail(function(e,r,t){MeadCo.log("Test server failed: ["+t+"], "+o+", on: "+c.hostname),0<o&&("localhost"===c.hostname||"127.0.0.1"==c.hostname)?(c.port++,u.setTimeout(s.test(c.protocol+"//"+c.host+c.pathname,--o,n,i,a),1)):(t=MeadCo.parseAjaxError("MeadCo.ScriptX.Print.servicesServer.test:",e,r,t),"function"==typeof a?(MeadCo.log("rejecting with: "+t),a(t)):MeadCo.warn("failed with no reject function"))})}else MeadCo.error("jQuery is required by ScriptX.Services")},call:function(o,n,e,r,t,i,a){if(""===this.serviceUrl&&""!==this.pendingUrl){var s=this;this.verifyUrl(this.pendingUrl,t,function(){""!==s.url?s.call(o,n,e,r,t,i,a):"function"==typeof a&&a("Server url verification failed to set url")},a)}else if(u.jQuery)if(""!==this.serviceUrl){var c=MeadCo.makeApiEndPoint(this.serviceUrl,o);MeadCo.log("servicesServer.call() "+n+": "+c);var l={method:n,cache:!1,async:t,jsonp:!1,dataType:"json",contentType:"application/json"};r&&(l.headers={Authorization:"Basic "+btoa(f+":")}),"object"==typeof e&&null!==e&&(MeadCo.log("payload defined."),l.data=JSON.stringify(e)),u.jQuery.ajax(c,l).done(function(e){return"function"==typeof i&&i(e),e}).fail(function(e,r,t){t=MeadCo.parseAjaxError("MeadCo.ScriptX.Print:"+o+n,e,r,t),"function"==typeof a&&a(t)})}else{if("function"!=typeof a)throw new Error("MeadCo.ScriptX.Print : server connection is not defined.");a("MeadCo.ScriptX.Print : server connection is not defined.")}else{if("function"!=typeof a)throw new Error("MeadCo.ScriptX.Print : no known ajax helper available");a("MeadCo.ScriptX.Print : no known ajax helper available")}},IsChangingServer:function(r){if(""!==this.serviceUrl)try{var e=new URL(this.serviceUrl),t=new URL(r);return e.hostname!=t.hostname||e.port!=t.port}catch(e){return MeadCo.error("Failed to construct URL(): "+e.message+", from: "+this.serviceUrl+", or: "+r),MeadCo.error("Many errors will ensue"),!1}return!0},IsFailedConnection:function(r){if(0<this.failedUrl.length)try{var e=new URL(this.failedUrl),t=new URL(r);return e.hostname===t.hostname&&(MeadCo.warn("Attempt to use: "+r+" is noted as a failed connection and will not be retried"),!0)}catch(e){return MeadCo.error("Testing IsFailed unable to construct URL(): "+e.message+", from: "+this.failedUrl+", or: "+r),!0}return!1}},f="",n=!1,l=!1,i=[],a=null,y={URL:1,HTML:2,INNERHTML:4,STRING:8},t={UNKNOWN:0,QUEUEDTODEVICE:1,QUEUEDTOFILE:2,SOFTERROR:3,OK:4},r={REPORT:1,THROW:2},s=r.REPORT,S={NOTSTARTED:0,QUEUED:1,STARTING:2,DOWNLOADING:3,DOWNLOADED:4,PRINTING:5,COMPLETED:6,PAUSED:7,PRINTPDF:8,ERROR:-1,ABANDONED:-2};function M(e){c.push(e),MeadCo.log("ScriptX.Print queueJob: "+e.jobName+", jobCount: "+c.length)}function E(){return MeadCo.log("ScriptX.Print jobCount: "+c.length),c.length}function P(e){var r;for(r=0;r<c.length;r++)if(c[r].jobIdentifier===e)return MeadCo.log("ScriptX.Print removing job: "+c[r].jobName),c.splice(r,1),MeadCo.log("ScriptX.Print remove job, jobCount: "+c.length),void(0==c.length&&(U=0));MeadCo.warn("Unable to find job: "+e+" to remove it")}function w(e,r,t){"function"==typeof e.OnProgress&&e.OnProgress(r,t,e.UserData)}var b="";function T(e,r,t,o,n,i,a){var s;MeadCo.log("started MeadCo.ScriptX.Print.print.printHtmlAtServer() Type: "+e),e===y.URL&&MeadCo.log(".. request print url: "+r),s=""===v?{}:v===g?JSON.parse(JSON.stringify({printerName:v})):JSON.parse(JSON.stringify(m[v]));var c={ContentType:e,Content:r,Settings:JSON.parse(JSON.stringify(t)),Device:s,ProtectedContentAccess:h,OnProgress:i,UserData:o},l={jobIdentifier:Date.now(),printerName:c.Device.printerName,jobName:"Job timeout hold clientside"};M(l);var d=b;b="";var u=MeadCo.makeApiEndPoint(C.url,p),f=a;return function(){return P(l.jobIdentifier),O(u,c,{fail:function(e,r,t){var o=MeadCo.parseAjaxError("MeadCo.ScriptX.Print.printHtmlAtServer",e,r,t);w(c,S.ERROR,o),MeadCo.ScriptX.Print.reportError(o),"function"==typeof n&&n("Server error")},queuedToFile:function(e){MeadCo.log("print is being queued to a file"),w(c,S.QUEUED),L(u,c,e.jobIdentifier,-1,function(e){if(null!==e){MeadCo.log("download printed file is available"),w(c,S.COMPLETED);var r=u+"/download/"+e.jobIdentifier;0<d.length&&(r+="/"+d),f(r,e.jobIdentifier)}"function"==typeof n&&n(null===e?"Server error":null)})},queuedToDevice:function(e){MeadCo.log("print was queued to device"),w(c,S.QUEUED),L(u,c,e.jobIdentifier,-1,function(e){null!==e&&w(c,S.COMPLETED),"function"==typeof n&&n(null===e?"Server error":null)})},softError:function(e){w(c,S.ERROR,e.message),MeadCo.ScriptX.Print.reportError(e.message),MeadCo.log("print has soft error"),P(e.jobIdentifier),"function"==typeof n&&(MeadCo.log("Call fnDone"),n(e.message))},ok:function(e){w(c,S.COMPLETED),MeadCo.log("printed ok, no further information"),P(e.jobIdentifier),"function"==typeof n&&n(null)}})}}var j=0,U=0,D=750,N=1e4;function R(e,r,t,o){"string"==typeof e&&0<e.length?(MeadCo.log("Print server requested: "+e+" with license: "+r),f="string"==typeof r&&0<r.length?r:f,v="",m={},n=!(c=[]),i=[],"function"==typeof t?C.urlAsync(e,t,o):C.url=e):(MeadCo.log("Print server retained: "+C.url+" update with license: "+r),f="string"==typeof r&&0<r.length?r:f)}function O(e,r,o){if(C.url.length<=0)throw new Error("MeadCo.ScriptX.Print : print server URL is not set or is invalid");var n={jobIdentifier:Date.now(),printerName:r.Device.printerName,jobName:"Job starting"};if(u.jQuery)return MeadCo.log(".ajax() post to: "+e),M(n),u.jQuery.ajax(e+"/print",{data:JSON.stringify(r),dataType:"json",contentType:"application/json",method:"POST",headers:{Authorization:"Basic "+btoa(f+":")}}).done(function(e){switch(MeadCo.log("Success response: "+e.status),e.printerName=r.Device.printerName,e.jobName=r.Settings.jobTitle,M(e),P(n.jobIdentifier),e.status){case t.QUEUEDTOFILE:o.queuedToFile(e);break;case t.QUEUEDTODEVICE:o.queuedToDevice(e);break;case t.SOFTERROR:case t.UNKNOWN:o.softError(e);break;case t.OK:o.ok(e)}}).fail(function(e,r,t){P(n.jobIdentifier),"function"==typeof o.fail&&o.fail(e,r,t)}),!0;if("function"!=typeof o.fail)throw new Error("MeadCo.ScriptX.Print : no known ajax helper available");o.fail("MeadCo.ScriptX.Print : no known ajax helper available")}function I(e,r,t,o){return A(e,"GET",null,!0,r,t,o)}function A(e,r,t,o,n,i,a){return C.call(e,r,t,o,n,i,a)}function L(e,o,n,r,i){MeadCo.log("monitorJob: "+n);var t=0,a=!1,s=window.setInterval(function(){a?MeadCo.log("** info : still waiting for last status request to complete"):(MeadCo.log("Going to request status with .ajax"),a=!0,jQuery.ajax(e+"/status/"+n,{dataType:"json",method:"GET",cache:!1,headers:{Authorization:"Basic "+btoa(f+":")}}).done(function(e){switch(MeadCo.log("jobStatus: "+e.status),e.status){case S.COMPLETED:MeadCo.log("clear interval: "+s),window.clearInterval(s),P(n),i(e);break;case S.NOTSTARTED:case S.DOWNLOADED:case S.DOWNLOADING:case S.PRINTING:case S.QUEUED:case S.STARTING:case S.PAUSED:case S.PRINTPDF:w(o,e.status,e.message),function(r){var t;for(t=0;t<c.length;t++)if(c[t].jobIdentifier===r.jobIdentifier)return Object.keys(r).forEach(function(e){c[t][e]=r[e]});MeadCo.warn("Unable to find job: "+r.jobIdentifier+" to update it")}(e),0<r&&1e3*++t>r&&(window.clearInterval(s),MeadCo.ScriptX.Print.reportError("unknown failure while printing.")),a=!1;break;case S.ERROR:case S.ABANDONED:MeadCo.log("error status in monitorJob so clear interval: "+s),w(o,e.status,e.message),P(n),window.clearInterval(s),MeadCo.ScriptX.Print.reportError("The print failed with the error: "+e.message),i(null);break;default:w(o,e.status,e.message),MeadCo.log("unknown status in monitorJob so clear interval: "+s),P(n),window.clearInterval(s),i(null)}}).fail(function(e,r,t){t=MeadCo.parseAjaxError("MeadCo.ScriptX.Print.monitorJob:",e,r,t),MeadCo.log("error: "+t+" in monitorJob so clear interval: "+s),w(o,S.ERROR,t),P(n),window.clearInterval(s),i(null)}))},1e3);MeadCo.log("intervalId: "+s)}function X(e){if("string"==typeof e.printerName){if(e.isDefault)for(var r=0;r<m.length;r++)m[r].isDefault=!1;(m[e.printerName]=e).isDefault&&0===v.length&&(v=e.printerName)}}function q(r){r.name=r.name.replace(/\\/g,"||"),MeadCo.log("Request get device info: "+r.name),I(p+"/deviceinfo/"+encodeURIComponent(r.name)+"/0",r.async,function(e){n=!0,X(e),"function"==typeof r.done&&r.done(e)},function(e){"systemdefault"===r.name?(MeadCo.warn("request for systemdefault printer failed - please update to ScriptX.Services 2.11.1"),r.name="default",r.async=!1,q(r)):(MeadCo.log("failed to getdevice: "+e),"function"==typeof r.fail&&r.fail(e))})}return u.jQuery||MeadCo.log("**** warning :: no jQuery *******"),MeadCo.log("MeadCo.ScriptX.Print "+e+" loaded."),{ContentType:y,PrintStatus:S,ErrorAction:r,CollateOptions:{DEFAULT:0,TRUE:1,FALSE:2},DuplexOptions:{DEFAULT:0,SIMPLEX:1,VERTICAL:2,HORIZONTAL:3},MeasurementUnits:{DEFAULT:0,INCHES:1,MM:2},ServiceClasses:{CLOUD:1,ONPREMISE:2,WINDOWSPC:3},get onErrorAction(){return s},set onErrorAction(e){s=e},get orchestrator(){return C.orchestratorPort},set orchestrator(e){C.orchestratorPort=e},get orchestratorKey(){return C.orchestratorKey},set orchestratorKey(e){C.orchestratorKey=e},get authorisationCookie(){return h.cookie},set authorisationCookie(e){h.cookie=e},get printerName(){return v},set printerName(e){e!==v&&e.name!==v&&("string"==typeof e?void 0===m[e]?q({name:e,done:function(e){v=e.printerName},async:!1,fail:function(e){MeadCo.ScriptX.Print.reportError(e)}}):v=e:q(e))},setSystemDefaultPrinterAsync:function(e,r,t){if(void 0!==m.systemdefault&&m.systemdefault==e)return MeadCo.log("setSystemDefaultPrinterAsync() does NOT need to do anything"),void r();e=(e="system::"+e).replace(/\\/g,"||"),MeadCo.log("Request systemDefaultPrinterAsync: "+e),A(p+"/CurrentPrinter/"+encodeURIComponent(e),"PUT",null,!0,!0,r,t)},get version(){return e},get serviceUrl(){return C.url},serviceVersion:function(){return this.serviceDescription().serviceVersion},serviceVersionAsync:function(r,e){this.serviceDescriptionAsync(function(e){r(e.serviceVersion)},e)},get deviceSettings(){return""!==v?m[v]:{}},set deviceSettings(e){X(e)},deviceSettingsFor:function(e){return"string"!=typeof(r=e)||""===r?{}:(void 0===m[r]&&q({name:r,async:!1,done:function(e){"systemdefault"===r.toLowerCase()&&(r=e.printerName)},fail:function(e){MeadCo.ScriptX.Print.reportError(e)}}),m[r]);var r},useAttributes:function(){!function(){if(MeadCo.log("MeadCo.ScriptX.Print ... looking for auto connect, already found?: "+l),this.jQuery&&!l){var i=MeadCo.ScriptX.Print.HTML,a=MeadCo.ScriptX.Print,s=MeadCo.ScriptX.Print.Licensing;jQuery("[data-meadco-subscription]").each(function(){if(void 0===a||void 0===i)MeadCo.log("Not auto-connecting subscription as print or printHtml API not present. Should be present on next attempt.");else if(!l){var e=jQuery(this),r=e.data();MeadCo.log("Auto connect susbcription to: "+r.meadcoServer+", or "+r.meadcoPrinthtmlserver+", with subscription: "+r.meadcoSubscription+", sync: "+r.meadcoSyncinit);var t="false"!==(""+r.meadcoSyncinit).toLowerCase(),o=r.meadcoServer;void 0===o&&(o=r.meadcoPrinthtmlserver),void 0===o?MeadCo.error("No server specified"):(void 0!==s&&s.connect(o,r.meadcoSubscription),t?(MeadCo.warn("Synchronous connection is deprecated, please use data-meadco-syncinit='false'. Note that this may require additional code changes. Please see: https://www.meadroid.com/Developers/KnowledgeBank/HowToGuides/ScriptXServices/ThenToNow/Stage6"),i.connect(o,r.meadcoSubscription)):(MeadCo.log("Async connectlite..."),a.connectLite(o,r.meadcoSubscription)),l=!0)}return!1}),jQuery("[data-meadco-license]").each(function(){if(void 0===a||void 0===i||void 0===s)MeadCo.log("Not auto-connecting client license as print or printHtml or license API not present. Should be present on next attempt.");else if(!l){var e=jQuery(this),r=e.data();MeadCo.log("Auto connect client license to: "+r.meadcoServer+", with license: "+r.meadcoLicense+", path: "+r.meadcoLicensePath+", revision: "+r.meadcoLicenseRevision+", sync: "+r.meadcoSyncinit+", orchestrator: "+r.meadcoOrchestrator+", orchestratorKey: "+r.meadcoOrchestratorKey);var t="false"!==(""+r.meadcoSyncinit).toLowerCase(),o="false"!==(""+r.meadcoReporterror).toLowerCase(),n=r.meadcoServer;C.orchestratorPort=r.meadcoOrchestrator,C.orchestratorKey=r.meadcoOrchestratorKey,t?(MeadCo.warn("Synchronous connection is deprecated, please use data-meadco-syncinit='false'. Note that this may require additional code changes. Please see: https://www.meadroid.com/Developers/KnowledgeBank/HowToGuides/ScriptXServices/ThenToNow/Stage6"),s.connect(n,r.meadcoLicense),void 0!==r.meadcoLicensePath&&void 0!==r.meadcoLicenseRevision&&(s.apply(r.meadcoLicense,r.meadcoLicenseRevision,r.meadcoLicensePath),0!=s.result&&o&&MeadCo.ScriptX.Print.reportError(s.errorMessage)),i.connect(n,r.meadcoLicense)):(MeadCo.log("Async connectlite..."),s.connectLite(n,r.meadcoLicense,r.meadcoLicenseRevision,r.meadcoLicensePath),a.connectLite(n,r.meadcoLicense)),l=!0}return!1})}}()},connect:function(e,r){R(e,r),q({name:"systemdefault",async:!1}),I("",!0,function(e){a=e})},connectLite:function(e,r){R(e,r)},connectAsync:function(e,r,t,o){var n,i;n=t,R(e,r,function(e){q({name:"systemdefault",done:n,async:!0,fail:i}),I("",!0,function(e){a=e})},i=o)},connectTestAsync:function(e,r,t){C.verifyUrl(e,!0,r,t)},serviceDescription:function(){return a||I("",!1,function(e){a=e},function(e){MeadCo.ScriptX.Print.reportError(e.message)}),a},serviceDescriptionAsync:function(r,e){a?r(a):I("",!0,function(e){r(a=e)},e)},connectDeviceAndPrinters:function(e,r){n=!0,X(e),i=r},get isConnected(){return n},get availablePrinterNames(){return i},getFromServer:function(e,r,t,o){I(p+e,r,t,o)},printHtml:function(e,r,t,o,n,i){if(!r||"string"==typeof r&&0===r.length)return MeadCo.ScriptX.Print.reportError("Request to print no content - access denied?"),"function"==typeof o&&o("Request to print no content"),!1;var a=Date.now();return N<a-U&&(j=0),U=a,setTimeout(T(e,r,t,i,o,n,function(e){window.open(e,"_self")}),j),j+=D,!0},requestHtmlPreview:function(e,r,t,o,n){var i=v;v=g,T(e,r,t,{},o,function(){},n)(),v=i},printPdf:function(e,r,t,o,n){if(!e||"string"==typeof e&&0===e.length)return MeadCo.ScriptX.Print.reportError("The document to print must be given."),"function"==typeof t&&t("Request to print no content"),!1;var i=Date.now();return N<i-U&&(j=0),U=i,setTimeout(function(e,r,n,t,o){var i;MeadCo.log("started MeadCo.ScriptX.Print.print.printPdfAtServer() document: "+e+", printerName: "+v),i=""===v?{}:JSON.parse(JSON.stringify(m[v]));var a={Document:e,Description:r.jobDescription,Settings:JSON.parse(JSON.stringify(r)),Device:i,ProtectedContentAccess:h,OnProgress:t,UserData:o};a.Settings.jobTitle=r.jobDescription;var s=MeadCo.makeApiEndPoint(C.url,d),c={jobIdentifier:Date.now(),printerName:a.Device.printerName,jobName:"Job timeout hold clientside"};M(c);var l=b;return b="",function(){return P(c.jobIdentifier),O(s,a,{fail:function(e,r,t){var o=MeadCo.parseAjaxError("MeadCo.ScriptX.Print.printPdfAtServer",e,r,t);w(a,S.ERROR,o),MeadCo.ScriptX.Print.reportError(o),"function"==typeof n&&n("Server error")},queuedToFile:function(e){MeadCo.log("default handler on queued to file response"),w(a,S.QUEUED),L(s,a,e.jobIdentifier,-1,function(e){if(null!==e){MeadCo.log("Will download printed file"),w(a,S.COMPLETED);var r=s+"/download/"+e.jobIdentifier;0<l.length&&(r+="/"+l),window.open(r,"_self")}"function"==typeof n&&n(null===e?"Server error":null)})},queuedToDevice:function(e){MeadCo.log("print was queued to device"),w(a,S.QUEUED),L(s,a,e.jobIdentifier,-1,function(e){null!==e&&w(a,S.COMPLETED),"function"==typeof n&&n(null===e?"Server error":null)})},softError:function(e){w(a,S.ERROR,e.message),MeadCo.ScriptX.Print.reportError(e.message),MeadCo.log("printpdf call has soft error, remove job: "+e.jobIdentifier),P(e.jobIdentifier),"function"==typeof n&&(MeadCo.log("Call fnDone"),n("Server error"))},ok:function(e){w(a,S.COMPLETED),MeadCo.log("printed ok, no further information"),P(e.jobIdentifier),"function"==typeof n&&n(null)}})}}(e,r,t,o,n),j),j+=D,!0},printDirect:function(e,r,n){if(MeadCo.log("started MeadCo.ScriptX.Print.print.printDirectAtServer() Type: "+e+", printerName: "+v),e===y.URL)MeadCo.log(".. request print url: "+r);else if(e!==y.STRING)return MeadCo.ScriptX.Print.reportError("Bad content type for direct printing"),"function"==typeof n&&n("Bad content type for direct printing"),!1;if(!r||"string"==typeof r&&0===r.length)return MeadCo.ScriptX.Print.reportError("Request to print no content - access denied?"),"function"==typeof n&&n("Request to print no content"),!1;if(""===v)return MeadCo.ScriptX.Print.reportError("Request to print but no current printer defined."),"function"==typeof n&&n("Request to print but no current printer defined."),!1;var t={ContentType:e,Content:r,PrinterName:v,Settings:{jobTitle:"Direct print"},Device:m[v]};return O(MeadCo.makeApiEndPoint(C.url,o),t,{fail:function(e,r,t){var o=MeadCo.parseAjaxError("MeadCo.ScriptX.Print.printDirectAtServer",e,r,t);MeadCo.ScriptX.Print.reportError(o),"function"==typeof n&&n("Server error")},softError:function(e){MeadCo.ScriptX.Print.reportError(e.message),MeadCo.log("print has soft error"),P(e.jobIdentifier),"function"==typeof n&&(MeadCo.log("Call fnDone"),n(e.message))},ok:function(e){MeadCo.log("printed ok, no further information"),P(e.jobIdentifier),"function"==typeof n&&n(null)}})},parseAjaxError:function(e,r,t,o){return MeadCo.parseAjaxError(e,r,t,o)},reportError:function(e){switch(MeadCo.error("ReportError: "+e),s){case r.REPORT:MeadCo.ScriptX.Print.reportServerError(e);break;case r.THROW:throw new Error(e)}},reportServerError:function(e){alert("There was an error in the printing service\n\n"+e)},reportFeatureNotImplemented:function(e){MeadCo.log("Call to not implemented: "+e),alert(e+"\n\nis not available.")},get queue(){return c},get activeJobs(){return E()},ensureSpoolingStatus:function(){var e={jobIdentifier:Date.now(),printerName:"ensureJobsPrinter",jobName:"null Job"};return M(e),e},freeSpoolStatus:function(e){P(e.jobIdentifier)},get isSpooling(){return 0<E()},waitForSpoolingComplete:function(e,r){if(MeadCo.log("Started WaitForSpoolingComplete("+e+")"),"function"!=typeof r)throw"WaitForSpoolingComplete requires a completion callback";var t=Date.now(),o=window.setInterval(function(){0===E()?(MeadCo.log("WaitForSpoolingComplete - complete"),window.clearInterval(o),r(!0)):0<=e&&Date.now()-t>e&&(MeadCo.log("WaitForSpoolingComplete - timeout"),window.clearInterval(o),r(0===E()))},250)},get queueTimeoutSpacing(){return D},set queueTimeoutSpacing(e){D=e},get queueGapResetTime(){return N},set queueGapResetTime(e){N=e},get jobFileName(){return b},set jobFileName(e){b=e},requestService:function(e,r,t,o,n,i,a){return A(e,r,t,o,n,i,a)},getService:function(e,r,t){return A(e,"GET",r,t,!1)},postService:function(e,r,t){return A(e,"POST",r,t,!1)},getServiceAsync:function(e,r,t,o,n){return A(e,"GET",r,t,!0,o,n)},postServiceAsync:function(e,r,t,o,n){return A(e,"POST",r,t,!0,o,n)}}});
extendMeadCoNamespace("MeadCo.ScriptX.Print.HTML",function(){var a,i,e="1.12.0.0",t={DEFAULT:0,LANDSCAPE:1,PORTRAIT:2},r={DEFAULT:0,ALL:1,ODD:2,EVEN:3},n={DEFAULT:0,TRUE:1,FALSE:2},s={header:null,footer:null,headerFooterFont:null,viewScale:0,locale:navigator.languages&&navigator.languages.length?navigator.languages[0]:navigator.language,timezoneOffset:0,shortDateFormat:"",longDateFormat:"",printBackgroundColorsAndImages:!1,page:{orientation:t.PORTRAIT,units:MeadCo.ScriptX.Print.MeasurementUnits.DEFAULT,margins:{left:"",top:"",bottom:"",right:""}},extraHeadersAndFooters:{},pageRange:"",printingPass:r.ALL,jobTitle:"",documentUrl:document.URL},o={set header(e){MeadCo.log("MeadCo.ScriptX.Print.HTML setting header: "+e),e&&0===e.length&&(e="%20"),s.header=e},get header(){return s.header&&"%20"!==s.header?s.header:""},set footer(e){e&&0===e.length&&(e="%20"),s.footer=e},get footer(){return s.footer&&"%20"!==s.footer?s.footer:""},set headerFooterFont(e){e&&0===e.length&&(e="%20"),s.headerFooterFont=e},get headerFooterFont(){return s.headerFooterFont&&"%20"!==s.headerFooterFont?s.headerFooterFont:""},get locale(){return s.locale},set viewScale(e){s.viewScale=e},get viewScale(){return s.viewScale},set locale(e){s.locale=e},set shortDateFormat(e){s.shortDateFormat=e},set longDateFormat(e){s.longDateFormat=e},set printBackgroundColorsAndImages(e){s.printBackgroundColorsAndImages=e?n.TRUE:n.FALSE},get printBackgroundColorsAndImages(){return s.printBackgroundColorsAndImages===n.TRUE},extraHeadersAndFooters:{get allPagesHeader(){return s.extraHeadersAndFooters.allPagesHeader},set allPagesHeader(e){s.extraHeadersAndFooters.allPagesHeader=e},get allPagesFooter(){return s.extraHeadersAndFooters.allPagesFooter},set allPagesFooter(e){s.extraHeadersAndFooters.allPagesFooter=e},get firstPageHeader(){return s.extraHeadersAndFooters.firstPageHeader},set firstPageHeader(e){s.extraHeadersAndFooters.firstPageHeader=e},get firstPageFooter(){return s.extraHeadersAndFooters.firstPageFooter},set firstPageFooter(e){s.extraHeadersAndFooters.firstPageFooter=e},get extraFirstPageFooter(){return s.extraHeadersAndFooters.extraFirstPageFooter},set extraFirstPageFooter(e){s.extraHeadersAndFooters.extraFirstPageFooter=e},get allHeaderHeight(){return s.extraHeadersAndFooters.allHeaderHeight},set allHeaderHeight(e){if("number"!=typeof e)throw"Invalid argument";s.extraHeadersAndFooters.allHeaderHeight=e},get allFooterHeight(){return s.extraHeadersAndFooters.allFooterHeight},set allFooterHeight(e){if("number"!=typeof e)throw"Invalid argument";s.extraHeadersAndFooters.allFooterHeight=e},get firstHeaderHeight(){return s.extraHeadersAndFooters.firstHeaderHeight},set firstHeaderHeight(e){if("number"!=typeof e)throw"Invalid argument";s.extraHeadersAndFooters.firstHeaderHeight=e},get firstFooterHeight(){return s.extraHeadersAndFooters.firstFooterHeight},set firstFooterHeight(e){if("number"!=typeof e)throw"Invalid argument";s.extraHeadersAndFooters.firstFooterHeight=e},get extraFirstFooterHeight(){return s.extraHeadersAndFooters.extraFirstFooterHeight},set extraFirstFooterHeight(e){if("number"!=typeof e)throw"Invalid argument";s.extraHeadersAndFooters.extraFirstFooterHeight=e}},page:{set orientation(e){s.page.orientation=e},get orientation(){return s.page.orientation},set units(e){s.page.units=e},get units(){return s.page.units},margins:{set left(e){s.page.margins.left=e},get left(){return s.page.margins.left},set top(e){s.page.margins.top=e},get top(){return s.page.margins.top},set bottom(e){s.page.margins.bottom=e},get bottom(){return s.page.margins.bottom},set right(e){s.page.margins.right=e},get right(){return s.page.margins.right}}},get pageRange(){return s.pageRange},set pageRange(e){s.pageRange=e},get printingPass(){return s.printingPass},set printingPass(e){if(!("number"==typeof e&&r.DEFAULT<=e&&e<=r.EVEN))throw"Invalid argument";s.printingPass=e}};function d(e){return null!==e?((s=e).locale=navigator.languages&&navigator.languages.length?navigator.languages[0]:navigator.language,s.timezoneOffset=(new Date).getTimezoneOffset(),s.documentUrl=document.URL,MeadCo.log("Settings cache updated, .locale: ["+s.locale+"], .offset: "+s.timezoneOffset),!0):(MeadCo.warn("Igoring attempt to updateSettingsWithServerDefaults with null"),!1)}function l(){var e=window.location.port?":"+window.location.port:"";return window.location.protocol+"//"+window.location.hostname+e+window.location.pathname}function g(e){!function(e){jQuery(":checked",e).each(function(){this.setAttribute("checked","checked")});for(var t="text search number email datetime datetime-local date month week time tel url color range".split(" "),r=t.length,n=0;n<r;n++)jQuery("input[type="+t[n]+"]",e).each(function(){this.setAttribute("value",jQuery(this).val())});jQuery("select",e).each(function(){var e=jQuery(this);jQuery("option",e).each(function(){e.val()===jQuery(this).val()&&this.setAttribute("selected","selected")})}),jQuery("textarea",e).each(function(){this.innerHTML=jQuery(this).val()})}(e);var t=e.clone();if(jQuery("script",t).remove(),jQuery("object",t).remove(),!jQuery("head>base",t).length){MeadCo.log("No base element, fabricating one to: "+l());var r=jQuery("<base>",{href:l()});jQuery("head",t).prepend(r)}return t.html()}function c(){if(this.jQuery)return g(jQuery("html"));throw new Error("No supported html snapshot helper available (jQuery is required)")}function u(e){if(this.jQuery){var t=jQuery("#"+e);if(!t.length&&!(t=jQuery("iframe[name="+e+"]")).length)throw new Error("Unable to get frame content - frame does not exist");return g(t.contents().find("html"))}throw new Error("No supported framed html snapshot helper available (jQuery is required)")}function p(e,t,r,n,o,a){var i=s;return i.jobTitle=r,MeadCo.ScriptX.Print.printHtml(e,t,i,n,o,a)}function m(e,t){i=MeadCo.ScriptX.Print.deviceSettingsFor("systemdefault").printerName,a=MeadCo.ScriptX.Print.printerName,MeadCo.log("Starting preview html ... printer: "+a);var r=document.getElementById("scriptXServices-PreviewWaitScreen");if(null==r){(r=document.createElement("DIV")).innerHTML="&shy;<style>.loader { background-color: rgba(0, 0, 0, 0.25); overflow: hidden; width: 100%; height: 100%; position: fixed;top: 0; left: 0; display: flex;  align-items:center; align-content:center; justify-content: center; z-index: 10000; } .loader__element { border-radius: 100%; border: 5px solid #555; margin: 10px} .loader__element:nth-child(1) { animation: preloader .6s ease-in-out alternate infinite; } .loader__element:nth-child(2) { animation: preloader .6s ease-in-out alternate .2s infinite; } .loader__element:nth-child(3) { animation: preloader .6s ease-in-out alternate .4s infinite; } @keyframes preloader { 100% { transform: scale(2); } }</style>",document.body.appendChild(r.childNodes[1]),(r=document.createElement("DIV")).setAttribute("id","scriptXServices-PreviewWaitScreen"),r.className="loader";for(var n=0;n<3;n++){var o=document.createElement("SPAN");o.className="loader__element",r.appendChild(o)}document.body.appendChild(r)}else r.style.display="flex";MeadCo.ScriptX.Print.requestHtmlPreview(e,t,s,function(e){MeadCo.log("Preview procesing completed: ",e),r.style.display="none"},function(e,t){var r=MeadCo.makeServiceEndPoint(MeadCo.ScriptX.Print.serviceUrl,"v1/Preview/"+t+"/"+encodeURIComponent(document.URL));MeadCo.log("Preview is available: "+r+", ... printer: "+a);var n=document.getElementById("scriptXServices-PreviewFrame");null==n&&((n=document.createElement("IFRAME")).setAttribute("id","scriptXServices-PreviewFrame"),n.style.width=0,n.style.height=0,n.style.display="none",n.style.visibility="hidden",document.body.appendChild(n),window.addEventListener("message",function(e){MeadCo.log("message from: "+e+", ... printer: "+a),"preview-wired"===e.data&&(MeadCo.log("preview is wired ... printer: "+a),MeadCo.ScriptX.Print.setSystemDefaultPrinterAsync(a,function(){MeadCo.log("system default printer set, request print preview"),n.contentWindow.postMessage("preview",MeadCo.ScriptX.Print.serviceUrl),window.setTimeout(function(){MeadCo.ScriptX.Print.setSystemDefaultPrinterAsync(i,function(){},function(e){MeadCo.error("Preview failed to restore current printer after preview: "+e),MeadCo.ScriptX.Print.reportError(e)})},500)},function(e){MeadCo.error("Preview failed to set current printer for preview: "+e),MeadCo.ScriptX.Print.reportError(e)}))})),n.setAttribute("src",r)})}return MeadCo.log("MeadCo.ScriptX.Print.HTML "+e+" loaded."),this.jQuery||MeadCo.log("**** warning :: no jQuery"),{PageMarginUnits:{DEFAULT:0,INCHES:1,MM:2},PageOrientation:t,PrintingPasses:r,settings:o,get documentContentToPrint(){return c()},frameContentToPrint:function(e){return u(e)},printDocument:function(e,t,r){return p(MeadCo.ScriptX.Print.ContentType.INNERHTML,c(),document.title,e,t,r)},printFrame:function(e,t,r,n){return p(MeadCo.ScriptX.Print.ContentType.INNERHTML,u(e),document.title,t,r,n)},previewDocument:function(){m(MeadCo.ScriptX.Print.ContentType.INNERHTML,c())},previewFrame:function(e){m(MeadCo.ScriptX.Print.ContentType.INNERHTML,u(e))},printFromUrl:function(e,t,r,n){return p(MeadCo.ScriptX.Print.ContentType.URL,e,e,t,r,n)},printHtml:function(e,t,r,n){return p(MeadCo.ScriptX.Print.ContentType.HTML,e,"HTML snippet",t,r,n)},connectLite:function(e,t){MeadCo.ScriptX.Print.connectLite(e,t)},connect:function(e,t,r){MeadCo.warn("Print.HTML SYNC connection request"),MeadCo.ScriptX.Print.connectLite(e,t),MeadCo.ScriptX.Print.getFromServer("/htmlPrintDefaults/?units="+s.page.units,!1,function(e){MeadCo.log("got default html settings"),d(e.settings),null!==e.device&&MeadCo.ScriptX.Print.connectDeviceAndPrinters(e.device,e.availablePrinters)},r)},connectAsync:function(e,t,r,n){MeadCo.log("Print.HTML ASYNC connection request"),MeadCo.ScriptX.Print.connectLite(e,t),MeadCo.ScriptX.Print.getFromServer("/htmlPrintDefaults/?units="+s.page.units,!0,function(e){MeadCo.log("got default html settings"),d(e.settings)?(null!==e.device&&MeadCo.ScriptX.Print.connectDeviceAndPrinters(e.device,e.availablePrinters),r(2)):n("Server did not respond with valid settings")},n)},get version(){return e}}});
extendMeadCoNamespace("MeadCo.ScriptX.Print.PDF",function(){var e="1.12.0.0",t={DEFAULT:0,LANDSCAPE:1,PORTRAIT:2},n={DEFAULT:0,TRUE:1,FALSE:2},i={UNDEFINED:-1,NONE:0,FITTOPAPER:1,SHRINKLARGEPAGES:2},o={NORMAL:0,HIGH:1,LOSSLESS:2},d={jobDescription:"",pageRange:"",pageScaling:i.UNDEFINED,autoRotateCenter:n.DEFAULT,orientation:t.DEFAULT,monochrome:n.DEFAULT,normalise:n.DEFAULT,printQuality:o.NORMAL};return MeadCo.log("MeadCo.ScriptX.Print.PDF "+e+" loaded."),this.jQuery||MeadCo.log("**** warning :: no jQuery"),{PageOrientation:t,BooleanOption:n,PdfPageScaling:i,PdfPrintQuality:o,settings:d,resetSettings:function(){d.jobDescription="",d.pageRange="",d.pageScaling=i.UNDEFINED,d.autoRotateCenter=n.DEFAULT,d.orientation=t.DEFAULT,d.monochrome=n.DEFAULT,d.normalise=n.DEFAULT,d.printQuality=o.NORMAL},print:function(e,t,n,i){return o=e,r=t,a=n,c=i,MeadCo.ScriptX.Print.printPdf(o,d,r,a,c);var o,r,a,c},connectLite:function(e,t){MeadCo.ScriptX.Print.connectLite(e,t)},connect:function(e,t){MeadCo.warn("Print.PDF SYNC connection request"),MeadCo.ScriptX.Print.connectLite(e,t),MeadCo.ScriptX.Print.getFromServer("/htmlPrintDefaults/?units="+settingsCache.page.units,!1,function(e){MeadCo.log("got default html settings"),null!==e.device&&MeadCo.ScriptX.Print.connectDeviceAndPrinters(e.device,e.availablePrinters)})},connectAsync:function(e,t,n,i){MeadCo.log("Print.PDF ASYNC connection request"),MeadCo.ScriptX.Print.connectLite(e,t),MeadCo.ScriptX.Print.getFromServer("/htmlPrintDefaults",!0,function(e){MeadCo.log("got default html settings"),null!==e.device?(MeadCo.ScriptX.Print.connectDeviceAndPrinters(e.device,e.availablePrinters),n()):i("Server did not respond with valid settings")},i)},get version(){return e}}});
!function(e,t,r){if(this[e]!==r||null!==document.getElementById(e)){if(MeadCo.log("ScriptX.Services ScriptX.factory emulation believes it may not be requred."),this[e]!==r&&MeadCo.log("this["+e+"] is defined"),null!==document.getElementById(e)&&MeadCo.log("document.getElementById("+e+") is defined"),this[e].object!==r)return MeadCo.log("this["+e+"].object is defined -- not required!!!");MeadCo.log("this["+e+"].object is *not* defined")}MeadCo.log("ScriptX.Services ScriptX.factory emulation believes it is requred.");var n=function(){var c="1.12.0.0",u="8.3.0.0",p="",l=MeadCo.ScriptX.Print,t=MeadCo,d=this;function f(e){t.log("factory emulation :: "+e)}return f("'factory' loaded "+c),{log:f,GetComponentVersion:function(e,t,r,n,i){f("factory.object.getcomponentversion: "+e);var o=c;switch(e.toLowerCase()){case"scriptx.factory":o=u;break;case"scriptx.factory.services":o=c;break;case"scriptx.services":if(""===p&&void 0!==l){var a=l.onErrorAction;l.onErrorAction=l.ErrorAction.THROW;try{var s=l.serviceDescription();if(null!==s){var g=s.serviceVersion;p=g.major+"."+g.minor+"."+g.build+"."+g.revision}}catch(e){p=c}l.onErrorAction=a}o=p;break;case"meadco.secmgr":try{o=d.secmgr.version}catch(e){o="0.0.0.0"}break;case"meadco.triprint":try{o=MeadCo.ScriptX.Print.HTML.version}catch(e){o="0.0.0.0"}}o=o.split("."),t[0]=o[0],r[0]=o[1],n[0]=o[2],i[0]=o[3]},ComponentVersionString:function(e){var t=new Object,r=new Object,n=new Object,i=new Object;return d.factory.GetComponentVersion(e,t,r,n,i),t[0]+"."+r[0]+"."+n[0]+"."+i[0]},get ScriptXVersion(){return u},get SecurityManagerVersion(){return u},IsUniqueIDAvailable:function(e){return!1},UniqueID:function(e){return 0},ResetUniqueID:function(e){return 0},baseURL:function(e){var t=document.createElement("a");return t.href=e,t.href},relativeURL:function(e){throw"MeadCo.ScriptX.Print :: relativeUrl is not implemented.\n\nPlease see https://github.com/medialize/URI.js for an alternative."},OnDocumentComplete:function(e,t){void 0===e.contentWindow?t():e.addEventListener("load",function(e){t()},{once:!0})},get rawPrinting(){var i="",o=MeadCo.ScriptX.Print;function t(e,t){var r=!1;if(void 0!==o){var n=factory.printing.printer;factory.printing.printer=i,e===o.ContentType.URL&&(t=d.factory.baseURL(t)),r=o.printDirect(e,t),factory.printing.printer=n}return r}return{get printer(){return i},set printer(e){var t=factory.printing.printer;if(factory.printing.printer=e,factory.printing.printer!==e)throw"Unknown printer";factory.printing.printer=t,i=e},printString:function(e){return void 0!==o&&t(o.ContentType.STRING,e)},printDocument:function(e){return void 0!==o&&t(o.ContentType.URL,e)}}},Shutdown:function(){return null},extendFactoryNamespace:function(e,t){var r=t();f("MeadCo factory extending namespace: "+e);for(var n=e.split("."),i=d,o=0;o<n.length;o++){var a=n[o];o===n.length-1?void 0===i[a]?(f("installing implementation at: "+a),i[a]=r):f("Warning - not overwriting package: "+a):void 0===i[a]?(f("initialising new: "+a),i[a]={}):f("using existing package: "+a),i=i[a]}},keyPressCtrlP:function(e){e.ctrlKey&&80==e.keyCode&&!e.shiftKey&&(e.preventDefault(),f("ctrl-p being handled."),d.print())}}}();this[e]=n}("factory"),"function"==typeof factory.extendFactoryNamespace&&factory.extendFactoryNamespace("factory.printing",function(){var c=MeadCo.ScriptX.Print.HTML,a=MeadCo.ScriptX.Print.PDF,i=c.settings,s=MeadCo.ScriptX.Print,u=["html://","html4://","html5://"],p=this;function l(e,t,r){void 0===e&&(e=!0);var n=s.ensureSpoolingStatus(),i=!1,o=null;if(e){if(MeadCo.ScriptX.Print.UI){if(MeadCo.ScriptX.Print.UI.PrinterSettings(function(e){if(e){MeadCo.log("promptAndPrint requesting print ...");try{i=t(),r(i)}catch(e){o=e}}else r(!1);s.freeSpoolStatus(n)}),null!==o)throw o;return MeadCo.log("promptAndPrint exits ..."),i}MeadCo.warn("prompted print requested but no UI library loaded. See: https://www.meadroid.com/Developers/KnowledgeBank/Articles/Dialogs")}try{i=t(),r(i)}catch(e){o=e}finally{s.freeSpoolStatus(n)}if(null!==o)throw o;return i}function o(e,t,r,n,i){var o,a,s=(o=e,"string"!=typeof(a=u.find(function(e){return 0===o.indexOf(e)}))?"":o.substring(a.length));if(0<s.length){var g="<!doctype";s.substr(0,g.length).toLowerCase()===g&&(s=s.substring(s.indexOf(">")+1))}else e=p.factory.baseURL(e);return l(t,function(){return MeadCo.log("printHtmlContent requesting print ..."),0<s.length?c.printHtml(s,null,n,i):c.printFromUrl(e,null,n,i)},r)}function g(e,t,r,n,i){return void 0!==a?(e=p.factory.baseURL(e),l(t,function(){return MeadCo.log("printPdfContent requesting print ..."),a.print(e,null,n,i)},r)):(MeadCo.error("MeadCo.ScriptX.Print.PDF is not available to ScriptX.Services factory emulation."),r(!1),!1)}p.factory.log("factory.Printing loaded.");var d={get allPagesHeader(){return i.extraHeadersAndFooters.allPagesHeader},set allPagesHeader(e){i.extraHeadersAndFooters.allPagesHeader=e},get allPagesFooter(){return i.extraHeadersAndFooters.allPagesFooter},set allPagesFooter(e){i.extraHeadersAndFooters.allPagesFooter=e},get firstPageHeader(){return i.extraHeadersAndFooters.firstPageHeader},set firstPageHeader(e){i.extraHeadersAndFooters.firstPageHeader=e},get firstPageFooter(){return i.extraHeadersAndFooters.firstPageFooter},set firstPageFooter(e){i.extraHeadersAndFooters.firstPageFooter=e},get extraFirstPageFooter(){return i.extraHeadersAndFooters.extraFirstPageFooter},set extraFirstPageFooter(e){i.extraHeadersAndFooters.extraFirstPageFooter=e},get allHeaderHeight(){return i.extraHeadersAndFooters.allHeaderHeight},set allHeaderHeight(e){if("number"!=typeof e)throw"Invalid argument";i.extraHeadersAndFooters.allHeaderHeight=e},get allFooterHeight(){return i.extraHeadersAndFooters.allFooterHeight},set allFooterHeight(e){if("number"!=typeof e)throw"Invalid argument";i.extraHeadersAndFooters.allFooterHeight=e},get firstHeaderHeight(){return i.extraHeadersAndFooters.firstHeaderHeight},set firstHeaderHeight(e){if("number"!=typeof e)throw"Invalid argument";i.extraHeadersAndFooters.firstHeaderHeight=e},get firstFooterHeight(){return i.extraHeadersAndFooters.firstFooterHeight},set firstFooterHeight(e){if("number"!=typeof e)throw"Invalid argument";i.extraHeadersAndFooters.firstFooterHeight=e},get extraFirstFooterHeight(){return i.extraHeadersAndFooters.extraFirstFooterHeight},set extraFirstFooterHeight(e){if("number"!=typeof e)throw"Invalid argument";i.extraHeadersAndFooters.extraFirstFooterHeight=e},get pageRange(){return i.pageRange},set pageRange(e){i.pageRange=e,void 0!==a&&(a.settings.pageRange=e)},get printingPass(){var e="";switch(i.printingPass){case c.PrintingPasses.DEFAULT:case c.PrintingPasses.ALL:e="all";break;case c.PrintingPasses.ODD:e="odd";break;case c.PrintingPasses.EVEN:e="even"}return e},set printingPass(e){var t=c.PrintingPasses.ALL;if("string"==typeof e)switch(e.toLowerCase()){case"odd":t=c.PrintingPasses.ODD;break;case"even":t=c.PrintingPasses.EVEN;break;case"odd&even":case"all":t=c.PrintingPasses.ALL}i.printingPass=t},get pdfPrintMode(){return void 0!==a?a.settings.printQuality:0},set pdfPrintMode(e){void 0!==a&&(a.settings.printQuality=e)}};if(void 0!==s){s.useAttributes(),"function"==typeof p.print&&(p.factory.log("overwriting module.print"),p.print=function(){p.factory.log("window.print() called and being handled."),l(!0,function(){return c.printDocument()},function(){})});var e=null!=document.querySelector("[data-meadco-ctrlp='false']");e||(p.factory.log("using addEventListener('keydown',factory.keyPressCtrlP) for Ctrl-P"),document.addEventListener("keydown",factory.keyPressCtrlP))}else MeadCo.error("MeadCo.ScriptX.Print is not available to ScriptX.Services factory emulation.");return{set header(e){p.factory.log("set factory.printing.header: "+e),i.header=e},get header(){return i.header},set footer(e){i.footer=e},get footer(){return i.footer},set headerFooterFont(e){i.headerFooterFont=e},get headerFooterFont(){return i.headerFooterFont},set orientation(e){switch(e.toLowerCase()){case"landscape":i.page.orientation=c.PageOrientation.LANDSCAPE;break;case"portrait":i.page.orientation=c.PageOrientation.PORTRAIT}},get orientation(){return i.page.orientation===c.PageOrientation.PORTRAIT?"portrait":"landscape"},set portrait(e){i.page.orientation=e?c.PageOrientation.PORTRAIT:c.PageOrientation.LANDSCAPE},get portrait(){return i.page.orientation===c.PageOrientation.PORTRAIT},set leftMargin(e){i.page.margins.left=e},get leftMargin(){return i.page.margins.left},set topMargin(e){i.page.margins.top=e},get topMargin(){return i.page.margins.top},set bottomMargin(e){i.page.margins.bottom=e},get bottomMargin(){return i.page.margins.bottom},set rightMargin(e){i.page.margins.right=e},get rightMargin(){return i.page.margins.right},set templateURL(e){},get templateURL(){return"MeadCo://default"},IsTemplateSupported:function(){return!0},PageSetup:function(e){"function"!=typeof e&&(MeadCo.warn("PageSetup API in ScriptX.Print Service is not synchronous, there is no return value."),e=function(e){MeadCo.log("PageSetupDlg: "+e)}),MeadCo.ScriptX.Print.UI?MeadCo.ScriptX.Print.UI.PageSetup(e):(MeadCo.error("PageSetup dialog in ScriptX.Services needs a dialog implementation. See: https://www.meadroid.com/Developers/KnowledgeBank/Articles/Dialogs"),e(!1))},PrintSetup:function(e){"function"!=typeof e&&(MeadCo.warn("PrintSetup API in ScriptX.Print Service is not synchronous, there is no return value."),e=function(e){MeadCo.log("PrintSetupDlg: "+e)}),MeadCo.ScriptX.Print.UI?MeadCo.ScriptX.Print.UI.PrinterSettings(e):(MeadCo.error("PrintSettings dialog in ScriptX.Services needs a dialog implementation. See: https://www.meadroid.com/Developers/KnowledgeBank/Articles/Dialogs"),e(!1))},Preview:function(e){if(e&&("object"!=typeof e||e.id)||(e=null),null!==e){var t="string"==typeof e?e:e.id;return c.previewFrame(t)}c.previewDocument()},Print:function(e,t,r){return r||(r=function(e){MeadCo.log("A print has started")}),t&&("object"!=typeof t||t.id)||(t=null),l(e,function(){if(null===t)return c.printDocument();var e="string"==typeof t?t:t.id;return c.printFrame(e)},r)},PrintHTML:function(e,t,r){return void 0===r&&(r=function(e){}),o(e,t,r)},PrintHTMLEx:function(e,t,r,n,i){return void 0===i&&(i=function(e){}),o(e,t,i,r,n)},PrintPDF:function(e,t,r,n,i,o){return void 0===o&&(o=function(e){}),void 0!==a?(a.resetSettings(),void 0!==e.pagescaling?a.settings.pageScaling=e.pagescaling:a.settings.pageScaling=r?a.PdfPageScaling.SHRINKLARGEPAGES:a.PdfPageScaling.UNDEFINED,void 0!==e.autorotatecenter?a.settings.autoRotateCenter=e.autorotatecenter?a.BooleanOption.TRUE:a.BooleanOption.FALSE:a.settings.autoRotateCenter=a.BooleanOption.DEFAULT,void 0!==e.orientation?a.settings.orientation=1===e.orientation?a.PageOrientation.PORTRAIT:a.PageOrientation.LANDSCAPE:a.settings.orientation=this.portrait?a.PageOrientation.PORTRAIT:a.PageOrientation.LANDSCAPE,void 0!==e.pages?a.settings.pageRange=e.pages:a.settings.pageRange=void 0!==n&&void 0!==i&&-1!==n&&-1!==i?n+"-"+i:"",void 0!==e.monochrome?a.settings.monochrome=e.monochrome?a.BooleanOption.TRUE:a.BooleanOption.FALSE:a.settings.monochrome=a.BooleanOption.DEFAULT,void 0!==e.normalise||void 0!==e.normalize?a.settings.normalise=e.normalise||e.normalize?a.BooleanOption.TRUE:a.BooleanOption.FALSE:a.settings.normalise=a.BooleanOption.DEFAULT,void 0!==e.printMode?a.settings.printQuality=e.printMode:void 0!==e.printQuality&&(a.settings.printQuality=e.printQuality),void 0!==e.jobname&&(a.settings.jobDescription=e.jobname),void 0!==e.jobName&&(a.settings.jobDescription=e.jobName),g(e.url,t,o)):(MeadCo.error("MeadCo.ScriptX.Print.PDF is not available to ScriptX.Services factory emulation."),o(!1),!1)},BatchPrintPDF:function(e,t){this.BatchPrintPDFEx(e,function(){},"BatchPrintPDF",t)},BatchPrintPDFEx:function(e,t,r,n){if(void 0===n&&(n=function(e){}),void 0!==a)return a.resetSettings(),a.settings.pageRange=d.pageRange,a.settings.pageScaling=-1===i.viewScale?a.PdfPageScaling.SHRINKLARGEPAGES:a.PdfPageScaling.UNDEFINED,a.settings.orientation=this.portrait?a.PageOrientation.PORTRAIT:a.PageOrientation.LANDSCAPE,a.settings.printQuality=d.pdfPrintMode,void g(e,!1,n,t,r);MeadCo.error("MeadCo.ScriptX.Print.PDF is not available to ScriptX.Services factory emulation."),n(!1)},set units(e){this.SetMarginMeasure(e)},get units(){return this.GetMarginMeasure()},set paperSize(e){s.deviceSettings.paperSizeName=e},get paperSize(){return s.deviceSettings.paperSizeName},set paperSource(e){s.deviceSettings.paperSourceName=e},get paperSource(){return s.deviceSettings.paperSourceName},set paperSource2(e){s.deviceSettings.paperSourceName=e},get paperSource2(){return s.deviceSettings.paperSourceName},get pageWidth(){return s.deviceSettings.paperPageSize.width},get pageHeight(){return s.deviceSettings.paperPageSize.height},set copies(e){s.deviceSettings.copies=e},get copies(){return s.deviceSettings.copies},set collate(e){s.deviceSettings.collate=!0===e||1===e?s.CollateOptions.TRUE:s.CollateOptions.FALSE},get collate(){return s.deviceSettings.collate===s.CollateOptions.TRUE},set duplex(e){s.deviceSettings.duplex=e},get duplex(){return s.deviceSettings.duplex},set duplex2(e){s.deviceSettings.duplex=e},get duplex2(){return s.deviceSettings.duplex},set onbeforeprint(e){s.reportFeatureNotImplemented("onbeforeprint",e)},set onafterprint(e){s.reportFeatureNotImplemented("onafterprint",e)},set onuserprintpreview(e){s.reportFeatureNotImplemented("onuserprintpreview",e)},DefaultPrinter:function(){return s.deviceSettingsFor("systemdefault").printerName},get CurrentPrinter(){return s.printerName},set CurrentPrinter(e){this.currentPrinter=e},get currentPrinter(){return s.printerName},set currentPrinter(e){if("string"==typeof e){var t=s.onErrorAction;s.onErrorAction=s.ErrorAction.THROW;try{s.printerName=e,s.onErrorAction=t}catch(e){throw s.onErrorAction=t,e}}},get printer(){return s.printerName},set printer(e){if("string"==typeof e){var t=s.onErrorAction;s.onErrorAction=s.ErrorAction.THROW;try{s.printerName=e,s.onErrorAction=t}catch(e){s.onErrorAction=t}}},set printToFileName(e){s.deviceSettings.printToFileName=e},get printBackground(){return i.printBackgroundColorsAndImages},set printBackground(e){i.printBackgroundColorsAndImages=e},get viewScale(){return i.viewScale},set viewScale(e){i.viewScale=e},set unprintableLeft(e){s.deviceSettings.unprintableMargins.left=e},get unprintableLeft(){return s.deviceSettings.unprintableMargins.left},set unprintableRight(e){s.deviceSettings.unprintableMargins.right=e},get unprintableRight(){return s.deviceSettings.unprintableMargins.right},set unprintableTop(e){s.deviceSettings.unprintableMargins.top=e},get unprintableTop(){return s.deviceSettings.unprintableMargins.top},set unprintableBottom(e){s.deviceSettings.unprintableMargins.bottom=e},get unprintableBottom(){return s.deviceSettings.unprintableMargins.bottom},EnumPrinters:function(e){var t=s.availablePrinterNames;if(t&&0!==t.length){if(e<t.length)return t[e]}else if(0===e)return this.CurrentPrinter;return""},EnumJobs:function(e,t,r){var n,i=s.queue,o=new Array;for(e=e.toLowerCase(),n=0;n<i.length;n++)i[n].printerName.toLowerCase()===e&&o.push(i[n]);return t<o.length?(r.name=o[t].jobName,o[t].status):0},GetJobsCount:function(e){var t,r=s.queue,n=0;for(e=e.toLowerCase(),t=0;t<r.length;t++)r[t].printerName.toLowerCase()===e&&n++;return n},printerControl:function(e){return{get Forms(){return s.deviceSettingsFor(e).forms},get Bins(){return s.deviceSettingsFor(e).bins},get forms(){return s.deviceSettingsFor(e).forms},get bins(){return s.deviceSettingsFor(e).bins},get name(){return e},get status(){return s.deviceSettingsFor(e).port},get port(){return s.deviceSettingsFor(e).port},get attributes(){return s.deviceSettingsFor(e).attributes},get serverName(){return s.deviceSettingsFor(e).serverName},get shareName(){return s.deviceSettingsFor(e).shareName},get location(){return s.deviceSettingsFor(e).location},get isLocal(){return s.deviceSettingsFor(e).isLocal},get isNetwork(){return s.deviceSettingsFor(e).isNetwork},get isShared(){return s.deviceSettingsFor(e).isShared},get Jobs(){s.reportFeatureNotImplemented("printerControl.Jobs")},Purge:function(){s.reportFeatureNotImplemented("printerControl.Purge()")},Pause:function(){s.reportFeatureNotImplemented("printerControl.Pause()")},Resume:function(){s.reportFeatureNotImplemented("printerControl.Resume()")}}},GetMarginMeasure:function(){return i.page.units===s.MeasurementUnits.INCHES?2:1},SetMarginMeasure:function(e){i.page.units=2===e?s.MeasurementUnits.INCHES:s.MeasurementUnits.MM},SetPrintScale:function(e){i.viewScale=e},IsSpooling:function(){return s.isSpooling},OwnQueue:function(){return null},SetPageRange:function(e,t,r){e&&s.reportFeatureNotImplemented("SetPageRange selection only"),i.pageRange=t+"-"+r},SetPreviewZoom:function(){s.reportFeatureNotImplemented("SetPreviewZoom")},Sleep:function(){s.reportFeatureNotImplemented("Sleep")},TotalPrintPages:function(){s.reportFeatureNotImplemented("TotalPrintPages")},WaitForSpoolingComplete:function(e,t){s.waitForSpoolingComplete(e,t)},enhancedFormatting:d,PolyfillInit:function(){return MeadCo.ScriptX.Print.isConnected||c.connect("","",function(e){MeadCo.warn("Services server connection failed: "+e)}),MeadCo.ScriptX.Print.isConnected},PolyfillInitAsync:function(e,t){MeadCo.ScriptX.Print.isConnected?e(2):c.connectAsync("","",e,t)},get PolyfillAuthorisationCookie(){return MeadCo.ScriptX.Print.authorisationCookie},set PolyfillAuthorisationCookie(e){MeadCo.ScriptX.Print.authorisationCookie=e}}}),"function"==typeof factory.extendFactoryNamespace&&factory.extendFactoryNamespace("factory.object",function(){return this.factory.log("factory.object loaded."),this.factory}),"function"==typeof factory.extendFactoryNamespace&&factory.extendFactoryNamespace("factory.object.js",function(){return this.factory.log("factory.object.js loaded."),{FormatNumber:function(e){return isNaN(e)?0:"string"==typeof e?Number(e):e}}});
extendMeadCoNamespace("MeadCo.ScriptX.Print.Licensing",function(){var n="1.12.0.0",a="v1/licensing",d="",o=0,r="",p="No license applied",l={};function c(n,e){var i=MeadCo.ScriptX.Print;void 0!==i&&"function"==typeof i.connectLite?i.connectLite(n,e):console.error("MeadCo.ScriptX.Print is not available"),d=e,l={},p="No license applied",o=0,r=""}function i(e,i){var n=MeadCo.ScriptX.Print;if(void 0!==n&&"function"==typeof n.connectLite)return 0<l.length?"function"==typeof e&&e(l):n.requestService(a,"GET",{},!0,"function"==typeof e,function(n){p="",$.extend(l,n),"function"!=typeof e||e(l)},function(n){if(p=n,"function"!=typeof i)throw new Error(p);i(p)}),l;var t="MeadCo.ScriptX.Licensing : MeadCo.ScriptX.Print API not available";if("function"!=typeof i)throw new Error(t);i(t)}function u(n,e,i,t,o){MeadCo.log("Apply license: "+n+",revision: "+e+", path: "+i);var r=MeadCo.ScriptX.Print;if(void 0===r||"function"!=typeof r.connectLite){var c="MeadCo.ScriptX.Licensing : MeadCo.ScriptX.Print API not available";if("function"==typeof o)return void o(c);throw new Error(c)}if("warehouse"!==i.toLowerCase()){var u=new URL(i,window.location.href);i=u.href,MeadCo.log("path updated to: "+i)}var f={Guid:d=n,Url:i,Revision:e};return r.requestService(a,"POST",f,!1,"function"==typeof t,function(n){p="",$.extend(l,n),"function"!=typeof t||t(l)},function(n){p=n,"function"!=typeof o||o(p)}),"function"!=typeof t?(MeadCo.log("returning applied (sync) license: "+l.company),l):0}return MeadCo.log("MeadCo.ScriptX.Print.Licensing "+n+" loaded."),{get version(){return n},connect:function(n,e){c(n,e)},connectLite:function(n,e,i,t){c(n,e),o=i,r=t},apply:function(n,e,i){return u(n,e,i)},applyAsync:function(n,e,i,t,o){u(n,e,i,t,o)},get result(){return""===p?0:5},get validLicense(){return void 0!==l.guid},get errorMessage(){return p},get detailOnError(){return p},get License(){return void 0!==l.guid?l:i()},GetLicenseAsync:function(n,e){i(n,e)},PolyfillInit:function(){return void 0!==l.guid||""!==d&&(""===r||(u(d,o,r),void 0!==l.guid))},PolyfillInitAsync:function(n,e){void 0!==l.guid||""===r?n(l):u(d,o,r,n,e)}}});
!function(e,t,i){if(this[e]!==i||null!==document.getElementById(e)){if(MeadCo.log("ScriptX.Services MeadCo Security Manager emulation believes it may not be required."),this[e]!==i&&MeadCo.log("this["+e+"] is defined"),null!==document.getElementById(e)&&MeadCo.log("document.getElementById("+e+") is defined"),this[e].object!==i)return MeadCo.log("this["+e+"].object is defined -- not required!!!");MeadCo.log("this["+e+"].object is *not* defined")}MeadCo.log("ScriptX.Services MeadCo Security Manager emulation believes it is required.");var n=function(){var t=MeadCo,e=MeadCo.ScriptX.Print,i=MeadCo.ScriptX.Print.Licensing;function s(e){t.log("secmgr emulation :: "+e)}this.extendSecMgrNamespace=function(e,t){var i=t();s("MeadCo security manager extending namespace2: "+e);for(var n=e.split("."),r=this,o=0;o<n.length;o++){var a=n[o];o===n.length-1?void 0===r[a]?(s("installing implementation at: "+a),r[a]=i):s("Warning - not overwriting package: "+a):void 0===r[a]?(s("initialising new: "+a),r[a]={}):s("using existing package: "+a),r=r[a]}},s("'secmgr' loaded."),"function"!=typeof i.GetLicenseAsync&&MeadCo.error("MeadCo.ScriptX.Print.Licensing not available");"function"!=typeof e.useAttributes?MeadCo.warn("Attribute based licensing not available as MeadCo.ScriptX.Print is not available"):e.useAttributes();return{log:s,get version(){return"1.12.0.0"},get result(){return i.result},get validLicense(){return i.validLicense},get License(){return i.License},get errorMessage(){return i.errorMessage},GetLicenseAsync:function(e,t){i.GetLicenseAsync(e,t)},PolyfillInit:function(){return i.PolyfillInit()},PolyfillInitAsync:function(e,t){i.PolyfillInitAsync(e,t)}}}();this[e]=n}("secmgr"),"function"==typeof extendSecMgrNamespace&&extendSecMgrNamespace("secmgr.object",function(){return this.secmgr.log("secmgr.object loaded."),this.secmgr});