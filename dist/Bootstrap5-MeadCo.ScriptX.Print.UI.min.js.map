{"version":3,"file":"Bootstrap5-MeadCo.ScriptX.Print.UI.min.js","names":["topLevelNs","undefined","ui","createNS","version","log","bAccepted","dlg","fnDlgCallback","okHandler","ev","preventDefault","document","querySelector","settings","MeadCo","ScriptX","Print","HTML","page","orientation","value","printBackgroundColorsAndImages","checked","viewScale","units","parseInt","margins","left","top","right","bottom","header","footer","deviceSettings","paperSizeName","savePageSetup","hide","hideHandler","measureChangeHandler","querySelectorAll","forEach","box","el","parseFloat","toFixed","okPrinterSettingsHandler","printApi","a","onErrorAction","ErrorAction","THROW","printerName","paperSourceName","collate","getAttribute","CollateOptions","TRUE","FALSE","copies","savePrinterSettings","printerChange","onSelectPrinter","getElementById","target","options","selectedIndex","dlgEl","fillAndSetBinsList","fnDone","deviceSettingsForAsync","binsArray","bins","removeAll","i","length","add","Option","eTxt","reportError","selectEl","remove","PageSetup","fnCallBack","bootstrap","Modal","console","error","bs_majorVersion","VERSION","split","dlgId","dlgHtml","tempContainer","createElement","innerHTML","body","appendChild","addEventListener","btnOk","rb","paperSelect","forms","deviceSettingsFor","backdrop","keyboard","show","PrinterSettings","printers","arrPrinters","availablePrinterNames","fillPrintersList","setAttribute","showPrinterSettings","window"],"sources":["Bootstrap5-MeadCo.ScriptX.Print.UI.js"],"mappings":"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","ignoreList":[],"sourcesContent":["// MeadCo.ScriptX.Print.UI\r\n//\r\n// Depends on MeadCo.ScriptX.Print.HTML\r\n//\r\n// A lightweight plug-in not implemented as a plug-in as it will only be used once or twice on a document\r\n// so polluting jQuery is unneccessary.\r\n//\r\n// Optional dependency: bootstrap-select.js : Bootstrap-select (http://silviomoreto.github.io/bootstrap-select)\r\n// The above dependency is completely optional - the code looks for the enabling class.\r\n//\r\n\r\n(function (topLevelNs, undefined) {\r\n    \"use strict\";\r\n\r\n    if ( !topLevelNs ) {\r\n        return;\r\n    }\r\n\r\n    let ui = topLevelNs.createNS(\"MeadCo.ScriptX.Print.UI\");\r\n    ui.version = \"1.16.0.0\";\r\n\r\n    topLevelNs.log(\"MeadCo.ScriptX.Print.UI version is: \" + ui.version);\r\n\r\n    let bAccepted = false;\r\n    let dlg = null;\r\n    let fnDlgCallback = null;\r\n\r\n    function okHandler(ev) {\r\n        ev.preventDefault();\r\n        savePageSetup();\r\n        bAccepted = true;\r\n        dlg.hide();\r\n    }\r\n\r\n    function hideHandler() {\r\n        if (fnDlgCallback) fnDlgCallback(bAccepted);\r\n    }\r\n\r\n    function measureChangeHandler() {\r\n        switch (document.querySelector('[name=\"fld-measure\"]:checked').value) {\r\n            case '2': // mm from inches\r\n                document.querySelectorAll(`#dlg-printoptions input[type=number][data-rule=measure]`)\r\n                    .forEach(box => { convertAndDisplayinchesToMM(box); });\r\n                break;\r\n\r\n            case '1': // inches from mm\r\n                document.querySelectorAll(`#dlg-printoptions input[type=number][data-rule=measure]`)\r\n                    .forEach(box => { convertAndDisplayMMtoInches(box); });\r\n                break;\r\n        }\r\n\r\n    }\r\n\r\n    function savePageSetup() {\r\n        const dlg = document.querySelector('#dlg-printoptions');\r\n        const settings = MeadCo.ScriptX.Print.HTML.settings;\r\n\r\n        if (dlg) {\r\n            settings.page.orientation = dlg.querySelector('[name=\"fld-orientation\"]:checked').value;\r\n            settings.printBackgroundColorsAndImages = dlg.querySelector('#fld-printbackground').checked;\r\n            settings.viewScale = dlg.querySelector('#fld-shrinktofit').checked ? -1 : 100;\r\n            settings.page.units = parseInt(dlg.querySelector('[name=\"fld-measure\"]:checked').value);\r\n            settings.page.margins.left = dlg.querySelector('#fld-marginL').value;\r\n            settings.page.margins.top = dlg.querySelector('#fld-marginT').value;\r\n            settings.page.margins.right = dlg.querySelector('#fld-marginR').value;\r\n            settings.page.margins.bottom = dlg.querySelector('#fld-marginB').value;\r\n            settings.header = dlg.querySelector('#fld-header').value;\r\n            settings.footer = dlg.querySelector('#fld-footer').value;\r\n\r\n            MeadCo.ScriptX.Print.deviceSettings.paperSizeName = dlg.querySelector('#fld-papersize').value\r\n        }\r\n    }\r\n\r\n\r\n    // MeadCo.ScriptX.Print.UI.PageSetup()\r\n    ui.PageSetup = function (fnCallBack) {\r\n\r\n        if ( !bootstrap.Modal) {\r\n            console.error(\"MeadCo.ScriptX.Print.UI requires bootstrap v5 or later\");\r\n            fnCallBack(false);\r\n            return;\r\n        }\r\n\r\n        bAccepted = false;\r\n        fnDlgCallback = fnCallBack;\r\n\r\n        const sClass = \"\";\r\n        const bs_majorVersion = (bootstrap.Modal.VERSION || '').split(' ')[0].split('.')[0];\r\n\r\n        // page setup modal to attach to the page\r\n        //\r\n        // Simple override is to include the dialog in the page with id=\"dlg-printoptions\"\r\n        //\r\n        const dlgId = \"dlg-printoptions\";\r\n        let dlgEl = document.getElementById(dlgId);\r\n\r\n        if (!dlgEl) {\r\n            console.log(\"UI.PageSetup bootstrap modal version: \" + bootstrap.Modal.VERSION + \", major: \" + bs_majorVersion);\r\n            let dlgHtml;\r\n\r\n            switch (bs_majorVersion) {\r\n                case '5':\r\n                    dlgHtml = '<div class=\"modal\" tabindex=\"-1\" id=\"dlg-printoptions\"><div class=\"modal-dialog modal-dialog-scrollable modal-dialog-centered modal-lg\" role = \"document\">' +\r\n                        '<div class=\"modal-content\"><div class=\"modal-header\"><h5 class=\"modal-title\">Page setup</h5><button type=\"button\" class=\"btn-close\" data-dismiss=\"modal\" aria-label=\"Close\">' +\r\n                        '<span aria-hidden=\"true\"></span></button></div><div class=\"modal-body\"><div class=\"bs-component\"><fieldset><legend>Paper</legend><div class=\"row\">' +\r\n                        '<label for=\"fld-papersize\" class=\"col-md-4 col-form-label text-right col-form-label-sm\">Size</label><div class=\"col-md-8\"><select class=\"' + sClass + ' form-select form-select-sm\" id=\"fld-papersize\"></select>' +\r\n                        '</div></div><div class=\"row mt-2\"><div class=\"col-md-8 offset-md-4\">' +\r\n                        '<div class=\"form-check form-check-inline\"><input class=\"form-check-input\" type=\"radio\" value=\"2\" id=\"fld-portrait\" name=\"fld-orientation\" /><label class=\"form-check-label\" for=\"fld-portrait\">Portrait</label></div>' +\r\n                        '<div class=\"form-check form-check-inline\"><input class=\"form-check-input\" type=\"radio\" value=\"1\" id=\"fld-landscape\" name=\"fld-orientation\" /><label class=\"form-check-label\" for=\"fld-portrait\">Landscape</label></div></div></div>' +\r\n                        '<div class=\"row\"><div class=\"col-md-8 offset-md-4\"><div class=\"form-check form-check-inline\"><input class=\"form-check-input\" type=\"checkbox\" name=\"fld-shrinktofit\" id=\"fld-shrinktofit\">' +\r\n                        '<label class=\"form-check-label\" for=\"fld-shrinktofit\">Shrink to fit</label></div></div></div><div class=\"row\"><div class=\"col-md-8 offset-md-4\"><div class=\"form-check form-check-inline\">' +\r\n                        '<input class=\"form-check-input\" type=\"checkbox\" name=\"fld-printbackground\" id=\"fld-printbackground\"><label class=\"form-check-label\" for=\"fld-printbackground\">Print background colour and images</label>' +\r\n                        '</div></div></div></fieldset><fieldset><legend>Margins</legend><div class=\"row\"><div class=\"col-md-8 offset-md-4\" id=\"radiomeasures\">' +\r\n                        '<div class=\"form-check form-check-inline\"><input class=\"form-check-input\" type=\"radio\" value=\"2\" id=\"fld-millimetres\" name=\"fld-measure\" /><label class=\"form-check-label\" for=\"fld-millimetres\">Millimetres</label></div>' +\r\n                        '<div class=\"form-check form-check-inline\"><input class=\"form-check-input\" type=\"radio\" value=\"1\" id=\"fld-inches\" name=\"fld-measure\" /><label class=\"form-check-label\" for=\"fld-inches\">Inches</label></div></div></div>' +\r\n                        '<div class=\"row mt-2\"><label class=\"col-md-4 col-form-label text-right col-form-label-sm\">Left</label>' +\r\n                        '<div class=\"col-md-3\"><div class=\"input-group\"><input name=\"fld-marginL\" id=\"fld-marginL\" type=\"number\" min=\"0\" max=\"30\" step=\"0.1\" class=\"form-control text-right form-control-sm\" data-rule=\"measure\" value=\"1\" />' +\r\n                        '</div></div><label class=\"col-md-2 col-form-label text-right col-form-label-sm\">Top</label><div class=\"col-md-3\"><div class=\"input-group\"><input name=\"fld-marginT\" id=\"fld-marginT\" type=\"number\" min=\"0\" max=\"30\" step=\"0.1\" class=\"form-control text-right form-control-sm\" data-rule=\"measure\" value=\"1\" />' +\r\n                        '</div></div></div><div class=\"row mt-2\"><label class=\"col-md-4 col-form-label text-right col-form-label-sm\">Right</label><div class=\"col-md-3\"><div class=\"input-group\">' +\r\n                        '<input name=\"fld-marginR\" id=\"fld-marginR\" type=\"number\" min=\"0\" max=\"30\" step=\"0.1\" class=\"form-control text-right form-control-sm\" value=\"1\" data-rule=\"measure\"/></div></div><label class=\"col-md-2 col-form-label text-right col-form-label-sm\">Bottom</label>' +\r\n                        '<div class=\"col-md-3\"><div class=\"input-group\"><input name=\"fld-marginB\" id=\"fld-marginB\" type=\"number\" min=\"0\" max=\"30\" step=\"0.1\" class=\"form-control text-right form-control-sm\" value=\"1\" data-rule=\"measure\"/>' +\r\n                        '</div></div></div></fieldset><fieldset class=\"mt-2\"><legend>Headers and footers</legend><div class=\"row\"><label for=\"fld-header\" class=\"col-md-4 col-form-label text-right col-form-label-sm\">Header</label>' +\r\n                        '<div class=\"col-md-8\"><input type=\"text\" name=\"fld-header\" id=\"fld-header\" class=\"form-control form-control-sm\" /></div></div><div class=\"row mt-2\"><label for=\"fld-footer\" class=\"col-md-4 col-form-label text-right col-form-label-sm\">Footer</label>' +\r\n                        '<div class=\"col-md-8\"><input type=\"text\" name=\"fld-footer\" id=\"fld-footer\" class=\"form-control form-control-sm\" /></div></div></fieldset></div>' +\r\n                        '</div><div class=\"modal-footer\"><button type=\"button\" class=\"btn btn-primary\" id=\"btn-saveoptions\">OK</button><button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">Cancel</button></div></div></div></div>';\r\n                    break;\r\n\r\n                default:\r\n                    console.error(\"Unknown version of bootstrap: \" + bs_majorVersion);\r\n                    fnCallBack(false);\r\n                    return;\r\n            }\r\n\r\n            const tempContainer = document.createElement('div');\r\n\r\n            tempContainer.innerHTML = dlgHtml;\r\n            document.body.appendChild(tempContainer, null);\r\n            dlgEl = document.getElementById(dlgId);\r\n        }\r\n\r\n        if (dlgEl) {\r\n            const measure = dlgEl.querySelector('#radiomeasures');\r\n            measure.addEventListener(\"change\", measureChangeHandler);\r\n\r\n            const btnOk = dlgEl.querySelector(\"#btn-saveoptions\");\r\n            if (btnOk) {\r\n                btnOk.addEventListener(\"click\", okHandler);\r\n            }\r\n\r\n            dlgEl.addEventListener(\"hidden.bs.modal\", hideHandler);\r\n        }\r\n\r\n        let settings = MeadCo.ScriptX.Print.HTML.settings;\r\n\r\n        let rb = dlgEl.querySelector(`input[name=\"fld-orientation\"][value=\"${settings.page.orientation}\"]`);\r\n        if ( rb ) rb.checked = true;\r\n\r\n        dlgEl.querySelector('#fld-printbackground').checked = settings.printBackgroundColorsAndImages;\r\n        dlgEl.querySelector('#fld-shrinktofit').checked = settings.viewScale == -1;\r\n\r\n        rb = dlgEl.querySelector(`input[name=\"fld-measure\"][value=\"${settings.page.units}\"]`);\r\n        if ( rb ) rb.checked = true;\r\n\r\n        dlgEl.querySelector('#fld-marginL').value = settings.page.margins.left;\r\n        dlgEl.querySelector('#fld-marginT').value = settings.page.margins.top;\r\n        dlgEl.querySelector('#fld-marginR').value  = settings.page.margins.right;\r\n        dlgEl.querySelector('#fld-marginB').value = settings.page.margins.bottom;\r\n        dlgEl.querySelector('#fld-header').value = settings.header;\r\n        dlgEl.querySelector('#fld-footer').value = settings.footer;\r\n\r\n        // grab the paper size options \r\n        const printApi = MeadCo.ScriptX.Print;\r\n        const paperSelect = document.querySelector('#fld-papersize');\r\n        const forms = printApi.deviceSettingsFor(printApi.printerName).forms;\r\n\r\n        removeAll(paperSelect);\r\n        for (var i in forms) {\r\n            paperSelect.add(new Option(forms[i]));\r\n        }\r\n\r\n        paperSelect.value = MeadCo.ScriptX.Print.deviceSettings.paperSizeName;\r\n\r\n        dlg = new bootstrap.Modal(document.getElementById(dlgId), {\r\n            backdrop: 'static',\r\n            keyboard: false\r\n        });\r\n\r\n        dlg.show();\r\n\r\n    };\r\n\r\n    // MeadCo.ScriptX.Print.UI.PrinterSettings()\r\n    function okPrinterSettingsHandler(ev) {\r\n        ev.preventDefault();\r\n        savePrinterSettings();\r\n        bAccepted = true;\r\n        dlg.hide();\r\n    }\r\n\r\n\r\n    function printerChange(ev) {\r\n        onSelectPrinter(document.getElementById(\"dlg-printersettings\"), ev.target.options[ev.target.selectedIndex].value);\r\n    }\r\n\r\n    ui.PrinterSettings = function (fnCallBack) {\r\n\r\n        if ( !bootstrap.Modal ) {\r\n            console.error(\"MeadCo.ScriptX.Print.UI requires bootstrap Modal\");\r\n            fnCallBack(false);\r\n            return;\r\n        }\r\n\r\n        const bs_majorVersion = (bootstrap.Modal.VERSION || '').split(' ')[0].split('.')[0];\r\n\r\n        const dlgId = \"dlg-printersettings\";\r\n\r\n        let dlgEl = document.getElementById(dlgId);\r\n\r\n        bAccepted = false;\r\n        const sClass = \"\";\r\n        fnDlgCallback = fnCallBack;\r\n\r\n        // printer settings modal to attach to the page\r\n        if (!dlgEl) {\r\n            console.log(\"UI.PageSetup bootstrap modal version: \" + bootstrap.Modal.VERSION + \", major: \" + bs_majorVersion);\r\n            let dlgHtml;\r\n            \r\n\r\n            switch (bs_majorVersion) {\r\n\r\n                case '5':\r\n                    dlgHtml = '<div class=\"modal\" id=\"dlg-printersettings\"><div class=\"modal-dialog role = \"document\"><div class=\"modal-content\">' +\r\n                        '<div class=\"modal-header\"><h5 class=\"modal-title\">Print</h5><button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\"><span aria-hidden=\"true\"></span>' +\r\n                        '</button></div><div class=\"modal-body\"><div class=\"bs-component\"><div class=\"row\"><label for=\"fld-printerselect\" class=\"col-md-4 form-label text-right col-form-label-sm\">Printer</label>' +\r\n                        '<div class=\"col-md-8\"><select class=\"' + sClass + ' form-select form-select-sm\" id=\"fld-printerselect\"></select></div></div><div class=\"row mt-2\">' +\r\n                        '<label for=\"fld-papersource\" class=\"col-md-4 form-label text-right col-form-label-sm\">Paper source</label><div class=\"col-md-8\"><select class=\"' + sClass + ' form-select form-select-sm\" id=\"fld-papersource\"></select>' +\r\n                        '</div></div><div class=\"row g-3\" style=\"margin-top:-8px\"><label for=\"fld-copies\" class=\"col-md-4 form-label text-right col-form-label-sm\">Copies</label><div class=\"col-md-3\">' +\r\n                        '<input name=\"fld-copies\" id=\"fld-copies\" type=\"number\" min=\"1\" max=\"5\" step=\"1\" class=\"form-control form-control-sm text-right\" data-rule=\"quantity\" value=\"1\" /></div><div class=\"col-md-5\"><div class=\"form-check\" style=\"margin-top: 4px\">' +\r\n                        '<input class=\"form-check-input\" type=\"checkbox\" name=\"fld-collate\" id=\"fld-collate\"><label class=\"form-check-label\" for=\"fld-collate\">Collate</label></div></div></div></div>' +\r\n                        '</div><div class=\"modal-footer\"><button type=\"button\" class=\"btn btn-primary\" id=\"btn-savesettings\">Print</button><button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">Cancel</button></div></div></div></div >';\r\n                    break;\r\n\r\n                default:\r\n                    console.error(\"Unknown version of bootstrap: \" + bs_majorVersion);\r\n                    fnCallBack(false);\r\n                    return;\r\n            }\r\n\r\n            const tempContainer = document.createElement('div');\r\n\r\n            tempContainer.innerHTML = dlgHtml;\r\n            document.body.appendChild(tempContainer, null);\r\n\r\n            dlgEl = document.getElementById(dlgId);\r\n\r\n        }\r\n\r\n        if (dlgEl) {\r\n\r\n            let el = dlgEl.querySelector(\"#btn-savesettings\");\r\n            if (el) {\r\n                el.addEventListener(\"click\", okPrinterSettingsHandler);\r\n            }\r\n\r\n            el = dlgEl.querySelector(\"#fld-printerselect\");\r\n            if (el)\r\n                el.addEventListener(\"change\", printerChange);\r\n\r\n            dlgEl.addEventListener(\"hidden.bs.modal\", hideHandler);            \r\n\r\n        }\r\n\r\n        fillPrintersList(dlgEl);\r\n        showPrinterSettings(dlgEl);\r\n\r\n        dlg = new bootstrap.Modal(document.getElementById(dlgId), {\r\n            backdrop: 'static',\r\n            keyboard: false\r\n        });\r\n\r\n        dlg.show();\r\n    }\r\n\r\n    // show available sources and options \r\n    function showPrinterSettings(dlgEl) {\r\n\r\n        fillAndSetBinsList(dlgEl, MeadCo.ScriptX.Print.printerName, () => {\r\n            const printApi = MeadCo.ScriptX.Print;\r\n            const settings = printApi.deviceSettings;\r\n\r\n            dlgEl.querySelector('#fld-collate').setAttribute('checked', settings.collate === printApi.CollateOptions.TRUE);\r\n            dlgEl.querySelector('#fld-copies').value = settings.copies;\r\n        });\r\n    }\r\n\r\n    function savePrinterSettings() {\r\n        let dlg = document.querySelector('#dlg-printersettings');\r\n        const printApi = MeadCo.ScriptX.Print;\r\n\r\n        if ( dlg ) {\r\n            // must set the printer first and note this might trigger a getDeviceSettings call to the server\r\n            const a = printApi.onErrorAction;\r\n\r\n            printApi.onErrorAction = printApi.ErrorAction.THROW;\r\n\r\n            // eat all and any errors. finally might be better but\r\n            // minifiers dont like empty blocks \r\n            try {\r\n                printApi.printerName = dlg.querySelector('#fld-printerselect').value\r\n            }\r\n            finally {\r\n                printApi.onErrorAction = a;\r\n            }\r\n\r\n            // update settings for the active printer\r\n            let settings = printApi.deviceSettings;\r\n            settings.paperSourceName = dlg.querySelector('#fld-papersource').value;\r\n            settings.collate = dlg.querySelector('#fld-collate').getAttribute('checked') ? printApi.CollateOptions.TRUE : printApi.CollateOptions.FALSE\r\n            settings.copies = parseInt(dlg.querySelector('#fld-copies').value);\r\n        }\r\n    }\r\n\r\n    // fill printers dropdown with those available\r\n    function fillPrintersList(dlgEl) {\r\n        const printApi = MeadCo.ScriptX.Print;\r\n        const printers = dlgEl.querySelector('#fld-printerselect');\r\n        const arrPrinters = printApi.availablePrinterNames;\r\n\r\n        removeAll(printers);\r\n        for (let i = 0; i < arrPrinters.length; i++) {\r\n            printers.add(new Option(arrPrinters[i]));\r\n        }\r\n\r\n        printers.value = printApi.printerName;\r\n        onSelectPrinter(dlgEl,printApi.printerName);\r\n    }\r\n\r\n    function onSelectPrinter(dlgEl,printerName) {\r\n        fillAndSetBinsList(dlgEl,printerName);\r\n    }\r\n\r\n    function fillAndSetBinsList(dlgEl,printerName,fnDone) {\r\n        const printApi = MeadCo.ScriptX.Print;\r\n\r\n        printApi.deviceSettingsForAsync(printerName, (settings) => {\r\n            const binsArray = settings.bins;\r\n            const bins = dlgEl.querySelector('#fld-papersource');\r\n\r\n            removeAll(bins);\r\n            for (var i = 0; i < binsArray.length; i++) {\r\n                bins.add(new Option(binsArray[i]));\r\n            }\r\n\r\n            bins.value = settings.paperSourceName;\r\n            if (fnDone) fnDone();\r\n        },\r\n            (eTxt) => {\r\n                MeadCo.ScriptX.Print.reportError(eTxt);\r\n                if (fnDone) fnDone();\r\n            });\r\n\r\n    }\r\n\r\n    // convert the current inches value in the control to MM\r\n    function convertAndDisplayinchesToMM(el) {\r\n        el.value = ((parseFloat(el.value) * 2540) / 100).toFixed(2);\r\n    }\r\n\r\n    // convert the current mm value in the control to inches\r\n    function convertAndDisplayMMtoInches(el) {\r\n        el.value = ((parseFloat(el.value) * 100) / 2540).toFixed(2);\r\n    }\r\n\r\n    function removeAll(selectEl) {\r\n        for (let i = selectEl.options.length - 1; i >= 0; i--) {\r\n            selectEl.remove(i);\r\n        }\r\n    }\r\n\r\n})(window.MeadCo = window.MeadCo || null);\r\n"]}