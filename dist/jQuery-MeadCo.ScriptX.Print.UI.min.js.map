{"version":3,"file":"jQuery-MeadCo.ScriptX.Print.UI.min.js","names":["topLevelNs","$","undefined","ui","createNS","version","log","PageSetup","fnCallBack","fn","modal","bootstrap","Modal","console","error","bAccepted","sClass","bs_majorVersion","Constructor","VERSION","split","selectpicker","length","dlg","append","off","on","uiType","this","val","each","$el","parseFloat","toFixed","ev","preventDefault","$dlg","settings","MeadCo","ScriptX","Print","HTML","page","orientation","find","printBackgroundColorsAndImages","prop","viewScale","units","parseInt","margins","left","top","right","bottom","header","footer","deviceSettings","paperSizeName","savePageSetup","printApi","$paperselect","forms","deviceSettingsFor","printerName","i","remove","hasClass","PrinterSettings","change","onSelectPrinter","a","onErrorAction","ErrorAction","THROW","e","paperSourceName","collate","CollateOptions","TRUE","FALSE","copies","savePrinterSettings","$printers","arrPrinters","availablePrinterNames","fillPrintersList","fillAndSetBinsList","showPrinterSettings","document","getElementById","backdrop","keyboard","show","currentPrinterName","currentSource","alert","message","deviceSettingsForAsync","binsArray","bins","$bins","eTxt","reportError","window","jQuery"],"sources":["jQuery-MeadCo.ScriptX.Print.UI.js"],"mappings":"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","ignoreList":[],"sourcesContent":["// MeadCo.ScriptX.Print.UI\r\n//\r\n// Depends on MeadCo.ScriptX.Print.HTML\r\n//\r\n// A lightweight plug-in not implemented as a plug-in as it will only be used once or twice on a document\r\n// so polluting jQuery is unneccessary.\r\n//\r\n// Optional dependency: bootstrap-select.js : Bootstrap-select (http://silviomoreto.github.io/bootstrap-select)\r\n// The above dependency is completely optional - the code looks for the enabling class.\r\n//\r\n\r\n(function (topLevelNs, $, undefined) {\r\n    \"use strict\";\r\n\r\n    if (!topLevelNs) {\r\n        return;\r\n    }\r\n\r\n    var ui = topLevelNs.createNS(\"MeadCo.ScriptX.Print.UI\");\r\n    ui.version = \"1.16.0.0\";\r\n\r\n    topLevelNs.log(\"MeadCo.ScriptX.Print.UI version is: \" + ui.version);\r\n\r\n    // MeadCo.ScriptX.Print.UI.PageSetup()\r\n    ui.PageSetup = function (fnCallBack) {\r\n\r\n        if (!$.fn.modal && !bootstrap.Modal) {\r\n            console.error(\"MeadCo.ScriptX.Print.UI requires bootstrap Modal\");\r\n            fnCallBack(false);\r\n            return;\r\n        }\r\n\r\n        var bAccepted = false;\r\n        var sClass = \"\";\r\n        var bs_majorVersion = ($.fn.modal.Constructor.VERSION || '').split(' ')[0].split('.')[0];\r\n\r\n        // check for presence of bootstrap-select.js (doesn't work well with BS 4)\r\n        if ($.fn.selectpicker && bs_majorVersion === '3') {\r\n            sClass = \"selectpicker\";\r\n        }\r\n\r\n        // page setup modal to attach to the page\r\n        //\r\n        // Simple override is to include the dialog in the page with id=\"dlg-printoptions\"\r\n        //\r\n        if (!$('#dlg-printoptions').length) {\r\n            console.log(\"UI.PageSetup bootstrap modal version: \" + $.fn.modal.Constructor.VERSION + \", major: \" + bs_majorVersion);\r\n            var dlg;\r\n\r\n            switch (bs_majorVersion) {\r\n                case '3':\r\n                    dlg = '<style>' +\r\n                        '.modal-dialog legend { font-size: 1.2em; font-weight: bold; margin-bottom: 10px; } ' +\r\n                        '.modal-dialog fieldset { padding-bottom: 0px; } ' +\r\n                        '.modal-dialog .options-modal-body { padding-bottom: 0px !important; } ' +\r\n                        '.modal-dialog .checkbox2 {  padding-top: 0px !important; min-height: 0px !important; } ' +\r\n                        '.modal-dialog .radio2 { padding-top: 0px !important; min-height: 0px !important; } ' +\r\n                        '</style>' +\r\n                        '<div class=\"modal fade\" id=\"dlg-printoptions\">' +\r\n                        '<div class=\"modal-dialog\">' +\r\n                        '<div class=\"modal-content\">' +\r\n                        '<div class=\"modal-header\">' +\r\n                        '<button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-hidden=\"true\">&times;</button>' +\r\n                        '<h4 class=\"modal-title\">Page setup</h4>' +\r\n                        '</div>' +\r\n                        '<div class=\"modal-body form-horizontal options-modal-body\">' +\r\n                        '<fieldset>' +\r\n                        '<legend>Paper</legend>' +\r\n                        '<div class=\"form-group\">' +\r\n                        '<label class=\"col-md-4 control-label\" for=\"fld-papersize\">Size</label>' +\r\n                        '<div class=\"col-md-8\"><select class=\"' + sClass + ' form-control show-tick\" id=\"fld-papersize\"></select></div>' +\r\n                        '</div>' +\r\n                        '<div class=\"form-group\">' +\r\n                        '<div class=\"col-md-offset-4 col-md-8\">' +\r\n                        '<div class=\"radio2\">' +\r\n                        '<label class=\"radio-inline\">' +\r\n                        '<input type=\"radio\" value=\"2\" id=\"fld-portrait\" name=\"fld-orientation\">' +\r\n                        ' Portrait' +\r\n                        '</label>' +\r\n                        '<label class=\"radio-inline\">' +\r\n                        '<input type=\"radio\" value=\"1\" id=\"fld-landscape\" name=\"fld-orientation\">' +\r\n                        ' Landscape' +\r\n                        '</label>' +\r\n                        '</div>' +\r\n                        '</div>' +\r\n                        '</div>' +\r\n                        '<div class=\"form-group\">' +\r\n                        '<div class=\"col-md-offset-4 col-md-8\">' +\r\n                        '<div class=\"checkbox2\">' +\r\n                        '<label class=\"checkbox-inline\">' +\r\n                        '<input type=\"checkbox\" name=\"fld-shrinktofit\" id=\"fld-shrinktofit\">' +\r\n                        ' Shrink to fit' +\r\n                        '</label>' +\r\n                        '</div>' +\r\n                        '</div>' +\r\n                        '</div>' +\r\n                        '<div class=\"form-group\">' +\r\n                        '<div class=\"col-md-offset-4 col-md-8\">' +\r\n                        '<div class=\"checkbox2\">' +\r\n                        '<label class=\"checkbox-inline\">' +\r\n                        '<input type=\"checkbox\" name=\"fld-printbackground\" id=\"fld-printbackground\">' +\r\n                        ' Print background colour and images' +\r\n                        '</label>' +\r\n                        '</div>' +\r\n                        '</div>' +\r\n                        '</div>' +\r\n                        '</fieldset>' +\r\n                        '<fieldset>' +\r\n                        '<legend>Margins</legend>' +\r\n                        '<div class=\"form-group\">' +\r\n                        '<div class=\"col-md-offset-4 col-md-8\">' +\r\n                        '<div class=\"radio2\">' +\r\n                        '<label class=\"radio-inline\">' +\r\n                        '<input type=\"radio\" value=\"2\" id=\"fld-millimetres\" name=\"fld-measure\">' +\r\n                        ' Millimetres' +\r\n                        '</label>' +\r\n                        '<label class=\"radio-inline\">' +\r\n                        '<input type=\"radio\" value=\"1\" id=\"fld-inches\" name=\"fld-measure\">' +\r\n                        ' Inches' +\r\n                        '</label>' +\r\n                        '</div>' +\r\n                        '</div>' +\r\n                        '</div>' +\r\n                        '<div class=\"form-group\">' +\r\n                        '<label class=\"control-label col-md-4\">Left</label>' +\r\n                        '<div class=\"col-md-3\">' +\r\n                        '<input name=\"fld-marginL\" id=\"fld-marginL\" type=\"text\" class=\"form-control text-right\" data-rule=\"measure\" value=\"1\" />' +\r\n                        '</div>' +\r\n                        '<label class=\"control-label col-md-2\">Top</label>' +\r\n                        '<div class=\"col-md-3\">' +\r\n                        '<input name=\"fld-marginT\" id=\"fld-marginT\" type=\"text\" class=\"form-control text-right\" data-rule=\"measure\" value=\"1\" />' +\r\n                        '</div>' +\r\n                        '</div>' +\r\n                        '<div class=\"form-group\">' +\r\n                        '<label class=\"control-label col-md-4\">Right</label>' +\r\n                        '<div class=\"col-md-3\">' +\r\n                        '<input name=\"fld-marginR\" id=\"fld-marginR\" type=\"text\" class=\"form-control text-right\" data-rule=\"measure\" value=\"1\" />' +\r\n                        '</div>' +\r\n                        '<label class=\"control-label col-md-2\">Bottom</label>' +\r\n                        '<div class=\"col-md-3\">' +\r\n                        '<input name=\"fld-marginB\" id=\"fld-marginB\" type=\"text\" class=\"form-control text-right\" data-rule=\"measure\" value=\"1\" />' +\r\n                        '</div>' +\r\n                        '</div>' +\r\n                        '</fieldset>' +\r\n                        '<fieldset>' +\r\n                        '<legend>Headers and footers</legend>' +\r\n                        '<div class=\"form-group\">' +\r\n                        '<label class=\"control-label col-md-4\">Header</label>' +\r\n                        '<div class=\"col-md-8\">' +\r\n                        '<input type=\"text\" name=\"fld-header\" id=\"fld-header\" class=\"form-control\" style=\"max-width: none !important;\" />' +\r\n                        '</div>' +\r\n                        '</div>' +\r\n                        '<div class=\"form-group\">' +\r\n                        '<label class=\"control-label col-md-4\">Footer</label>' +\r\n                        '<div class=\"col-md-8\">' +\r\n                        '<input type=\"text\" name=\"fld-footer\" id=\"fld-footer\" class=\"form-control\" style=\"max-width: none !important;\" />' +\r\n                        '</div>' +\r\n                        '</div>' +\r\n                        '</fieldset>' +\r\n                        '</div>' +\r\n                        '<div class=\"modal-footer\">' +\r\n                        '<button type=\"button\" class=\"btn btn-primary\" id=\"btn-saveoptions\">OK</button>' +\r\n                        '<button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Cancel</button>' +\r\n                        '</div>' +\r\n                        '</div>' +\r\n                        '<!-- /.modal-content -->' +\r\n                        '</div>' +\r\n                        '<!-- /.modal-dialog -->' +\r\n                        '</div>' +\r\n                        '<!-- /.modal -->';\r\n                    break;\r\n\r\n                case '4':\r\n                    dlg = '<div class=\"modal fade\" tabindex=\"-1\" role=\"dialog\" id=\"dlg-printoptions\"><div class=\"modal-dialog modal-dialog-scrollable modal-dialog-centered modal-lg\" role = \"document\">' +\r\n                        '<div class=\"modal-content\"><div class=\"modal-header\"><h5 class=\"modal-title\">Page setup</h5><button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">' +\r\n                        '<span aria-hidden=\"true\">&times;</span></button></div><div class=\"modal-body\"><div class=\"container-fluid\"><fieldset><legend>Paper</legend><div class=\"form-group row\">' +\r\n                        '<label for=\"fld-papersize\" class=\"col-md-4 col-form-label text-right col-form-label-sm\">Size</label><div class=\"col-md-8\"><select class=\"' + sClass + ' form-control col-form-label-sm custom-select custom-select-sm\" id=\"fld-papersize\"></select>' +\r\n                        '</div></div><div class=\"form-group row\"><div class=\"col-md-8 offset-md-4\"><div class=\"form-check form-check-inline\"><input class=\"form-check-input\" type=\"radio\" value=\"2\" id=\"fld-portrait\" name=\"fld-orientation\" />' +\r\n                        '<label class=\"form-check-label\" for=\"fld-portrait\">Portrait</label></div><div class=\"form-check form-check-inline\"><input class=\"form-check-input\" type=\"radio\" value=\"1\" id=\"fld-landscape\" name=\"fld-orientation\" />' +\r\n                        '<label class=\"form-check-label\" for=\"fld-portrait\">Landscape</label></div></div></div><div class=\"form-group row\"><div class=\"col-md-8 offset-md-4\"><div class=\"form-check form-check-inline\"><input class=\"form-check-input\" type=\"checkbox\" name=\"fld-shrinktofit\" id=\"fld-shrinktofit\">' +\r\n                        '<label class=\"form-check-label\" for=\"fld-shrinktofit\">Shrink to fit</label></div></div></div><div class=\"form-group row\"><div class=\"col-md-8 offset-md-4\"><div class=\"form-check form-check-inline\">' +\r\n                        '<input class=\"form-check-input\" type=\"checkbox\" name=\"fld-printbackground\" id=\"fld-printbackground\"><label class=\"form-check-label\" for=\"fld-printbackground\">Print background colour and images</label>' +\r\n                        '</div></div></div></fieldset><fieldset><legend>Margins</legend><div class=\"form-group row\"><div class=\"col-md-8 offset-md-4\"><div class=\"form-check form-check-inline\"><input class=\"form-check-input\" type=\"radio\" value=\"2\" id=\"fld-millimetres\" name=\"fld-measure\" />' +\r\n                        '<label class=\"form-check-label\" for=\"fld-millimetres\">Millimetres</label></div><div class=\"form-check form-check-inline\"><input class=\"form-check-input\" type=\"radio\" value=\"1\" id=\"fld-inches\" name=\"fld-measure\" />' +\r\n                        '<label class=\"form-check-label\" for=\"fld-inches\">Inches</label></div></div></div><div class=\"form-group row\"><label class=\"col-md-4 col-form-label text-right col-form-label-sm\">Left</label>' +\r\n                        '<div class=\"col-md-3\"><div class=\"input-group spinner\" data-trigger=\"spinner\"><input name=\"fld-marginL\" id=\"fld-marginL\" type=\"text\" class=\"form-control text-right\" data-rule=\"measure\" value=\"1\" />' +\r\n                        '</div></div><label class=\"col-md-2 col-form-label text-right col-form-label-sm\">Top</label><div class=\"col-md-3\"><div class=\"input-group spinner\" data-trigger=\"spinner\"><input name=\"fld-marginT\" id=\"fld-marginT\" type=\"text\" class=\"form-control text-right\" data-rule=\"measure\" value=\"1\" />' +\r\n                        '</div></div></div><div class=\"form-group row\"><label class=\"col-md-4 col-form-label text-right col-form-label-sm\">Right</label><div class=\"col-md-3\"><div class=\"input-group spinner\" data-trigger=\"spinner\">' +\r\n                        '<input name=\"fld-marginR\" id=\"fld-marginR\" type=\"text\" class=\"form-control text-right\" data-rule=\"measure\" value=\"1\" /></div></div><label class=\"col-md-2 col-form-label text-right col-form-label-sm\">Bottom</label>' +\r\n                        '<div class=\"col-md-3\"><div class=\"input-group spinner\" data-trigger=\"spinner\"><input name=\"fld-marginB\" id=\"fld-marginB\" type=\"text\" class=\"form-control text-right\" data-rule=\"measure\" value=\"1\" />' +\r\n                        '</div></div></div></fieldset><fieldset><legend>Headers and footers</legend><div class=\"form-group row\"><label for=\"fld-header\" class=\"col-md-4 col-form-label text-right col-form-label-sm\">Header</label>' +\r\n                        '<div class=\"col-md-8\"><input type=\"text\" name=\"fld-header\" id=\"fld-header\" class=\"form-control form-control-sm\" /></div></div><div class=\"form-group row\"><label for=\"fld-footer\" class=\"col-md-4 col-form-label text-right col-form-label-sm\">Footer</label>' +\r\n                        '<div class=\"col-md-8\"><input type=\"text\" name=\"fld-footer\" id=\"fld-footer\" class=\"form-control form-control-sm\" /></div></div></fieldset></div>' +\r\n                        '</div><div class=\"modal-footer\"><button type=\"button\" class=\"btn btn-primary\" id=\"btn-saveoptions\">OK</button><button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Cancel</button></div></div></div></div>';\r\n                    break;\r\n\r\n                case '5':\r\n                    dlg = '<div class=\"modal\" tabindex=\"-1\" id=\"dlg-printoptions\"><div class=\"modal-dialog modal-dialog-scrollable modal-dialog-centered modal-lg\" role = \"document\">' +\r\n                        '<div class=\"modal-content\"><div class=\"modal-header\"><h5 class=\"modal-title\">Page setup</h5><button type=\"button\" class=\"btn-close\" data-dismiss=\"modal\" aria-label=\"Close\">' +\r\n                        '<span aria-hidden=\"true\"></span></button></div><div class=\"modal-body\"><div class=\"bs-component\"><fieldset><legend>Paper</legend><div class=\"row\">' +\r\n                        '<label for=\"fld-papersize\" class=\"col-md-4 col-form-label text-right col-form-label-sm\">Size</label><div class=\"col-md-8\"><select class=\"' + sClass + ' form-select form-select-sm\" id=\"fld-papersize\"></select>' +\r\n                        '</div></div><div class=\"row mt-2\"><div class=\"col-md-8 offset-md-4\">' +\r\n                        '<div class=\"form-check form-check-inline\"><input class=\"form-check-input\" type=\"radio\" value=\"2\" id=\"fld-portrait\" name=\"fld-orientation\" /><label class=\"form-check-label\" for=\"fld-portrait\">Portrait</label></div>' +\r\n                        '<div class=\"form-check form-check-inline\"><input class=\"form-check-input\" type=\"radio\" value=\"1\" id=\"fld-landscape\" name=\"fld-orientation\" /><label class=\"form-check-label\" for=\"fld-portrait\">Landscape</label></div></div></div>' +\r\n                        '<div class=\"row\"><div class=\"col-md-8 offset-md-4\"><div class=\"form-check form-check-inline\"><input class=\"form-check-input\" type=\"checkbox\" name=\"fld-shrinktofit\" id=\"fld-shrinktofit\">' +\r\n                        '<label class=\"form-check-label\" for=\"fld-shrinktofit\">Shrink to fit</label></div></div></div><div class=\"row\"><div class=\"col-md-8 offset-md-4\"><div class=\"form-check form-check-inline\">' +\r\n                        '<input class=\"form-check-input\" type=\"checkbox\" name=\"fld-printbackground\" id=\"fld-printbackground\"><label class=\"form-check-label\" for=\"fld-printbackground\">Print background colour and images</label>' +\r\n                        '</div></div></div></fieldset><fieldset><legend>Margins</legend><div class=\"row\"><div class=\"col-md-8 offset-md-4\">' +\r\n                        '<div class=\"form-check form-check-inline\"><input class=\"form-check-input\" type=\"radio\" value=\"2\" id=\"fld-millimetres\" name=\"fld-measure\" /><label class=\"form-check-label\" for=\"fld-millimetres\">Millimetres</label></div>' +\r\n                        '<div class=\"form-check form-check-inline\"><input class=\"form-check-input\" type=\"radio\" value=\"1\" id=\"fld-inches\" name=\"fld-measure\" /><label class=\"form-check-label\" for=\"fld-inches\">Inches</label></div></div></div>' +\r\n                        '<div class=\"row mt-2\"><label class=\"col-md-4 col-form-label text-right col-form-label-sm\">Left</label>' +\r\n                        '<div class=\"col-md-3\"><div class=\"input-group\"><input name=\"fld-marginL\" id=\"fld-marginL\" type=\"number\" min=\"0\" max=\"30\" step=\"0.1\" class=\"form-control text-right form-control-sm\" data-rule=\"measure\" value=\"1\" />' +\r\n                        '</div></div><label class=\"col-md-2 col-form-label text-right col-form-label-sm\">Top</label><div class=\"col-md-3\"><div class=\"input-group\"><input name=\"fld-marginT\" id=\"fld-marginT\" type=\"number\" min=\"0\" max=\"30\" step=\"0.1\" class=\"form-control text-right form-control-sm\" data-rule=\"measure\" value=\"1\" />' +\r\n                        '</div></div></div><div class=\"row mt-2\"><label class=\"col-md-4 col-form-label text-right col-form-label-sm\">Right</label><div class=\"col-md-3\"><div class=\"input-group\">' +\r\n                        '<input name=\"fld-marginR\" id=\"fld-marginR\" type=\"number\" min=\"0\" max=\"30\" step=\"0.1\" class=\"form-control text-right form-control-sm\" value=\"1\" data-rule=\"measure\"/></div></div><label class=\"col-md-2 col-form-label text-right col-form-label-sm\">Bottom</label>' +\r\n                        '<div class=\"col-md-3\"><div class=\"input-group\"><input name=\"fld-marginB\" id=\"fld-marginB\" type=\"number\" min=\"0\" max=\"30\" step=\"0.1\" class=\"form-control text-right form-control-sm\" value=\"1\" data-rule=\"measure\"/>' +\r\n                        '</div></div></div></fieldset><fieldset class=\"mt-2\"><legend>Headers and footers</legend><div class=\"row\"><label for=\"fld-header\" class=\"col-md-4 col-form-label text-right col-form-label-sm\">Header</label>' +\r\n                        '<div class=\"col-md-8\"><input type=\"text\" name=\"fld-header\" id=\"fld-header\" class=\"form-control form-control-sm\" /></div></div><div class=\"row mt-2\"><label for=\"fld-footer\" class=\"col-md-4 col-form-label text-right col-form-label-sm\">Footer</label>' +\r\n                        '<div class=\"col-md-8\"><input type=\"text\" name=\"fld-footer\" id=\"fld-footer\" class=\"form-control form-control-sm\" /></div></div></fieldset></div>' +\r\n                        '</div><div class=\"modal-footer\"><button type=\"button\" class=\"btn btn-primary\" id=\"btn-saveoptions\">OK</button><button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">Cancel</button></div></div></div></div>';\r\n                    break;\r\n\r\n                default:\r\n                    console.error(\"Unknown version of bootstrap: \" + bs_majorVersion);\r\n                    fnCallBack(false);\r\n                    return;\r\n            }\r\n\r\n            $('body').append(dlg);\r\n        }\r\n\r\n        $('[name=\"fld-measure\"]')\r\n            .off('change')\r\n            .on('change', function () {\r\n                const uiType = bs_majorVersion === \"5\" ? \"number\" : \"text\";\r\n                switch ($(this).val()) {\r\n                    case '2': // mm from inches\r\n                        $(`#dlg-printoptions input[type=${uiType}][data-rule=measure]`).each(function () {\r\n                            convertAndDisplayinchesToMM($(this));\r\n                        });\r\n                        break;\r\n\r\n                    case '1': // inches from mm\r\n                        $(`#dlg-printoptions input[type=${uiType}][data-rule=measure]`).each(function () {\r\n                            convertAndDisplayMMtoInches($(this));\r\n                        });\r\n                        break;\r\n                }\r\n            });\r\n\r\n        // reattach click handler as callback function scoped variables may (probably will) have changed\r\n        $('#btn-saveoptions')\r\n            .off(\"click\")\r\n            .on(\"click\", function (ev) {\r\n                ev.preventDefault();\r\n                savePageSetup();\r\n                bAccepted = true;\r\n                $('#dlg-printoptions').modal('hide');\r\n            });\r\n\r\n        $(\"#dlg-printoptions\")\r\n            .off('hidden.bs.modal')\r\n            .on('hidden.bs.modal', function () {\r\n                if (typeof fnCallBack === \"function\") {\r\n                    fnCallBack(bAccepted);\r\n                }\r\n            });\r\n\r\n        var $dlg = $('#dlg-printoptions');\r\n        var settings = MeadCo.ScriptX.Print.HTML.settings;\r\n\r\n        $dlg.find('[name=\"fld-orientation\"]').val([settings.page.orientation]);\r\n        $dlg.find('#fld-printbackground').prop('checked', settings.printBackgroundColorsAndImages);\r\n        $dlg.find('#fld-shrinktofit').prop('checked', settings.viewScale == -1);\r\n        $dlg.find('[name=\"fld-measure\"]').val([settings.page.units]);\r\n        $dlg.find('#fld-marginL').val(settings.page.margins.left);\r\n        $dlg.find('#fld-marginT').val(settings.page.margins.top);\r\n        $dlg.find('#fld-marginR').val(settings.page.margins.right);\r\n        $dlg.find('#fld-marginB').val(settings.page.margins.bottom);\r\n        $dlg.find('#fld-header').val(settings.header);\r\n        $dlg.find('#fld-footer').val(settings.footer);\r\n\r\n        // grab the paper size options \r\n        var printApi = MeadCo.ScriptX.Print;\r\n        var $paperselect = $('#fld-papersize');\r\n        var forms = printApi.deviceSettingsFor(printApi.printerName).forms;\r\n\r\n        $('#fld-papersize > option').remove();\r\n        for (var i in forms) {\r\n            $paperselect.append(\"<option>\" + forms[i] + \"</option>\");\r\n        }\r\n\r\n        if ($paperselect.hasClass(\"selectpicker\")) {\r\n            $paperselect.selectpicker('refresh');\r\n        }\r\n\r\n        $paperselect.val(MeadCo.ScriptX.Print.deviceSettings.paperSizeName);\r\n\r\n        $dlg.modal('show');\r\n\r\n        if ($paperselect.hasClass(\"selectpicker\")) {\r\n            $paperselect.selectpicker('refresh');\r\n        }\r\n\r\n    };\r\n\r\n    // MeadCo.ScriptX.Print.UI.PrinterSettings()\r\n    ui.PrinterSettings = function (fnCallBack) {\r\n\r\n        if (!$.fn.modal && !bootstrap.Modal) {\r\n            console.error(\"MeadCo.ScriptX.Print.UI requires bootstrap Modal\");\r\n            fnCallBack(false);\r\n            return;\r\n        }\r\n\r\n        var bAccepted = false;\r\n        var sClass = \"\";\r\n        var bs_majorVersion = ($.fn.modal.Constructor.VERSION || '').split(' ')[0].split('.')[0];\r\n\r\n        // check for presence of bootstrap-select.js (doesn't work well with BS 4)\r\n        if ($.fn.selectpicker && bs_majorVersion === '3') {\r\n            sClass = \"selectpicker\";\r\n        }\r\n\r\n        // printer settings modal to attach to the page\r\n        if (!$('#dlg-printersettings').length) {\r\n            console.log(\"UI.PageSetup bootstrap modal version: \" + $.fn.modal.Constructor.VERSION);\r\n\r\n            var dlg;\r\n\r\n            switch (bs_majorVersion) {\r\n                case '3':\r\n                    dlg = '<style>' +\r\n                        '.modal-dialog legend { font-size: 1.2em; font-weight: bold; margin-bottom: 10px; } ' +\r\n                        '.modal-dialog fieldset { padding-bottom: 0px; } ' +\r\n                        '.modal-dialog .options-modal-body { padding-bottom: 0px !important; } ' +\r\n                        '.modal-dialog .checkbox2 {  padding-top: 0px !important; min-height: 0px !important; } ' +\r\n                        '.modal-dialog .radio2 { padding-top: 0px !important; min-height: 0px !important; } ' +\r\n                        '</style>' +\r\n                        '<div class=\"modal fade\" id=\"dlg-printersettings\">' +\r\n                        '<div class=\"modal-dialog\">' +\r\n                        '<div class=\"modal-content\">' +\r\n                        '<div class=\"modal-header\">' +\r\n                        '<button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-hidden=\"true\">&times;</button>' +\r\n                        '<h4 class=\"modal-title\">Print</h4>' +\r\n                        '</div>' +\r\n                        '<div class=\"modal-body form-horizontal options-modal-body\">' +\r\n                        //'<fieldset>' +\r\n                        //    '<legend>Printer</legend>' +\r\n                        '<div class=\"form-group\">' +\r\n                        '<label class=\"col-md-4 control-label\" for=\"fld-printerselect\">Printer</label>' +\r\n                        '<div class=\"col-md-8\"><select class=\"' + sClass + ' form-control show-tick\" id=\"fld-printerselect\"></select></div>' +\r\n                        '</div>' +\r\n                        '<div class=\"form-group\">' +\r\n                        '<label class=\"col-md-4 control-label\" for=\"fld-papersource\">Paper source</label>' +\r\n                        '<div class=\"col-md-8\"><select class=\"' + sClass + ' form-control show-tick\" id=\"fld-papersource\"></select></div>' +\r\n                        '</div>' +\r\n                        '<div class=\"form-group\">' +\r\n                        '<label class=\"control-label col-md-4\">Copies</label>' +\r\n                        '<div class=\"col-md-3\">' +\r\n                        '<input name=\"fld-copies\" id=\"fld-copies\" type=\"text\" class=\"form-control text-right\" data-rule=\"quantity\" value=\"1\" />' +\r\n                        '</div>' +\r\n                        '<div class=\"col-md-5\">' +\r\n                        '<div class=\"checkbox2\">' +\r\n                        '<label class=\"checkbox-inline\">' +\r\n                        '<input type=\"checkbox\" name=\"fld-collate\" id=\"fld-collate\">' +\r\n                        ' Collate' +\r\n                        '</label>' +\r\n                        '</div>' +\r\n                        '</div>' +\r\n                        '</div>' +\r\n                        //'</fieldset>' +\r\n                        '</div>' +\r\n                        '<div class=\"modal-footer\">' +\r\n                        '<button type=\"button\" class=\"btn btn-primary\" id=\"btn-savesettings\">Print</button>' +\r\n                        '<button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Cancel</button>' +\r\n                        '</div>' +\r\n                        '</div>' +\r\n                        '<!-- /.modal-content -->' +\r\n                        '</div>' +\r\n                        '<!-- /.modal-dialog -->' +\r\n                        '</div>' +\r\n                        '<!-- /.modal -->';\r\n                    break;\r\n\r\n                case '4':\r\n                    dlg = '<div class=\"modal fade\" id=\"dlg-printersettings\"><div class=\"modal-dialog modal-dialog-scrollable modal-dialog-centered\" role = \"document\"><div class=\"modal-content\">' +\r\n                        '<div class=\"modal-header\"><h5 class=\"modal-title\">Print</h5><button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span>' +\r\n                        '</button></div><div class=\"modal-body\"><div class=\"container-fluid\"><div class=\"form-group row\"><label for=\"fld-printerselect\" class=\"col-md-4 col-form-label text-right col-form-label-sm\">Printer</label>' +\r\n                        '<div class=\"col-md-8\"><select class=\"' + sClass + ' form-control col-form-label-sm custom-select custom-select-sm\" id=\"fld-printerselect\"></select></div></div><div class=\"form-group row\">' +\r\n                        '<label for=\"fld-papersource\" class=\"col-md-4 col-form-label text-right col-form-label-sm\">Paper source</label><div class=\"col-md-8\"><select class=\"' + sClass + ' form-control col-form-label-sm custom-select custom-select-sm\" id=\"fld-papersource\"></select>' +\r\n                        '</div></div><div class=\"form-group row align-items-center\"><label for=\"fld-copies\" class=\"col-md-4 col-form-label text-right col-form-label-sm\">Copies</label><div class=\"col-md-3\">' +\r\n                        '<input name=\"fld-copies\" id=\"fld-copies\" type=\"text\" class=\"form-control form-control-sm text-right\" data-rule=\"quantity\" value=\"1\" /></div><div class=\"col-md-5\"><div class=\"form-check form-check-inline\">' +\r\n                        '<input class=\"form-check-input\" type=\"checkbox\" name=\"fld-collate\" id=\"fld-collate\"><label class=\"form-check-label\" for=\"fld-collate\">Collate</label></div></div></div></div>' +\r\n                        '</div><div class=\"modal-footer\"><button type=\"button\" class=\"btn btn-primary\" id=\"btn-savesettings\">Print</button><button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Cancel</button></div></div></div></div >';\r\n                    break;\r\n\r\n                case '5':\r\n                    dlg = '<div class=\"modal\" id=\"dlg-printersettings\"><div class=\"modal-dialog role = \"document\"><div class=\"modal-content\">' +\r\n                        '<div class=\"modal-header\"><h5 class=\"modal-title\">Print</h5><button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\"><span aria-hidden=\"true\"></span>' +\r\n                        '</button></div><div class=\"modal-body\"><div class=\"bs-component\"><div class=\"row\"><label for=\"fld-printerselect\" class=\"col-md-4 form-label text-right col-form-label-sm\">Printer</label>' +\r\n                        '<div class=\"col-md-8\"><select class=\"' + sClass + ' form-select form-select-sm\" id=\"fld-printerselect\"></select></div></div><div class=\"row mt-2\">' +\r\n                        '<label for=\"fld-papersource\" class=\"col-md-4 form-label text-right col-form-label-sm\">Paper source</label><div class=\"col-md-8\"><select class=\"' + sClass + ' form-select form-select-sm\" id=\"fld-papersource\"></select>' +\r\n                        '</div></div><div class=\"row g-3\" style=\"margin-top:-8px\"><label for=\"fld-copies\" class=\"col-md-4 form-label text-right col-form-label-sm\">Copies</label><div class=\"col-md-3\">' +\r\n                        '<input name=\"fld-copies\" id=\"fld-copies\" type=\"number\" min=\"1\" max=\"5\" step=\"1\" class=\"form-control form-control-sm text-right\" data-rule=\"quantity\" value=\"1\" /></div><div class=\"col-md-5\"><div class=\"form-check\" style=\"margin-top: 4px\">' +\r\n                        '<input class=\"form-check-input\" type=\"checkbox\" name=\"fld-collate\" id=\"fld-collate\"><label class=\"form-check-label\" for=\"fld-collate\">Collate</label></div></div></div></div>' +\r\n                        '</div><div class=\"modal-footer\"><button type=\"button\" class=\"btn btn-primary\" id=\"btn-savesettings\">Print</button><button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">Cancel</button></div></div></div></div >';\r\n                    break;\r\n\r\n                default:\r\n                    console.error(\"Unknown version of bootstrap: \" + bs_majorVersion);\r\n                    fnCallBack(false);\r\n                    return;\r\n            }\r\n\r\n            $('body').append(dlg);\r\n\r\n            $('#dlg-printersettings #fld-printerselect').change(function (ev) {\r\n                onSelectPrinter($(this).val());\r\n            });\r\n        }\r\n\r\n        // reattach click handler as callback function scoped variables may (probably will) have changed\r\n        $('#btn-savesettings')\r\n            .off(\"click\")\r\n            .on(\"click\", function (ev) {\r\n                ev.preventDefault();\r\n                savePrinterSettings();\r\n                bAccepted = true;\r\n                $('#dlg-printersettings').modal('hide');\r\n            });\r\n\r\n        $(\"#dlg-printersettings\")\r\n            .off('hidden.bs.modal')\r\n            .on('hidden.bs.modal', function () {\r\n                if (typeof fnCallBack === \"function\") {\r\n                    fnCallBack(bAccepted);\r\n                }\r\n            });\r\n\r\n\r\n        fillPrintersList();\r\n        showPrinterSettings();\r\n\r\n        if (bs_majorVersion === \"5\") {\r\n            let d = new bootstrap.Modal(document.getElementById('dlg-printersettings'), {\r\n                backdrop: 'static',\r\n                keyboard: false,\r\n                show: false\r\n            });\r\n            d.show();\r\n        }\r\n        else\r\n            $('#dlg-printersettings').modal('show');\r\n\r\n        if (sClass === \"selectpicker\") {\r\n            $('#dlg-printersettings .selectpicker').selectpicker('refresh');\r\n        }\r\n    };\r\n\r\n    // show available sources and options \r\n    function showPrinterSettings() {\r\n        var printApi = MeadCo.ScriptX.Print;\r\n        var settings = printApi.deviceSettings;\r\n\r\n        fillAndSetBinsList();\r\n\r\n        var $dlg = $('#dlg-printersettings');\r\n        $dlg.find('#fld-collate').prop('checked', settings.collate === printApi.CollateOptions.TRUE);\r\n        $dlg.find('#fld-copies').val(settings.copies);\r\n\r\n    }\r\n\r\n    function savePageSetup() {\r\n        var $dlg = $('#dlg-printoptions');\r\n        var settings = MeadCo.ScriptX.Print.HTML.settings;\r\n\r\n        if ($dlg.length) {\r\n            settings.page.orientation = $dlg.find('[name=\"fld-orientation\"]:checked').val();\r\n            settings.printBackgroundColorsAndImages = $dlg.find('#fld-printbackground').prop('checked');\r\n            settings.viewScale = $dlg.find('#fld-shrinktofit').prop('checked') ? -1 : 100;\r\n            settings.page.units = parseInt($dlg.find('[name=\"fld-measure\"]:checked').val());\r\n            settings.page.margins.left = $dlg.find('#fld-marginL').val();\r\n            settings.page.margins.top = $dlg.find('#fld-marginT').val();\r\n            settings.page.margins.right = $dlg.find('#fld-marginR').val();\r\n            settings.page.margins.bottom = $dlg.find('#fld-marginB').val();\r\n            settings.header = $dlg.find('#fld-header').val();\r\n            settings.footer = $dlg.find('#fld-footer').val();\r\n\r\n            MeadCo.ScriptX.Print.deviceSettings.paperSizeName = $('#fld-papersize').val();\r\n        }\r\n    }\r\n\r\n    function savePrinterSettings() {\r\n        var $dlg = $('#dlg-printersettings');\r\n        var printApi = MeadCo.ScriptX.Print;\r\n\r\n        if ($dlg.length) {\r\n            // must set the printer first and note this might trigger a getDeviceSettings call to the server\r\n            var a = printApi.onErrorAction;\r\n\r\n            printApi.onErrorAction = printApi.ErrorAction.THROW;\r\n\r\n            // eat all and any errors. finally might be better but\r\n            // minifiers dont like empty blocks \r\n            try {\r\n                printApi.printerName = $('#fld-printerselect').val();\r\n                printApi.onErrorAction = a;\r\n            }\r\n            catch (e) {\r\n                printApi.onErrorAction = a;\r\n            }\r\n\r\n            // update settings for the active printer\r\n            var settings = printApi.deviceSettings;\r\n            settings.paperSourceName = $('#fld-papersource').val();\r\n            settings.collate = $dlg.find('#fld-collate').prop('checked') ? printApi.CollateOptions.TRUE : printApi.CollateOptions.FALSE\r\n            settings.copies = $dlg.find('#fld-copies').val();\r\n        }\r\n    }\r\n\r\n    // fill printers dropdown with those available\r\n    function fillPrintersList() {\r\n        var printApi = MeadCo.ScriptX.Print;\r\n        var $printers = $('#fld-printerselect');\r\n        var arrPrinters = printApi.availablePrinterNames;\r\n\r\n        $('#fld-printerselect > option').remove();\r\n\r\n        for (var i = 0; i < arrPrinters.length; i++) {\r\n            $printers.append(\"<option>\" + arrPrinters[i]);\r\n        }\r\n\r\n        $printers.val(printApi.printerName);\r\n        if ($printers.hasClass(\"selectpicker\")) {\r\n            $printers.selectpicker('refresh');\r\n        }\r\n        else\r\n            onSelectPrinter(printApi.printerName);\r\n    }\r\n\r\n    function onSelectPrinter(printerName) {\r\n        var printApi = MeadCo.ScriptX.Print;\r\n        var currentPrinterName = printApi.printerName;\r\n        var currentSource = printApi.deviceSettings.paperSourceName;\r\n\r\n        var a = printApi.onErrorAction;\r\n\r\n        printApi.onErrorAction = printApi.ErrorAction.THROW;\r\n\r\n        try {\r\n            // select the printer to get its default source and size.\r\n            printApi.printerName = printerName;\r\n            fillAndSetBinsList();\r\n        } catch (e) {\r\n            alert(\"Sorry, an error has occurred:\\n\\n\" + e.message);\r\n        }\r\n\r\n        // revert the current printer in ScriptX\r\n        try {\r\n            printApi.printerName = currentPrinterName;\r\n            printApi.deviceSettings.paperSourceName = currentSource;\r\n        } catch (e) {\r\n            alert(\"Sorry, an error has occurred restoring current printer settings:\\n\\n\" + e.message);\r\n        }\r\n\r\n        printApi.onErrorAction = a;\r\n\r\n    }\r\n\r\n    function fillAndSetBinsList() {\r\n        var printApi = MeadCo.ScriptX.Print;\r\n\r\n        printApi.deviceSettingsForAsync(printApi.printerName, (settings) => {\r\n            var binsArray = settings.bins;\r\n            var $bins = $('#fld-papersource');\r\n\r\n            $('#fld-papersource > option').remove();\r\n            for (var i = 0; i < binsArray.length; i++) {\r\n                $bins.append(\"<option>\" + binsArray[i]);\r\n            }\r\n\r\n            $bins.val(settings.paperSourceName);\r\n\r\n            if ($bins.hasClass(\"selectpicker\")) {\r\n                $bins.selectpicker('refresh');\r\n            }\r\n        },\r\n            (eTxt) => { MeadCo.ScriptX.Print.reportError(eTxt); });\r\n\r\n    }\r\n\r\n    // convert the current inches value in the control to MM\r\n    function convertAndDisplayinchesToMM($el) {\r\n        $el.val(((parseFloat($el.val()) * 2540) / 100).toFixed(2));\r\n    }\r\n\r\n    // convert the current mm value in the control to inches\r\n    function convertAndDisplayMMtoInches($el) {\r\n        $el.val(((parseFloat($el.val()) * 100) / 2540).toFixed(2));\r\n    }\r\n\r\n})(window.MeadCo = window.MeadCo || null, jQuery);\r\n"]}