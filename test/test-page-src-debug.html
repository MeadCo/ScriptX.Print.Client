<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Page</title>
    <script type="text/javascript">
        var MeadCo = {
            logEnable: true,
            useFetch: true
        }
    </script>
    <script src="src/meadco-core.js"></script>
    <script src="src/meadco-scriptxprint.js"></script>
    <script src="src/meadco-scriptxprinthtml.js"></script>
    <script src="src/meadco-scriptxprintpdf.js"></script>
    <script src="src/meadco-scriptxprintlicensing.js"></script>
    <script src="src/meadco-scriptxfactory.js"></script>
    <script src="src/meadco-secmgr.js"></script>

    <script type="text/javascript">
        MeadCo.ScriptX.Print.reportServerError = function (txt) {
            document.getElementById("qunit-fixture").textContent = txt;
        };

        MeadCo.ScriptX.Print.reportFeatureNotImplemented = function (featureDescription) {
            document.getElementById("qunit-fixture").textContent = txt;
        };


    </script>

    <script type="text/javascript">
        // Define the runTest function if it's not already defined elsewhere
        async function runTest() {
            results = {};
            console.log("Running test on document load");
            // Add your test logic here
            const api = window.MeadCo.ScriptX.Print;
            const serverUrl = "http://127.0.0.1:41191";
            const guid = "{5091E665-8916-4D21-996E-00A2DE5DE416}"

            api.connectLite(serverUrl, "{218A8DB0-5A54-41A3-B349-1144546A3A8E}");
            try {
                results.result2 = "ok";
                results.result2 = await new Promise((resolve, reject) => {
                    api.getFromServer("twaddle/?units=0", true, resolve, reject);
                });
            } catch (e) {
                results.error2 = e;
            }

            try {
                results.result3 = "ok";
                results.result3 = await new Promise((resolve, reject) => {
                    api.getFromServer("/htmlPrintDefaults/?units=0", true, resolve, reject);
                });
            } catch (e) {
                results.error3 = e;
            }

            api.connectLite(serverUrl, guid);
            try {
                results.result4 = "ok";
                results.result4 = (await new Promise((resolve, reject) => {
                    api.getFromServer("/htmlPrintDefaults/?units=0", true, resolve, reject);
                })).settings.header;
            } catch (e) {
                results.error4 = e;
            }

            console.log(results);
        }

        // Execute runTest when the document is fully loaded
        document.addEventListener("DOMContentLoaded", async function () {
            runTest();
        });
    </script>
</head>
<body>
    <div id="test-element">Initial Content</div>
    <div id="qunit"></div>
    <div id="qunit-fixture"></div>
</body>
</html>
